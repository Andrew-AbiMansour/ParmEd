

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The parmed.amber package &mdash; ParmEd  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="parmed.amber.AmberFormat" href="amberobj/parmed.amber.AmberFormat.html" />
    <link rel="prev" title="parmed.formats.registry.load_file" href="fileio/parmed.formats.registry.load_file.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ParmEd
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.3319.g7a6168d
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="topologyobjects.html">Core classes used to represent topologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">The core Structure class</a></li>
<li class="toctree-l1"><a class="reference internal" href="dimensional_analysis.html">Working with units</a></li>
<li class="toctree-l1"><a class="reference internal" href="readwrite.html">Reading and writing files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Amber file classes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-parameter-topology-prmtop-file">The parameter-topology (<em>prmtop</em>) file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.AmberFormat.html">parmed.amber.AmberFormat</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.AmberParm.html">parmed.amber.AmberParm</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.ChamberParm.html">parmed.amber.ChamberParm</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.AmoebaParm.html">parmed.amber.AmoebaParm</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.LoadParm.html">parmed.amber.LoadParm</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.AmberMask.html">parmed.amber.AmberMask</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-amberformat-class">The <code class="xref py py-class docutils literal notranslate"><span class="pre">AmberFormat</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-amberparm-chamberparm-and-amoebaparm-classes">The <code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ChamberParm</span></code>, and <code class="xref py py-class docutils literal notranslate"><span class="pre">AmoebaParm</span></code> classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#warning">WARNING</a></li>
<li class="toctree-l3"><a class="reference internal" href="#an-example">An Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generalizing-with-loadparm">Generalizing with <code class="xref py py-func docutils literal notranslate"><span class="pre">LoadParm()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-coordinate-and-trajectory-files">The coordinate and trajectory files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.Rst7.html">parmed.amber.Rst7</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.AmberAsciiRestart.html">parmed.amber.AmberAsciiRestart</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.NetCDFRestart.html">parmed.amber.NetCDFRestart</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.NetCDFTraj.html">parmed.amber.NetCDFTraj</a></li>
<li class="toctree-l3"><a class="reference internal" href="amberobj/parmed.amber.AmberMdcrd.html">parmed.amber.AmberMdcrd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inpcrd-and-restart-files">Inpcrd and Restart files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trajectory-files">Trajectory files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="amberobj/parmed.amber.AmberMdcrd.html">parmed.amber.AmberMdcrd</a></li>
<li class="toctree-l4"><a class="reference internal" href="amberobj/parmed.amber.NetCDFTraj.html">parmed.amber.NetCDFTraj</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reading-and-writing-netcdf-files">Reading and writing NetCDF files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#amber-mask-syntax">Amber mask syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#residue-selections">Residue selections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#atom-selections">Atom selections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#atom-element-selections">Atom element selections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#atom-type-selections">Atom type selections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logical-operators">Logical operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wild-cards">Wild-cards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distance-based-selections">Distance-based selections</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="charmm.html">The CHARMM file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="gromacs.html">The GROMACS file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="rosetta.html">PyRosetta Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="parmed.html">Using <code class="docutils literal notranslate"><span class="pre">parmed</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="parmed.html#using-xparmed">Using <code class="docutils literal notranslate"><span class="pre">xparmed</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="parmed_api.html">The ParmEd API</a></li>
<li class="toctree-l1"><a class="reference internal" href="openmm.html">OpenMM Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization Functionality</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ParmEd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">parmed.amber</span></code> package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/amber.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-parmed-amber-package">
<h1>The <a class="reference internal" href="api/parmed/parmed.amber.html#module-parmed.amber" title="parmed.amber"><code class="xref py py-mod docutils literal notranslate"><span class="pre">parmed.amber</span></code></a> package<a class="headerlink" href="#the-parmed-amber-package" title="Permalink to this headline">Â¶</a></h1>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">amber</span></code> package contains classes that can parse most of the file
formats used by the Amber molecular dynamics package.  In particular are Amber
parameter and topology files as well as the various formats of coordinate and
trajectory files that Amber supports (and creates).</p>
<p>It is out of the scope of this site to discuss the details of the file formats
themselves, and you are instead forwarded to the <a class="reference external" href="http://ambermd.org">official Amber website</a> and <a class="reference external" href="http://ambermd.org/formats.html">file format specifications</a>.</p>
<div class="section" id="the-parameter-topology-prmtop-file">
<h2>The parameter-topology (<em>prmtop</em>) file<a class="headerlink" href="#the-parameter-topology-prmtop-file" title="Permalink to this headline">Â¶</a></h2>
<p>The primary file in Amber defining the system topology and the parameters
defining the force field for that system is called the <em>prmtop</em> file, whose
format is detailed on <a class="reference external" href="http://ambermd.org/formats.html">http://ambermd.org/formats.html</a>. There are several
variants of this extensible file format, and these parsers rigorously implement
the format specification.</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AmberFormat</span></code></a>([fname])</p></td>
<td><p>A class that can parse and print files stored in the Amber topology or MDL format.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AmberParm</span></code></a>([prm_name,Â xyz,Â box,Â rst7_name])</p></td>
<td><p>Amber Topology (parm7 format) class.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ChamberParm</span></code></a>([prm_name,Â xyz,Â box,Â rst7_name])</p></td>
<td><p>Chamber Topology (parm7 format) class.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AmoebaParm</span></code></a>([prm_name,Â xyz,Â box,Â rst7_name])</p></td>
<td><p>Tinker Topology (parm7 format) class defining the AMOEBA force field.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LoadParm</span></code></a>(parmname[,Â xyz,Â box])</p></td>
<td><p>Loads a topology file using the correct class.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMask" title="parmed.amber.AmberMask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AmberMask</span></code></a>(parm,Â mask)</p></td>
<td><p>What is hopefully a fully-fledged Amber mask parser implemented in Python.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="the-amberformat-class">
<h3>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberFormat</span></code></a> class<a class="headerlink" href="#the-amberformat-class" title="Permalink to this headline">Â¶</a></h3>
<p>This class simply parses the raw data from a file with the format of an Amber
<em>prmtop</em> file and makes the data available in a <code class="docutils literal notranslate"><span class="pre">dict</span></code> whose keys are the
<code class="docutils literal notranslate"><span class="pre">FLAG_NAME</span></code> in the <code class="docutils literal notranslate"><span class="pre">%FLAG</span> <span class="pre">&lt;FLAG_NAME&gt;</span></code> lines. Some filesâlike the MDL
files used in 3D-RISM calculationsâuse this format to store raw, structured
data, and this class is appropriate for use with those files.</p>
<p>In most cases, however, this simply serves as a base class, along with
<a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Structure</span></code></a>, for the <em>prmtop</em> parsers.</p>
<p>An example using this class on <a class="reference external" href="https://github.com/swails/ParmEd/blob/master/test/files/cSPCE.mdl">one of the test files in the ParmEd repostory</a> is shown
below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span> <span class="o">=</span> <span class="n">AmberFormat</span><span class="p">(</span><span class="s1">&#39;cSPCE.mdl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;ATMTYP&#39;</span><span class="p">]</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;COORD&#39;</span><span class="p">]</span>
<span class="go">[0.0, 0.0, 0.0, 1.0, 0.0, 0.0, -0.333314, 0.942816, 0.0]</span>
</pre></div>
</div>
<p>If you want to, you can make modifications to the data and then write a new
file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;COORD&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">write_parm</span><span class="p">(</span><span class="s1">&#39;new.mdl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s check that our new file has the changed COORD</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_amb</span> <span class="o">=</span> <span class="n">AmberFormat</span><span class="p">(</span><span class="s1">&#39;new.mdl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;COORD&#39;</span><span class="p">]</span>
<span class="go">[10.0, 0.0, 0.0, 1.0, 0.0, 0.0, -0.333314, 0.942816, 0.0]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-amberparm-chamberparm-and-amoebaparm-classes">
<h3>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a>, <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChamberParm</span></code></a>, and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmoebaParm</span></code></a> classes<a class="headerlink" href="#the-amberparm-chamberparm-and-amoebaparm-classes" title="Permalink to this headline">Â¶</a></h3>
<p>These classes are subclasses of both <a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Structure</span></code></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberFormat</span></code></a>. (The special classes
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChamberParm</span></code></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmoebaParm</span></code></a>, implementing the CHARMM and Amoeba
force fields, respectively, both inherit from <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a>.) You need to
make sure that you use the correct class for the variant of <em>prmtop</em> file you
are using.  If you are unsure, the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><code class="xref py py-func docutils literal notranslate"><span class="pre">LoadParm()</span></code></a> function will automatically
determine the correct class and return an instance of it (see below).</p>
<p>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a> class parses a <em>prmtop</em> object and stores both the raw
data (see the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberFormat</span></code></a> description, above), as well as the standard
topological data structures used in the <a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Structure</span></code></a> class. Different subclasses of
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a> will populate different term and parameter lists depending on
the terms present in the force field.</p>
<p>The example of an Amber topology file shown here is <code class="docutils literal notranslate"><span class="pre">trx.prmtop</span></code>, taken from
the ParmEd unit test directory <a class="reference external" href="http://github.com/swails/ParmEd/tree/master/test/files/trx.prmtop">available here</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span> <span class="o">=</span> <span class="n">AmberParm</span><span class="p">(</span><span class="s1">&#39;trx.prmtop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;N&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;SER&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="n">parm</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">13</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;SER&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="c1"># this should be a new residue!</span>
<span class="go">&#39;ASP&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atom1</span>
<span class="go">&lt;Atom C [11]; In SER 0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atom2</span>
<span class="go">&lt;Atom O [12]; In SER 0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">k</span> <span class="c1"># Check out our parameter types</span>
<span class="go">570.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
<span class="go">1.229</span>
</pre></div>
</div>
</div>
<div class="section" id="warning">
<h3>WARNING<a class="headerlink" href="#warning" title="Permalink to this headline">Â¶</a></h3>
<p>Since the raw data and topological features are inextricably linked, there are
risks associated with modifying the raw data in <code class="xref py py-attr docutils literal notranslate"><span class="pre">AmberParm.parm_data</span></code>
<em>and</em> the parameters and properties of the topological data structures in the
lists inherited from <a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Structure</span></code></a>.</p>
<p>The required overhead to keep <code class="xref py py-attr docutils literal notranslate"><span class="pre">AmberParm.parm_data</span></code> and the topology
structures synchronized at all times introduces too great a cost, so keeping
them synchronized largely falls on the programmer, although there is
functionality introduced to help:</p>
<ul>
<li><p>Changes to the size or contents of any of the lists in the structure will
trigger <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.remake_parm()</span></code></a> to be called inside
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.write_parm" title="parmed.amber.AmberParm.write_parm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.write_parm()</span></code></a> to make sure that new topology files are
written with the updated parameter definitions.</p></li>
<li><p>There are a handful of synchronization routines designed to copy information
from the parameter and topology arrays into <code class="xref py py-attr docutils literal notranslate"><span class="pre">AmberParm.parm_data</span></code> and
vice-versa. These are summarized in the table below. These are not called
automatically (with the exception of <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.remake_parm()</span></code></a> prior to
writing a new <em>prmtop</em> file) for performance reasons.</p></li>
<li><p>To modify an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a> instance safely, follow these guidelines:</p>
<blockquote>
<div><ul class="simple">
<li><p>Modify the attributes on the parameter and topology objects, and call
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AmberParm.remake_parm</span></code></a> if you ever need to access the contents
of <code class="xref py py-attr docutils literal notranslate"><span class="pre">AmberParm.parm_data</span></code> (but try to avoid using the raw data if
possible)</p></li>
<li><p>Use an available class from <a class="reference internal" href="api/parmed/parmed.tools.html#module-parmed.tools" title="parmed.tools"><code class="xref py py-mod docutils literal notranslate"><span class="pre">parmed.tools</span></code></a> from the ParmEd API when
available, as those classes ensure that the raw data and topology objects
are always synchronized when the action completes.</p></li>
<li><p>Feel free to use the <a class="reference internal" href="api/parmed/parmed.tools.actions.html#parmed.tools.actions.Action" title="parmed.tools.actions.Action"><code class="xref py py-class docutils literal notranslate"><span class="pre">Action</span></code></a>
classes as examples for working with an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a>.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method name</p></th>
<th class="head"><p>Synchronization functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_atom_info" title="parmed.amber.AmberParm.load_atom_info"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.load_atom_info()</span></code></a></p></td>
<td><p>Loads the atom properties from <code class="docutils literal notranslate"><span class="pre">parm_data</span></code> to the <code class="docutils literal notranslate"><span class="pre">atoms</span></code> array</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_structure" title="parmed.amber.AmberParm.load_structure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.load_structure()</span></code></a></p></td>
<td><p>Loads all parameter/topology data structures from the information in <code class="docutils literal notranslate"><span class="pre">parm_data</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.remake_parm()</span></code></a></p></td>
<td><p>Flushes all changes to the parameter/topology data structures to the raw <code class="docutils literal notranslate"><span class="pre">parm_data</span></code> dict</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="an-example">
<h3>An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">Â¶</a></h3>
<p>An example of the warnings described here is illustrated below, showing how the
raw data and parameter/topology data structures can become out-of-sync and lead
to potential errors (like above, we use <code class="docutils literal notranslate"><span class="pre">trx.prmtop</span></code> from the ParmEd test
suite, <a class="reference external" href="http://github.com/swails/ParmEd/tree/master/test/files/trx.prmtop">available here</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span> <span class="o">=</span> <span class="n">AmberParm</span><span class="p">(</span><span class="s1">&#39;trx.prmtop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="s1">&#39;NATOM&#39;</span><span class="p">)</span>
<span class="go">1654</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
<span class="go">1654</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;N&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;N&#39;</span>
</pre></div>
</div>
<p>Notice how the number of atoms according to the raw data <code class="docutils literal notranslate"><span class="pre">POINTERS</span></code> array
matches the total number of atoms in the structure, and that the names of the
atoms match between the raw data and <code class="xref py py-class docutils literal notranslate"><span class="pre">Atom</span></code>
instances.  Now letâs see what happens if we modify our atom name and pop our
last atom off the structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">&lt;Atom OXT [-1]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
<span class="go">1653</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="s1">&#39;natom&#39;</span><span class="p">)</span>
<span class="go">1654</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;New&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;N&#39;</span>
</pre></div>
</div>
<p>Here we can clearly see that the raw data is not being updated with the changes
we are making to our structure.  Now letâs use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.remake_parm()</span></code></a> to
synchronize the raw data with the parameter/topology changes we are making:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">remake_parm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
<span class="go">1653</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="s1">&#39;natom&#39;</span><span class="p">)</span>
<span class="go">1653</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;New&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;New&#39;</span>
</pre></div>
</div>
<p>They match again. Whew! This goes both ways, though. Letâs modify some of the
raw data, and see how it does not propagate up to the parameter/topology data
structures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&#39;H1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Hey&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;H1&#39;</span>
</pre></div>
</div>
<p>Just like with modifying the parameter/topology objects, the changes to the raw
data do not propagate. You need to use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_atom_info" title="parmed.amber.AmberParm.load_atom_info"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.load_atom_info()</span></code></a> (if you
made modifications to arrays that were <em>not</em> atomic property arrays, you need to
use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_structure" title="parmed.amber.AmberParm.load_structure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AmberParm.load_structure()</span></code></a>, but this is more expensive and arrays that
are not atomic properties are <em>much</em> harder to directly modify correctly):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">load_atom_info</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s1">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&#39;Hey&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;Hey&#39;</span>
</pre></div>
</div>
<p>Hopefully this little demonstration showed you the pitfalls of modifying an
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a> instance (or one of its subclasses), and shows you how to do
it the <em>right</em> way. But be careful! These classes give you plenty of rope to
hang yourself with.</p>
</div>
<div class="section" id="generalizing-with-loadparm">
<h3>Generalizing with <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><code class="xref py py-func docutils literal notranslate"><span class="pre">LoadParm()</span></code></a><a class="headerlink" href="#generalizing-with-loadparm" title="Permalink to this headline">Â¶</a></h3>
<p>If you use the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a>, <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChamberParm</span></code></a>, or <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmoebaParm</span></code></a>
classes directly, you need to know <em>which</em> flavor of topology file you have, or
you will get numerous errors.</p>
<p>In cases where you <em>donât</em> know a priori what kind of topology file to expect,
you can use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><code class="xref py py-func docutils literal notranslate"><span class="pre">LoadParm()</span></code></a> (with exactly the same semantics as the class
constructors), but the return type will always be the right kind (based on the
flags present in the prmtop file).</p>
<p>For example, letâs try it on <code class="docutils literal notranslate"><span class="pre">trx.prmtop</span></code> (an Amber prmtop file) and
<code class="docutils literal notranslate"><span class="pre">dhfr_cmap_pbc.parm7</span></code> (a Chamber prmtop file), both available in the ParmEd
test suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">trxparm</span> <span class="o">=</span> <span class="n">LoadParm</span><span class="p">(</span><span class="s1">&#39;trx.prmtop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dhfrparm</span> <span class="o">=</span> <span class="n">LoadParm</span><span class="p">(</span><span class="s1">&#39;dhfr_cmap_pbc.parm7&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">trxparm</span><span class="p">)</span> <span class="c1"># see that this is an AmberParm</span>
<span class="go">&lt;class &#39;parmed.amber._amberparm.AmberParm&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">dhfrparm</span><span class="p">)</span> <span class="c1"># see that this is a ChamberParm</span>
<span class="go">&lt;class &#39;parmed.amber._chamberparm.ChamberParm&#39;&gt;</span>
</pre></div>
</div>
<p>You may ask âwhy donât I always use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><code class="xref py py-func docutils literal notranslate"><span class="pre">LoadParm()</span></code></a>?â  And the answer is, âyou
could.â  But perhaps you only want to accept a certain flavor of prmtop
fileâthe default constructors provide a more reliable error mechanism.
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><code class="xref py py-func docutils literal notranslate"><span class="pre">LoadParm()</span></code></a> is also marginally slower (but not much!), because it first
instantiates an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberFormat</span></code></a>, checks the available flags, and then takes
a view of that class in the format of the correct <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a> variant.
Note that no data is explicitly <em>copied</em> during this conversion, though.</p>
</div>
</div>
<div class="section" id="the-coordinate-and-trajectory-files">
<h2>The coordinate and trajectory files<a class="headerlink" href="#the-coordinate-and-trajectory-files" title="Permalink to this headline">Â¶</a></h2>
<p>ParmEd also supplies classes for parsing all of the various formats of Amber
coordinate files, including both restarts and trajectories (in both ASCII and
NetCDF format). If <code class="docutils literal notranslate"><span class="pre">numpy</span></code> is available, all coordinates, velocities, and/or
forces are added to <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays. If not, <code class="docutils literal notranslate"><span class="pre">array.array</span></code> is the return
object. These classes have <em>very</em> different APIs, so the onus is on you to
only use these arrays as <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays if you are sure <code class="docutils literal notranslate"><span class="pre">numpy</span></code> is
available. (Since all NetCDF-capable libraries are built on <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, this
warning really only applies to ASCII filesâ¦ see below).</p>
<p>Note that the <a class="reference internal" href="api/parmed/parmed.amber.html#module-parmed.amber" title="parmed.amber"><code class="xref py py-mod docutils literal notranslate"><span class="pre">parmed.amber</span></code></a> package needs some help from third-party
packages to read NetCDF-format files.  For more information on NetCDF support,
see the last section of this page.</p>
<p>The corresponding classes are:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Rst7</span></code></a>([filename,Â natom,Â title,Â time])</p></td>
<td><p>Amber input coordinate (or restart coordinate) file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberAsciiRestart" title="parmed.amber.AmberAsciiRestart"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AmberAsciiRestart</span></code></a>(fname[,Â mode,Â natom,Â â¦])</p></td>
<td><p>Parser for the Amber ASCII inpcrd/restart file format</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFRestart" title="parmed.amber.NetCDFRestart"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NetCDFRestart</span></code></a>(fname[,Â mode])</p></td>
<td><p>Class to read or write NetCDF restart files</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NetCDFTraj</span></code></a>(fname[,Â mode])</p></td>
<td><p>Class to read or write NetCDF restart files</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AmberMdcrd</span></code></a>(fname,Â natom,Â hasbox[,Â mode,Â title])</p></td>
<td><p>A class to parse Amber ASCII trajectory files.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="inpcrd-and-restart-files">
<h3>Inpcrd and Restart files<a class="headerlink" href="#inpcrd-and-restart-files" title="Permalink to this headline">Â¶</a></h3>
<p>The main class that deals with this is the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rst7</span></code></a> class.  This class will
automatically detect the file format of any inpcrd/restart file, and whether
velocities and/or unit cell information is present.  There are 2 ways you can
instantiate a Rst7.</p>
<p>To read a restart file, provide a filename to the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rst7</span></code></a> constructor. If
you plan on setting the data in order to <em>write</em> a restart file, you should
provide the argument <code class="docutils literal notranslate"><span class="pre">natom</span></code> to the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rst7</span></code></a> constructor. Examples using
the NetCDF restart file <code class="docutils literal notranslate"><span class="pre">ncinpcrd.rst7</span></code> from the ParmEd unit tests are shown
below (you are, of course, free to use an ASCII restart file instead):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Read an Amber NetCDF restart file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span> <span class="o">=</span> <span class="n">Rst7</span><span class="p">(</span><span class="s2">&quot;ncinpcrd.rst7&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">natom</span>
<span class="go">2101</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">array([ 6.82122493,  6.62762507, -8.51669   ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">vels</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">array([-2.87565556, -3.02095312,  3.73882771])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">box</span>
<span class="go">array([  30.2642725,   30.2642725,   30.2642725,  109.471219 ,</span>
<span class="go">        109.471219 ,  109.471219 ])</span>
</pre></div>
</div>
<p>For OpenMM, coordinates and velocities need to have a specific shape as well as
units (since the OpenMM core unit system is different than the one used by
Amber). To facilitate this, the <code class="docutils literal notranslate"><span class="pre">positions</span></code>, <code class="docutils literal notranslate"><span class="pre">velocities</span></code>, and
<code class="docutils literal notranslate"><span class="pre">box_vectors</span></code> attributes of the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rst7</span></code></a> class satisfy this requirement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Quantity(value=array([ 6.82122493,  6.62762507, -8.51669   ]), unit=angstrom)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Quantity(value=array([-2.87565556, -3.02095312,  3.73882771]), unit=angstrom/picosecond)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ncrst</span><span class="o">.</span><span class="n">box_vectors</span><span class="p">))</span> <span class="c1"># Prettier printing</span>
<span class="go">Quantity(value=[30.264272500000001, 0.0, 0.0], unit=angstrom)</span>
<span class="go">Quantity(value=[-10.088090019353215, 28.533430037688813, 0.0], unit=angstrom)</span>
<span class="go">Quantity(value=[-10.088090019353215, -13.45078642114427, 25.164120774794483], unit=angstrom)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rst7</span></code></a> class uses the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberAsciiRestart" title="parmed.amber.AmberAsciiRestart"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberAsciiRestart</span></code></a> and
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFRestart" title="parmed.amber.NetCDFRestart"><code class="xref py py-class docutils literal notranslate"><span class="pre">NetCDFRestart</span></code></a> classes internally with a much simpler interface. Unless
you need the flexibility afforded by the raw classes, you are encouraged to use
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rst7</span></code></a> instead.</p>
<p>Writing a restart file is easy as well.  If you provide velocities, velocities
will be written.  If you supply unit cell dimensions, unit cell dimensions will
be written.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span> <span class="o">=</span> <span class="n">Rst7</span><span class="p">(</span><span class="n">natom</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;new_rst7.ncrst&#39;</span><span class="p">,</span> <span class="n">netcdf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Write NetCDF format</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;new_rst7.rst7&#39;</span><span class="p">)</span>               <span class="c1"># Write ASCII format</span>
</pre></div>
</div>
<p>After this short script, you will have two coordinate files, one in NetCDF
format (<code class="docutils literal notranslate"><span class="pre">new_rst7.ncrst</span></code>) and one in ASCII format (<code class="docutils literal notranslate"><span class="pre">new_rst7.rst7</span></code>) with the
same (fake) coordinates. You can use <code class="docutils literal notranslate"><span class="pre">ncdump</span></code> to print the contents of the
NetCDF file to compare, if you wish.</p>
</div>
<div class="section" id="trajectory-files">
<h3>Trajectory files<a class="headerlink" href="#trajectory-files" title="Permalink to this headline">Â¶</a></h3>
<p>Amber generates two different formats of trajectory files: <em>NetCDF</em> trajectory
files and a standardized ASCII-format (raw text) trajectory files. The
<a class="reference internal" href="api/parmed/parmed.html#module-parmed" title="parmed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">parmed</span></code></a> package contains classes that support both formats, described
below:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AmberMdcrd</span></code></a>(fname,Â natom,Â hasbox[,Â mode,Â title])</p></td>
<td><p>A class to parse Amber ASCII trajectory files.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NetCDFTraj</span></code></a>(fname[,Â mode])</p></td>
<td><p>Class to read or write NetCDF restart files</p></td>
</tr>
</tbody>
</table>
<p>First we will discuss the ASCII trajectory file (<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberMdcrd</span></code></a>). We will
first demonstrate how to <em>parse</em> an existing mdcrd file, then we will
demonstrate how to <em>write</em> a new one.</p>
<p>You must specifyâfor both an existing mdcrd and one that you wish to
createâthe total number of atoms specified by the system and whether or not
the trajectory will contain unit cell dimensions.  The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.coordinates" title="parmed.amber.AmberMdcrd.coordinates"><code class="xref py py-meth docutils literal notranslate"><span class="pre">coordinates</span></code></a> method, which takes as an optional argument a frame
number, returns either all or just the requested coordinates. The analogous
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.box" title="parmed.amber.AmberMdcrd.box"><code class="xref py py-meth docutils literal notranslate"><span class="pre">box</span></code></a> method returns the unit cell lengths. The example
below uses the file <code class="docutils literal notranslate"><span class="pre">tz2.truncoct.crd</span></code> from the ParmEd unit tests, which has
5827 atoms and box lengths:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">AmberMdcrd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span> <span class="o">=</span> <span class="n">AmberMdcrd</span><span class="p">(</span><span class="s1">&#39;tz2.truncoct.crd&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="o">=</span><span class="mi">5827</span><span class="p">,</span> <span class="n">hasbox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 0.078,  3.174, -8.844, ...,  2.178, -5.224,  8.991])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">())</span> <span class="c1"># number of total frames</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(17481,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">5827</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c1"># It is a numpy array</span>
<span class="go">array([[ 0.078,  3.174, -8.844],</span>
<span class="go">       [ 0.999,  3.431, -8.521],</span>
<span class="go">       [-0.183,  2.306, -8.398],</span>
<span class="go">       ...,</span>
<span class="go">       [ 1.761, -6.031,  8.689],</span>
<span class="go">       [ 2.047, -6.123,  7.781],</span>
<span class="go">       [ 2.178, -5.224,  8.991]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 42.439,  42.439,  42.439])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">crd</span><span class="o">.</span><span class="n">box</span><span class="p">())</span> <span class="c1"># Should also be the number of frames</span>
<span class="go">10</span>
</pre></div>
</div>
<p>When you are writing an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberMdcrd</span></code></a> file, you need to use the methods
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.add_coordinates" title="parmed.amber.AmberMdcrd.add_coordinates"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_coordinates</span></code></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.add_box" title="parmed.amber.AmberMdcrd.add_box"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_box</span></code></a> instead of <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.coordinates" title="parmed.amber.AmberMdcrd.coordinates"><code class="xref py py-meth docutils literal notranslate"><span class="pre">coordinates</span></code></a>
and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.box" title="parmed.amber.AmberMdcrd.box"><code class="xref py py-meth docutils literal notranslate"><span class="pre">box</span></code></a>, as shown in the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">AmberMdcrd</span>
<span class="n">crd</span> <span class="o">=</span> <span class="n">AmberMdcrd</span><span class="p">(</span><span class="s1">&#39;new.mdcrd&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">hasbox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="c1"># Add the first frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># Add the second frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
<span class="c1"># Close the file</span>
<span class="n">crd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>You should be able to open the file <code class="docutils literal notranslate"><span class="pre">new.mdcrd</span></code> and see 90 numbers spread over
9 lines (10 numbers per line), then a line with the three box dimensions,
followed by 9 more lines with 90 total numbers and another line with box
dimensions.</p>
<p>Now I will demonstrate the use of the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><code class="xref py py-class docutils literal notranslate"><span class="pre">NetCDFTraj</span></code></a> class, which is
designed to be very similar to the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberMdcrd</span></code></a> class. Creating an
instance is different, but querying and adding coordinates (and unit cell
dimensions, velocities, and forces) is done in the same way.</p>
<p>To parse an existing NetCDF trajectory, use the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.open_old" title="parmed.amber.NetCDFTraj.open_old"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_old</span></code></a> constructor. To write a new one, use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.open_new" title="parmed.amber.NetCDFTraj.open_new"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_new</span></code></a>. An example parsing an existing NetCDF trajectory (using
the <code class="docutils literal notranslate"><span class="pre">tz2.truncoct.nc</span></code> file in the ParmEd unit tests) is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">NetCDFTraj</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span> <span class="o">=</span> <span class="n">NetCDFTraj</span><span class="o">.</span><span class="n">open_old</span><span class="p">(</span><span class="s1">&#39;tz2.truncoct.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">atom</span>  <span class="c1"># number of atoms in the file</span>
<span class="go">5827</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">frame</span> <span class="c1"># number of frames currently in the file</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 0.07762779,  3.1744082 , -8.84385777, ...,  2.17817903,</span>
<span class="go">       -5.22395372,  8.99102497], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="go">array([ 0.33575553,  4.19061375, -9.66586971, ...,  2.48203635,</span>
<span class="go">       -3.30589318,  8.45326519], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([  42.43884853,   42.43884853,   42.43884853,  109.471219  ,</span>
<span class="go">        109.471219  ,  109.471219  ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="go">array([  42.42843203,   42.42843203,   42.42843203,  109.471219  ,</span>
<span class="go">        109.471219  ,  109.471219  ])</span>
</pre></div>
</div>
<p>One thing youâll notice is that the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><code class="xref py py-class docutils literal notranslate"><span class="pre">NetCDFTraj</span></code></a> class has the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">atom</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">frame</span></code> attributes
that indicate how many atoms are in the trajectory and how many frames are
present. Furthermore, unlike the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberMdcrd</span></code></a> formatâwhich stores only
the unit cell lengthsâthe <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><code class="xref py py-class docutils literal notranslate"><span class="pre">NetCDFTraj</span></code></a> stores both unit cell lengths
<em>and</em> angles.</p>
<p>Furthermore, velocities and forces can be saved in NetCDF trajectory files,
allowing you to extract them with the analogous <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.velocities" title="parmed.amber.NetCDFTraj.velocities"><code class="xref py py-meth docutils literal notranslate"><span class="pre">velocities</span></code></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.forces" title="parmed.amber.NetCDFTraj.forces"><code class="xref py py-meth docutils literal notranslate"><span class="pre">forces</span></code></a> methods.
Likewise, you can set them with <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.add_velocities" title="parmed.amber.NetCDFTraj.add_velocities"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_velocities</span></code></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.add_forces" title="parmed.amber.NetCDFTraj.add_forces"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_forces</span></code></a>.</p>
<p>An example of writing a NetCDF trajectory (with velocities and forces) is shown
below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">NetCDFTraj</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Open the NetCDF trajectory file for writing</span>
<span class="n">crd</span> <span class="o">=</span> <span class="n">NetCDFTraj</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="s1">&#39;new_crd.nc&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">crds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">frcs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Add random coordinates, velocities, and forces for first frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_velocities</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_forces</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
<span class="c1"># Add random second frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_velocities</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_forces</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
<span class="c1"># Close the file</span>
<span class="n">crd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>As an exercise, try using <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.open_old" title="parmed.amber.NetCDFTraj.open_old"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NetCDFTraj.open_old()</span></code></a> to check the contents of
<code class="docutils literal notranslate"><span class="pre">new_crd.nc</span></code> and verify that it contains the information you expect.</p>
</div>
</div>
<div class="section" id="reading-and-writing-netcdf-files">
<h2>Reading and writing NetCDF files<a class="headerlink" href="#reading-and-writing-netcdf-files" title="Permalink to this headline">Â¶</a></h2>
<p>NetCDFâstanding for <em>Net</em>work <em>C</em>ommon <em>D</em>ata <em>F</em>ormatâis a binary
file format that is flexible, portable (i.e., between <a class="reference external" href="http://en.wikipedia.org/wiki/Endianness">big endian and little
endian</a>), and extensible (i.e., you
can extend a file convention to include more data <em>without</em> breaking existing
parsers).</p>
<p>Python cannot read NetCDF files without the support of an external package. In
particular, the following packages provide Python bindings to the NetCDF API:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><a class="reference external" href="http://www.scipy.org/">scipy</a></p></li>
<li><p><a class="reference external" href="https://github.com/Unidata/netcdf4-python">netCDF4</a></p></li>
<li><p><a class="reference external" href="http://dirac.cnrs-orleans.fr/plone/software/scientificpython/">ScientificPython</a></p></li>
</ol>
</div></blockquote>
<p>All three of these files provide similar, although not identical interfaces. The
ParmEd API supports all three NetCDF backends. You can swap out backends at any
time using the <code class="xref py py-func docutils literal notranslate"><span class="pre">use</span></code> function. If you do
not choose one, one will be picked automatically based on the available
packages.  If several of those packages are available, the first one in the
above list that is available will be picked.</p>
<p>For most users, simply ensuring that at least one of the above packages is
available and working and using the default will suffice. For the other small
percentage that may want more fine-grained control, the <code class="xref py py-func docutils literal notranslate"><span class="pre">use</span></code> function will let you specify a particular
implementation to use.  You can change the back-end at any time, but note that
the behavior of a NetCDF object <em>created</em> with one implementation is undefined
if you switch to a different one. So you are cautioned against switching NetCDF
implementations when open NetCDF file handles are still open.</p>
<p>An example of switching between NetCDF implementations is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">netcdffiles</span>
<span class="c1"># Use the default NetCDF package (if one is already selected,</span>
<span class="c1"># this does nothing)</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">()</span> <span class="c1"># You can also pass &quot;None&quot;</span>
<span class="c1"># Use scipy for NetCDF files</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;scipy&#39;</span><span class="p">)</span>
<span class="c1"># Use ScientificPython for NetCDF files</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Scientific&#39;</span><span class="p">)</span> <span class="c1"># Can also be ScientificPython</span>
<span class="c1"># Use netCDF4</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="amber-mask-syntax">
<h2>Amber mask syntax<a class="headerlink" href="#amber-mask-syntax" title="Permalink to this headline">Â¶</a></h2>
<p>The Amber programs use a selection syntax very similar to Chimeraâs selection
syntax, referred to as an <em>Amber mask</em>. The character <code class="docutils literal notranslate"><span class="pre">:</span></code> is used for residue
selections and <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> is used for atom selections.  Both numbers and names are
supported in the atom and residue selections (where the serial numbers range
from 1 to <em>N</em>, where <em>N</em> is either the total number of atoms or residues,
depending on what is being selected).</p>
<p>The atom/residue name or number list can be specified as a comma-delimited list
of entries (<em>inclusive</em> number ranges are also supported).  You can also use
logical operators <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (and), <code class="docutils literal notranslate"><span class="pre">|</span></code> (or), and <code class="docutils literal notranslate"><span class="pre">!</span></code> (not) and group expressions
with parenthesis to denote order-of-operations.</p>
<div class="section" id="residue-selections">
<h3>Residue selections<a class="headerlink" href="#residue-selections" title="Permalink to this headline">Â¶</a></h3>
<p>Examples of residue selections, accompanied by comments annotating what is being
selected, is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="mi">10</span>    <span class="n">Select</span> <span class="n">residues</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="ow">and</span> <span class="mi">10</span>
<span class="p">:</span><span class="n">ALA</span><span class="p">,</span><span class="n">LYS</span><span class="p">,</span><span class="mi">10</span>  <span class="n">Select</span> <span class="nb">all</span> <span class="n">residues</span> <span class="k">with</span> <span class="n">names</span> <span class="n">ALA</span> <span class="ow">or</span> <span class="n">LYS</span><span class="p">,</span> <span class="ow">and</span> <span class="n">residue</span> <span class="mi">10</span>
<span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="mi">10</span>    <span class="n">Select</span> <span class="n">residues</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="ow">and</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="section" id="atom-selections">
<h3>Atom selections<a class="headerlink" href="#atom-selections" title="Permalink to this headline">Â¶</a></h3>
<p>Examples of residue selections, accompanied by comments annotating what is being
selected, is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">@</span><span class="mi">1</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="o">-</span><span class="mi">160</span>   <span class="n">Select</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">100</span> <span class="n">atoms</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">the</span> <span class="mi">11</span> <span class="n">atoms</span> <span class="mi">150</span><span class="o">-</span><span class="mi">160</span>
<span class="nd">@CA</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="mi">10</span><span class="o">-</span><span class="mi">15</span>      <span class="n">Select</span> <span class="nb">all</span> <span class="n">atoms</span> <span class="n">whose</span> <span class="n">names</span> <span class="n">are</span> <span class="n">CA</span> <span class="ow">or</span> <span class="n">C</span><span class="p">,</span> <span class="ow">and</span> <span class="mi">6</span> <span class="n">atoms</span> <span class="mi">10</span><span class="o">-</span><span class="mi">15</span>
</pre></div>
</div>
</div>
<div class="section" id="atom-element-selections">
<h3>Atom element selections<a class="headerlink" href="#atom-element-selections" title="Permalink to this headline">Â¶</a></h3>
<p>You can select all residues that are a specific <em>element</em> if you want to.
Examples are shown below, accompanied by comments annotating what is being
selected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">@/</span><span class="n">C</span>          <span class="n">Select</span> <span class="nb">all</span> <span class="n">carbon</span> <span class="n">atoms</span>
<span class="o">@/</span><span class="n">H</span>          <span class="n">Select</span> <span class="nb">all</span> <span class="n">hydrogen</span> <span class="n">atoms</span>
<span class="o">@/</span><span class="n">C</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">S</span>  <span class="n">Select</span> <span class="nb">all</span> <span class="n">carbon</span><span class="p">,</span> <span class="n">nitrogen</span><span class="p">,</span> <span class="n">oxygen</span><span class="p">,</span> <span class="n">hydrogen</span><span class="p">,</span> <span class="ow">and</span> <span class="n">sulfur</span> <span class="n">atoms</span>
<span class="o">@/</span><span class="n">Fe</span>         <span class="n">Select</span> <span class="nb">all</span> <span class="n">iron</span> <span class="n">atoms</span>
</pre></div>
</div>
<p>Be careful, though!  These element names are case-sensitive, and bad element
names will cause the mask parser to raise an exception.</p>
</div>
<div class="section" id="atom-type-selections">
<h3>Atom type selections<a class="headerlink" href="#atom-type-selections" title="Permalink to this headline">Â¶</a></h3>
<p>In some cases, it is more succinct to select by atom <em>type</em> name, rather than
atom name. Be careful though! Atom type names can change from force field to
force field, and are considered an implementation detail.  While atom <em>names</em>
should never change (and are based on the PDB standard, typically), atom <em>type</em>
names can be set and/or changed to whatever the force field developer wants.</p>
<p>You have been warned. If you wish to push on, though, you can use the <code class="docutils literal notranslate"><span class="pre">&#64;%</span></code>
characters to select from type names rather than atom names. Note, no indices
(or index ranges) can be used, as atom types have no defined order.  Examples
are shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">@%</span><span class="n">CT</span><span class="p">,</span><span class="n">CX</span>         <span class="n">Select</span> <span class="nb">all</span> <span class="n">atoms</span> <span class="n">whose</span> <span class="n">types</span> <span class="n">are</span> <span class="n">CT</span> <span class="ow">or</span> <span class="n">CX</span>
</pre></div>
</div>
</div>
<div class="section" id="logical-operators">
<h3>Logical operators<a class="headerlink" href="#logical-operators" title="Permalink to this headline">Â¶</a></h3>
<p>You often want to select certain atoms from certain residues. You can use the
<code class="docutils literal notranslate"><span class="pre">&amp;</span></code> binary operator to do this, as shown in examples below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(:</span><span class="mi">1</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="nd">@CA</span><span class="p">)</span>      <span class="n">Selects</span> <span class="n">atoms</span> <span class="n">named</span> <span class="n">CA</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">100</span> <span class="n">residues</span>
<span class="p">(:</span><span class="mi">1</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="nd">@CA</span><span class="p">,</span><span class="n">CB</span><span class="p">)</span>   <span class="n">Selects</span> <span class="n">atoms</span> <span class="n">named</span> <span class="n">CA</span> <span class="ow">or</span> <span class="n">CB</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">100</span> <span class="n">residues</span>
<span class="p">(:</span><span class="n">ASP</span><span class="p">,</span><span class="n">GLU</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="nd">@CA</span><span class="p">)</span>    <span class="n">Selects</span> <span class="n">atoms</span> <span class="n">named</span> <span class="n">CA</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">ASP</span> <span class="ow">or</span> <span class="n">GLU</span> <span class="n">residues</span>
</pre></div>
</div>
<p>This is so common, you can use a simple shortcut, demonstrated below, giving
equivalent expressions to the examples above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">100</span><span class="nd">@CA</span>
<span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">100</span><span class="nd">@CA</span><span class="p">,</span><span class="n">CB</span>
<span class="p">:</span><span class="n">ASP</span><span class="p">,</span><span class="n">GLU</span><span class="nd">@CA</span>
</pre></div>
</div>
<p>You can also expand your selection using the <code class="docutils literal notranslate"><span class="pre">|</span></code> (or) operator. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">100</span><span class="o">|</span><span class="nd">@CA</span>      <span class="n">Selects</span> <span class="nb">all</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">100</span> <span class="n">residues</span> <span class="n">AND</span> <span class="nb">all</span> <span class="n">atoms</span> <span class="n">named</span> <span class="n">CA</span>
</pre></div>
</div>
<p>Donât get confused between what the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (and) and <code class="docutils literal notranslate"><span class="pre">|</span></code> (or) operators do.
The above example selects all atoms if it satisfies the criteria of being in the
first 100 residues <em>or</em> if it satisfies the criteria of having the name <code class="docutils literal notranslate"><span class="pre">CA</span></code>,
meaning it selects all atoms in the first 100 residues <em>and</em> all atoms named
<code class="docutils literal notranslate"><span class="pre">CA</span></code>.</p>
<p>You can also select all atoms <em>except</em> a particular selection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!(:LIG)         Selects all atoms that are NOT in a residue named LIG
</pre></div>
</div>
</div>
<div class="section" id="wild-cards">
<h3>Wild-cards<a class="headerlink" href="#wild-cards" title="Permalink to this headline">Â¶</a></h3>
<p>Letâs suppose you want to select all hydrogen atoms. These atoms usually have
many names, but they almost always start with âHâ, so we would like a way to
select all atoms that start with the letter âHâ.  We can do this with
<em>wild-cards</em>, which is the <code class="docutils literal notranslate"><span class="pre">=</span></code> character in Amber masks, and works for both
atoms and residues. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">AS</span><span class="o">=</span><span class="nd">@H</span><span class="o">=</span>   <span class="n">Select</span> <span class="nb">all</span> <span class="n">atoms</span> <span class="n">whose</span> <span class="n">residue</span> <span class="n">starts</span> <span class="k">with</span> <span class="n">AS</span> <span class="n">AND</span> <span class="n">atom</span> <span class="n">name</span> <span class="n">starts</span> <span class="k">with</span> <span class="n">H</span>
</pre></div>
</div>
</div>
<div class="section" id="distance-based-selections">
<h3>Distance-based selections<a class="headerlink" href="#distance-based-selections" title="Permalink to this headline">Â¶</a></h3>
<p>Sometimes you also want to be able to select all atoms within a certain distance
(or all atoms within a <em>residue</em> that is a certain distance) from a specific set
of atoms.  For this, the <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> operators are used to denote distances
that are less than or greater than a particular value, respectively.</p>
<p>This is probably the most complex part of the Amber mask syntax, but it is also
quite powerful.  In addition to the <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> operators, you must use
either <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> or <code class="docutils literal notranslate"><span class="pre">:</span></code> to indicate whether you want to select individual <em>atoms</em>
or whole <em>residues</em> satisfying the distance.  When selecting residues, the whole
residue is selected if <em>any atom</em> satisfies the distance criteria.  The general
syntax is <code class="docutils literal notranslate"><span class="pre">SELECTION&lt;:DISTANCE</span></code>, where <code class="docutils literal notranslate"><span class="pre">SELECTION</span></code> is an Amber mask (<code class="docutils literal notranslate"><span class="pre">:</span></code>
can also be <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> to select only atoms), and <code class="docutils literal notranslate"><span class="pre">DISTANCE</span></code> is a floating point
distance that defines the criteria.  Examples are shown below with annotations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="mi">8</span><span class="o">&lt;@</span><span class="mf">5.0</span>     <span class="n">All</span> <span class="n">atoms</span> <span class="n">that</span> <span class="n">are</span> <span class="n">LESS</span> <span class="n">THAN</span> <span class="mi">5</span> <span class="n">Angstroms</span> <span class="n">away</span> <span class="kn">from</span> <span class="nn">any</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span> <span class="mi">8</span>
<span class="p">:</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span><span class="mf">10.0</span>    <span class="n">All</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">any</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">one</span> <span class="n">atom</span> <span class="ow">is</span> <span class="n">MORE</span> <span class="n">THAN</span> <span class="mi">10</span> <span class="n">angstroms</span> <span class="n">away</span> <span class="kn">from</span> <span class="nn">residue</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="amberobj/parmed.amber.AmberFormat.html" class="btn btn-neutral float-right" title="parmed.amber.AmberFormat" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fileio/parmed.formats.registry.load_file.html" class="btn btn-neutral float-left" title="parmed.formats.registry.load_file" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2015, Jason Swails

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>