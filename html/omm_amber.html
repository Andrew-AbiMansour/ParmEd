

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running OpenMM Simulation with AMBER Files &mdash; ParmEd  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples using CHARMM Files" href="omm_charmm.html" />
    <link rel="prev" title="parmed.openmm.energy_decomposition" href="openmmobj/parmed.openmm.energy_decomposition.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ParmEd
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.3319.g7a6168d
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="topologyobjects.html">Core classes used to represent topologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">The core Structure class</a></li>
<li class="toctree-l1"><a class="reference internal" href="dimensional_analysis.html">Working with units</a></li>
<li class="toctree-l1"><a class="reference internal" href="readwrite.html">Reading and writing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="amber.html">The Amber file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="charmm.html">The CHARMM file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="gromacs.html">The GROMACS file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="rosetta.html">PyRosetta Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="parmed.html">Using <code class="docutils literal notranslate"><span class="pre">parmed</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="parmed.html#using-xparmed">Using <code class="docutils literal notranslate"><span class="pre">xparmed</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="parmed_api.html">The ParmEd API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="openmm.html">OpenMM Functionality</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="openmm.html#what-is-openmm">What is OpenMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="openmm.html#what-makes-openmm-so-awesome">What makes OpenMM so awesome?</a></li>
<li class="toctree-l2"><a class="reference internal" href="openmm.html#how-does-parmed-enhance-openmm">How does ParmEd enhance OpenMM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="openmm.html#loading-openmm-objects">Loading OpenMM Objects</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="openmm.html#examples">Examples</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Starting from AMBER prmtop and inpcrd files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generalized-born">Generalized Born</a></li>
<li class="toctree-l4"><a class="reference internal" href="#explicit-solvent">Explicit Solvent</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="omm_charmm.html">Starting from CHARMM PSF and coordinate files</a></li>
<li class="toctree-l3"><a class="reference internal" href="omm_gromacs.html">Starting from Gromacs TOP and GRO files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="openmm.html#taking-openmm-topology-and-system-to-a-parmed-structure">Taking OpenMM <code class="docutils literal notranslate"><span class="pre">Topology</span></code> and <code class="docutils literal notranslate"><span class="pre">System</span></code> to a ParmEd <code class="docutils literal notranslate"><span class="pre">Structure</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization Functionality</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ParmEd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="openmm.html">OpenMM Functionality</a> &raquo;</li>
        
      <li>Running OpenMM Simulation with AMBER Files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/omm_amber.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-openmm-simulation-with-amber-files">
<h1>Running OpenMM Simulation with AMBER Files<a class="headerlink" href="#running-openmm-simulation-with-amber-files" title="Permalink to this headline">¶</a></h1>
<p>There are popular ways to model biomolecular systems.  Because solvation effects
are often (always?) critically important to biological function, we need some
way to model the solvent.  The two popular approaches are to employ a continuum
model with a dielectric constant equal to that of the bulk solvent or to model
the solvent models directly in your system.  These two approaches are termed
_implicit_ and _explicit_ solvation, respectively.</p>
<p>The next 2 sections present examples using a Generalized Born implicit solvent
model and explicit solvent based on the TIP3P water model. All of the files and
examples here are included in the <code class="docutils literal notranslate"><span class="pre">examples/amber</span></code> directory of the ParmEd
release.</p>
<div class="section" id="generalized-born">
<h2>Generalized Born<a class="headerlink" href="#generalized-born" title="Permalink to this headline">¶</a></h2>
<p>For the purposes of this example, we are using an alanine pentapeptide. You can
find the following files that you will need for this demonstration in the
<code class="docutils literal notranslate"><span class="pre">examples/amber</span></code> directory of the ParmEd distribution:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ala5_gas.parm7</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ala5_gas.rst7</span></code></p></li>
</ul>
</div></blockquote>
<p>The following sample script (<code class="docutils literal notranslate"><span class="pre">simulate_amber_gb.py</span></code> in the ParmEd
distribution) will set up and run the simulation using OpenMM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># OpenMM Imports</span>
<span class="kn">import</span> <span class="nn">simtk.openmm</span> <span class="k">as</span> <span class="nn">mm</span>
<span class="kn">import</span> <span class="nn">simtk.openmm.app</span> <span class="k">as</span> <span class="nn">app</span>

<span class="c1"># ParmEd Imports</span>
<span class="kn">from</span> <span class="nn">parmed</span> <span class="kn">import</span> <span class="n">load_file</span><span class="p">,</span> <span class="n">unit</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">parmed.openmm</span> <span class="kn">import</span> <span class="n">StateDataReporter</span><span class="p">,</span> <span class="n">NetCDFReporter</span>

<span class="c1"># Load the Amber files</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading AMBER files...&#39;</span><span class="p">)</span>
<span class="n">ala5_gas</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="s1">&#39;ala5_gas.parm7&#39;</span><span class="p">,</span> <span class="s1">&#39;ala5_gas.rst7&#39;</span><span class="p">)</span>

<span class="c1"># Create the OpenMM system</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating OpenMM System&#39;</span><span class="p">)</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">ala5_gas</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">NoCutoff</span><span class="p">,</span>
                               <span class="n">constraints</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">HBonds</span><span class="p">,</span> <span class="n">implicitSolvent</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">GBn2</span><span class="p">,</span>
                               <span class="n">implicitSolventSaltConc</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">moles</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">liter</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create the integrator to do Langevin dynamics</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span>
                        <span class="mi">300</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>       <span class="c1"># Temperature of heat bath</span>
                        <span class="mf">1.0</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">,</span>  <span class="c1"># Friction coefficient</span>
                        <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="c1"># Time step</span>
<span class="p">)</span>

<span class="c1"># Define the platform to use; CUDA, OpenCL, CPU, or Reference. Or do not specify</span>
<span class="c1"># the platform to use the default (fastest) platform</span>
<span class="n">platform</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">Platform</span><span class="o">.</span><span class="n">getPlatformByName</span><span class="p">(</span><span class="s1">&#39;CUDA&#39;</span><span class="p">)</span>
<span class="n">prop</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">CudaPrecision</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">)</span> <span class="c1"># Use mixed single/double precision</span>

<span class="c1"># Create the Simulation object</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">ala5_gas</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

<span class="c1"># Set the particle positions</span>
<span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">ala5_gas</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>

<span class="c1"># Minimize the energy</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimizing energy&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">(</span><span class="n">maxIterations</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># Set up the reporters to report energies and coordinates every 100 steps</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">StateDataReporter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">kineticEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">NetCDFReporter</span><span class="p">(</span><span class="s1">&#39;ala5_gb.nc&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">crds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Run dynamics</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running dynamics&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>Now I’ll dissect the script to help you understand what is happening at each
step. We will divide the script into the sections following the <code class="docutils literal notranslate"><span class="pre">print</span></code>
statements that announce when each stage begins.</p>
<div class="section" id="loading-amber-files">
<h3>Loading Amber files<a class="headerlink" href="#loading-amber-files" title="Permalink to this headline">¶</a></h3>
<p>In this stage, we simply instantiate the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a> object from the input topology and coordinate
files. After this command, <code class="docutils literal notranslate"><span class="pre">ala5_gas</span></code> will contain a full description of every
particle, the parameters defining their interactions, and their positions.</p>
</div>
<div class="section" id="create-the-openmm-system">
<h3>Create the OpenMM System<a class="headerlink" href="#create-the-openmm-system" title="Permalink to this headline">¶</a></h3>
<p>This command creates an OpenMM <code class="docutils literal notranslate"><span class="pre">System</span></code> object from the information stored in
<code class="docutils literal notranslate"><span class="pre">ala5_gas</span></code>. It contains multiple <code class="docutils literal notranslate"><span class="pre">Force</span></code> instances for the bonds, angles,
periodic torsions, and nonbonded (electrostatic and van der Waals) interactions.
It is in this function that we define the potential parameters we want to use.
In this example, we have chosen the default values for each parameter except the
ones specified. In particular:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nonbondedMethod=app.NoCutoff</span></code> indicates we do not want to use a cutoff
for nonbonded interactions. If you wanted to use a cutoff, you could use
<code class="docutils literal notranslate"><span class="pre">app.CutoffNonPeriodic</span></code> instead (since this system does <em>not</em> use
periodic boundary conditions)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">constraints=app.HBonds</span></code> indicates we want to constrain all bonds in
which at least one atom is a Hydrogen (i.e., SHAKE or SETTLE for water).
Other options are <code class="docutils literal notranslate"><span class="pre">None</span></code> (no constraints), <code class="docutils literal notranslate"><span class="pre">app.AllBonds</span></code>, or
<code class="docutils literal notranslate"><span class="pre">app.HAngles</span></code>. For the most part, these are self-explanatory, but it is
worth noting that <code class="docutils literal notranslate"><span class="pre">app.HAngles</span></code> constrains all bonds and the distance
between the 1-3 pairs of angles in which one of those atoms is a hydrogen.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">implicitSolvent=app.GBn2</span></code> indicates we want to use the second GBneck
model described in Nguyen et al., J. Chem. Theory Comput., 2014 9(4) p.
2020-2034. Other options are <code class="docutils literal notranslate"><span class="pre">app.HCT</span></code>, <code class="docutils literal notranslate"><span class="pre">app.OBC1</span></code>, <code class="docutils literal notranslate"><span class="pre">app.OBC2</span></code>,
and <code class="docutils literal notranslate"><span class="pre">app.GBn</span></code>. These correspond to values of 1, 2, 5, 7 (and 8 for
<code class="docutils literal notranslate"><span class="pre">app.GBn2</span></code>) to the <code class="docutils literal notranslate"><span class="pre">igb</span></code> variable in AMBER input files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">implicitSolventSaltConc=0.1*u.liters/u.mole</span></code> indicates we want to model
a ca. 0.1 molar solution of monovalent ions using a Debye screening model.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="create-the-integrator-to-do-langevin-dynamics">
<h3>Create the integrator to do Langevin Dynamics<a class="headerlink" href="#create-the-integrator-to-do-langevin-dynamics" title="Permalink to this headline">¶</a></h3>
<p>In this stage we specify an integrator. Common choices are
<code class="docutils literal notranslate"><span class="pre">LangevinIntegrator</span></code> (as we’ve chosen here) to do simulations in the NVT
ensemble and <code class="docutils literal notranslate"><span class="pre">VerletIntegrator</span></code> that allows us to do simulations either at
constant energy or temperature if using the <code class="docutils literal notranslate"><span class="pre">AndersenThermostat</span></code>.  In this
example, we’ve chosen the Langevin integrator with a target temperature of
300 K, a friction coefficient of 1/ps and a time step of 2 fs.</p>
</div>
<div class="section" id="define-the-platform">
<h3>Define the platform<a class="headerlink" href="#define-the-platform" title="Permalink to this headline">¶</a></h3>
<p>In this stage, we define the platform we want to use. In this example, we have
chosen the <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> platform, but this may not be available on every machine
since it only runs on NVidia GPU hardware. Other choices are <code class="docutils literal notranslate"><span class="pre">OpenCL</span></code> (which
will run on a variety of GPUs including those made by AMD/ATI and CPUs), <code class="docutils literal notranslate"><span class="pre">CPU</span></code>
(which is an optimized version that runs natively on CPUs), and <code class="docutils literal notranslate"><span class="pre">Reference</span></code>
(often quite slow).</p>
<p>The properties can be set for each platform. In this case, we specified that we
wanted to use a <code class="docutils literal notranslate"><span class="pre">mixed</span></code> precision model (a good compromise between speed and
precision).</p>
</div>
<div class="section" id="create-the-simulation-object">
<h3>Create the <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object<a class="headerlink" href="#create-the-simulation-object" title="Permalink to this headline">¶</a></h3>
<p>This step creates a <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object that will be used to run the actual
simulations.  If we wanted OpenMM to simply pick the fastest platform for us
(rather than specify one directly), we could omit the <code class="docutils literal notranslate"><span class="pre">platform</span></code> and <code class="docutils literal notranslate"><span class="pre">prop</span></code>
arguments.</p>
</div>
<div class="section" id="set-the-particle-positions">
<h3>Set the particle positions<a class="headerlink" href="#set-the-particle-positions" title="Permalink to this headline">¶</a></h3>
<p>This stage is very important.  In this step, we set the particle positions
stored in the <code class="docutils literal notranslate"><span class="pre">ala5_gas</span></code> object to our object. If you omit this step, you can
get strange results or other errors like segmentation violations. These particle
positions have been parsed from the input coordinate file, although if you had a
PDB file you could use the OpenMM <code class="docutils literal notranslate"><span class="pre">PDBFile</span></code> object as a source of coordinates
instead.</p>
</div>
<div class="section" id="minimize-the-energy">
<h3>Minimize the energy<a class="headerlink" href="#minimize-the-energy" title="Permalink to this headline">¶</a></h3>
<p>This stage performs a basic energy minimization to relax particle positions.
This particular invocation will perform at most 500 iterations.</p>
</div>
<div class="section" id="set-up-the-reporters">
<h3>Set up the reporters<a class="headerlink" href="#set-up-the-reporters" title="Permalink to this headline">¶</a></h3>
<p>This stage defines reporters that will “report” on the status of the simulation
periodically throughout the simulation. The first is an <code class="docutils literal notranslate"><span class="pre">StateDataReporter</span></code>
which will print out a summary of energies and temperatures every 100 steps.
Unlike the <code class="docutils literal notranslate"><span class="pre">StateDataReporter</span></code> in OpenMM, this reporter prints values in the
AKMA unit system (Angstrom, Kilocalorie per mole, and atomic mass units). This
reporter directs the printout to standard output (the screen), <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code>
can be replaced with a different file-like object or a file name.</p>
<p>The second reporter is a NetCDF trajectory reporter, which is written in the
Amber NetCDF format.  You can also use the native <code class="docutils literal notranslate"><span class="pre">DCDReporter</span></code> reporter in
OpenMM to print DCD-format trajectories.</p>
</div>
<div class="section" id="running-dynamics">
<h3>Running dynamics<a class="headerlink" href="#running-dynamics" title="Permalink to this headline">¶</a></h3>
<p>This is the stage that actually runs the MD. In this case, we are running 10,000
steps of MD.  The wiki page with “Common recipes” has information regarding
running a long simulation in chunks.</p>
</div>
</div>
<div class="section" id="explicit-solvent">
<h2>Explicit Solvent<a class="headerlink" href="#explicit-solvent" title="Permalink to this headline">¶</a></h2>
<p>For the purposes of this example, we are using an alanine dipeptide solvated in
a box of water. You can find the following files that you will need for this
demonstration in the <code class="docutils literal notranslate"><span class="pre">examples/amber</span></code> directory of the ParmEd distribution:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ala2_solv.parm7</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ala2_solv.rst7</span></code></p></li>
</ul>
</div></blockquote>
<p>The following sample script (<code class="docutils literal notranslate"><span class="pre">simulate_amber_pme.py</span></code> in the ParmEd
distribution) will set up and run the simulation using OpenMM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># OpenMM Imports</span>
<span class="kn">import</span> <span class="nn">simtk.openmm</span> <span class="k">as</span> <span class="nn">mm</span>
<span class="kn">import</span> <span class="nn">simtk.openmm.app</span> <span class="k">as</span> <span class="nn">app</span>

<span class="c1"># ParmEd Imports</span>
<span class="kn">from</span> <span class="nn">parmed</span> <span class="kn">import</span> <span class="n">load_file</span><span class="p">,</span> <span class="n">unit</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">parmed.openmm</span> <span class="kn">import</span> <span class="n">StateDataReporter</span><span class="p">,</span> <span class="n">NetCDFReporter</span>

<span class="c1"># Load the Amber files</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading AMBER files...&#39;</span><span class="p">)</span>
<span class="n">ala2_solv</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="s1">&#39;ala2_solv.parm7&#39;</span><span class="p">,</span> <span class="s1">&#39;ala2_solv.rst7&#39;</span><span class="p">)</span>

<span class="c1"># Create the OpenMM system</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating OpenMM System&#39;</span><span class="p">)</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">ala2_solv</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">PME</span><span class="p">,</span>
                                <span class="n">nonbondedCutoff</span><span class="o">=</span><span class="mf">8.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">,</span>
                                <span class="n">constraints</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">HBonds</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create the integrator to do Langevin dynamics</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span>
                        <span class="mi">300</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>       <span class="c1"># Temperature of heat bath</span>
                        <span class="mf">1.0</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">,</span>  <span class="c1"># Friction coefficient</span>
                        <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="c1"># Time step</span>
<span class="p">)</span>

<span class="c1"># Define the platform to use; CUDA, OpenCL, CPU, or Reference. Or do not specify</span>
<span class="c1"># the platform to use the default (fastest) platform</span>
<span class="n">platform</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">Platform</span><span class="o">.</span><span class="n">getPlatformByName</span><span class="p">(</span><span class="s1">&#39;CUDA&#39;</span><span class="p">)</span>
<span class="n">prop</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">CudaPrecision</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">)</span> <span class="c1"># Use mixed single/double precision</span>

<span class="c1"># Create the Simulation object</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">ala2_solv</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

<span class="c1"># Set the particle positions</span>
<span class="n">sim</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">ala2_solv</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>

<span class="c1"># Minimize the energy</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimizing energy&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">(</span><span class="n">maxIterations</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># Set up the reporters to report energies and coordinates every 100 steps</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">StateDataReporter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">kineticEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NetCDFReporter</span><span class="p">(</span><span class="s1">&#39;ala2_solv.nc&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">crds</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Run dynamics</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running dynamics&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we’ll dissect the script to help you understand what is happening at each
step. We will divide the script into the sections following the <code class="docutils literal notranslate"><span class="pre">print</span></code>
statements that announce when each stage begins.</p>
<div class="section" id="id1">
<h3>Loading Amber files<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In this stage, we simply instantiate the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmberParm</span></code></a> object from the input topology and coordinate
files. After this command, <code class="docutils literal notranslate"><span class="pre">ala2_solv</span></code> will contain a full description of
every particle, the parameters defining their interactions, and their positions.</p>
</div>
<div class="section" id="id2">
<h3>Create the OpenMM system<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>This command creates an OpenMM <code class="docutils literal notranslate"><span class="pre">System</span></code> object from the information stored in
<code class="docutils literal notranslate"><span class="pre">ala5_gas</span></code>. It contains multiple <code class="docutils literal notranslate"><span class="pre">Force</span></code> instances for the bonds, angles,
periodic torsions, and nonbonded (electrostatic and van der Waals) interactions.
It is in this function that we define the potential parameters we want to use.
In this example, we have chosen the default values for each parameter except the
ones specified. In particular:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nonbondedMethod=app.PME</span></code> indicates we want to use the Particle Mesh
Ewald method to compute the full-range electrostatics.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nonbondedCutoff=8.0*u.angstroms</span></code> indicates we want to use an 8 Angstrom
cutoff for the Lennard-Jones interaction (as well as the direct-space part
of the Ewald sum).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">constraints=app.HBonds</span></code> indicates that we want to constrain all bonds
in which at least one atom is hydrogen</p></li>
</ul>
</div></blockquote>
<p>If there are any other force objects you want to define, they can be added to
the system after this step (like, for instance, positional restraints to a
reference structure).</p>
</div>
<div class="section" id="id3">
<h3>Create the integrator to do Langevin Dynamics<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>In this stage we specify an integrator. Common choices are
<code class="docutils literal notranslate"><span class="pre">LangevinIntegrator</span></code> (as we’ve chosen here) to do simulations in the NVT
ensemble and <code class="docutils literal notranslate"><span class="pre">VerletIntegrator</span></code> that allows us to do simulations either at
constant energy or temperature if using the <code class="docutils literal notranslate"><span class="pre">AndersenThermostat</span></code>.  In this
example, we’ve chosen the Langevin integrator with a target temperature of
300 K, a friction coefficient of 1/ps and a time step of 2 fs.</p>
</div>
<div class="section" id="id4">
<h3>Define the platform<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>In this stage, we define the platform we want to use.  In this example we have
chosen the CUDA platform, but this may not be available on every machine since
it only runs on NVidia GPU hardware.  Other choices are OpenCL (which will run
on a variety of GPUs including those made by AMD/ATI and CPUs), CPU (which is
an optimized version that runs natively on CPUs), and Reference (often quite
slow).</p>
<p>The properties can be set for each platform. In this case, we specified that we
wanted to use a mixed precision model (a good compromise between speed and
precision).</p>
</div>
<div class="section" id="id5">
<h3>Create the Simulation object<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>This step creates a <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object that will be used to run the actual
simulations.  If we wanted OpenMM to simply pick the fastest platform for us
(rather than specify one directly), we could omit the <code class="docutils literal notranslate"><span class="pre">platform</span></code> and <code class="docutils literal notranslate"><span class="pre">prop</span></code>
arguments.</p>
</div>
<div class="section" id="id6">
<h3>Set the particle positions<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>This stage is very important.  In this step, we set the particle positions
stored in the <code class="docutils literal notranslate"><span class="pre">ala5_gas</span></code> object to our object.  If you omit this step, you can
get strange results or other errors like segmentation violations. These particle
positions have been parsed from the input coordinate file, although if you had a
PDB file you could use the OpenMM <code class="docutils literal notranslate"><span class="pre">PDBFile</span></code> object as a source of coordinates
instead.</p>
</div>
<div class="section" id="id7">
<h3>Minimize the energy<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>This stage performs a basic energy minimization to relax particle positions.
This particular invocation will perform at most 500 iterations.</p>
</div>
<div class="section" id="id8">
<h3>Set up the reporters<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>This stage defines reporters that will “report” on the status of the simulation
periodically throughout the simulation. The first is an
<code class="xref py py-class docutils literal notranslate"><span class="pre">StateDataReporter</span></code> which will print out a summary of energies and
temperatures every 100 steps.  Unlike the <code class="docutils literal notranslate"><span class="pre">StateDataReporter</span></code> in OpenMM, this
reporter prints values in the AKMA unit system (Angstrom, Kilocalorie per mole,
and atomic mass units).</p>
<p>The second reporter is a NetCDF trajectory reporter, which is written in the
Amber NetCDF format. You can also use the native <code class="docutils literal notranslate"><span class="pre">DCDReporter</span></code> reporter in
OpenMM to print DCD-format trajectories.</p>
</div>
<div class="section" id="id9">
<h3>Running dynamics<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>This is the stage that actually runs the MD.  In this case, we are running
10,000 steps of MD.  The wiki page with “Common recipes” has information
regarding running a long simulation in chunks.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="omm_charmm.html" class="btn btn-neutral float-right" title="Examples using CHARMM Files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="openmmobj/parmed.openmm.energy_decomposition.html" class="btn btn-neutral float-left" title="parmed.openmm.energy_decomposition" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2015, Jason Swails

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>