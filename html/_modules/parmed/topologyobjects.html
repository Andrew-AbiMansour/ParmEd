

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>parmed.topologyobjects &mdash; ParmEd  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> ParmEd
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.3319.g7a6168d
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../topologyobjects.html">Core classes used to represent topologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../structure.html">The core Structure class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dimensional_analysis.html">Working with units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readwrite.html">Reading and writing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../amber.html">The Amber file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../charmm.html">The CHARMM file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gromacs.html">The GROMACS file classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rosetta.html">PyRosetta Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parmed.html">Using <code class="docutils literal notranslate"><span class="pre">parmed</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parmed.html#using-xparmed">Using <code class="docutils literal notranslate"><span class="pre">xparmed</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parmed_api.html">The ParmEd API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openmm.html">OpenMM Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../visualization.html">Visualization Functionality</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ParmEd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>parmed.topologyobjects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for parmed.topologyobjects</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains objects that deal with system topology and parameters, such</span>
<span class="sd">as atoms, residues, bonds, angles, etc.</span>

<span class="sd">by Jason Swails</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">unit</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">TINY_DIGITS</span> <span class="k">as</span> <span class="n">_TINY_DIGITS</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">DEG_TO_RAD</span><span class="p">,</span> <span class="n">RAD_TO_DEG</span><span class="p">,</span> <span class="n">TINY</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">MoleculeError</span><span class="p">,</span> <span class="n">ParameterError</span><span class="p">,</span> <span class="n">ParameterWarning</span>
<span class="kn">from</span> <span class="nn">.geometry</span> <span class="kn">import</span> <span class="n">angle</span><span class="p">,</span> <span class="n">dihedral</span><span class="p">,</span> <span class="n">distance2</span>
<span class="kn">from</span> <span class="nn">.utils.decorators</span> <span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">.utils.six</span> <span class="kn">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">string_types</span>
<span class="kn">from</span> <span class="nn">.utils.six.moves</span> <span class="kn">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">zip</span>
<span class="kn">from</span> <span class="nn">.periodic_table</span> <span class="kn">import</span> <span class="n">Element</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Angle&#39;</span><span class="p">,</span> <span class="s1">&#39;AngleType&#39;</span><span class="p">,</span> <span class="s1">&#39;Atom&#39;</span><span class="p">,</span> <span class="s1">&#39;AtomList&#39;</span><span class="p">,</span> <span class="s1">&#39;Bond&#39;</span><span class="p">,</span> <span class="s1">&#39;BondType&#39;</span><span class="p">,</span> <span class="s1">&#39;ChiralFrame&#39;</span><span class="p">,</span> <span class="s1">&#39;Cmap&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CmapType&#39;</span><span class="p">,</span> <span class="s1">&#39;Dihedral&#39;</span><span class="p">,</span> <span class="s1">&#39;DihedralType&#39;</span><span class="p">,</span> <span class="s1">&#39;DihedralTypeList&#39;</span><span class="p">,</span> <span class="s1">&#39;Improper&#39;</span><span class="p">,</span> <span class="s1">&#39;ImproperType&#39;</span><span class="p">,</span>
           <span class="s1">&#39;MultipoleFrame&#39;</span><span class="p">,</span> <span class="s1">&#39;OutOfPlaneBend&#39;</span><span class="p">,</span> <span class="s1">&#39;PiTorsion&#39;</span><span class="p">,</span> <span class="s1">&#39;Residue&#39;</span><span class="p">,</span> <span class="s1">&#39;ResidueList&#39;</span><span class="p">,</span> <span class="s1">&#39;StretchBend&#39;</span><span class="p">,</span>
           <span class="s1">&#39;StretchBendType&#39;</span><span class="p">,</span> <span class="s1">&#39;TorsionTorsion&#39;</span><span class="p">,</span> <span class="s1">&#39;TorsionTorsionType&#39;</span><span class="p">,</span> <span class="s1">&#39;TrigonalAngle&#39;</span><span class="p">,</span>
           <span class="s1">&#39;TrackedList&#39;</span><span class="p">,</span> <span class="s1">&#39;UreyBradley&#39;</span><span class="p">,</span> <span class="s1">&#39;OutOfPlaneBendType&#39;</span><span class="p">,</span> <span class="s1">&#39;NonbondedException&#39;</span><span class="p">,</span>
           <span class="s1">&#39;NonbondedExceptionType&#39;</span><span class="p">,</span> <span class="s1">&#39;AmoebaNonbondedExceptionType&#39;</span><span class="p">,</span> <span class="s1">&#39;AcceptorDonor&#39;</span><span class="p">,</span> <span class="s1">&#39;Group&#39;</span><span class="p">,</span>
           <span class="s1">&#39;AtomType&#39;</span><span class="p">,</span> <span class="s1">&#39;NoUreyBradley&#39;</span><span class="p">,</span> <span class="s1">&#39;ExtraPoint&#39;</span><span class="p">,</span> <span class="s1">&#39;TwoParticleExtraPointFrame&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ThreeParticleExtraPointFrame&#39;</span><span class="p">,</span> <span class="s1">&#39;OutOfPlaneExtraPointFrame&#39;</span><span class="p">,</span> <span class="s1">&#39;RBTorsionType&#39;</span><span class="p">,</span>
           <span class="s1">&#39;UnassignedAtomType&#39;</span><span class="p">,</span> <span class="s1">&#39;Link&#39;</span><span class="p">,</span> <span class="s1">&#39;DrudeAtom&#39;</span><span class="p">,</span> <span class="s1">&#39;DrudeAnisotropy&#39;</span><span class="p">]</span>

<span class="c1"># Create the AKMA unit system which is the unit system used by Amber and CHARMM</span>
<span class="n">scale_factor</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">daltons</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">scale_factor</span> <span class="o">=</span> <span class="n">scale_factor</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">)</span>
<span class="n">akma_time_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">BaseUnit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">picosecond_base_unit</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span> <span class="s1">&#39;akma time&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;aks&#39;</span><span class="p">)</span>
<span class="n">akma_time_unit</span><span class="o">.</span><span class="n">define_conversion_factor_to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">picosecond_base_unit</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
<span class="n">akma_unit_system</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">UnitSystem</span><span class="p">([</span><span class="n">u</span><span class="o">.</span><span class="n">angstrom_base_unit</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">dalton_base_unit</span><span class="p">,</span> <span class="n">akma_time_unit</span><span class="p">,</span>
                                 <span class="n">u</span><span class="o">.</span><span class="n">elementary_charge_base_unit</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kelvin_base_unit</span><span class="p">,</span>
                                 <span class="n">u</span><span class="o">.</span><span class="n">mole_base_unit</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">radian_base_unit</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Strips any units from the given value by casting them into the AKMA unit</span>
<span class="sd">    system (or the requested unit)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># special-case angles, since pure angles are always in degrees</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">is_compatible</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value_in_unit_system</span><span class="p">(</span><span class="n">akma_unit_system</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_exception_to_notimplemented</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps comparison operators to return NotImplemented instead of raising an</span>
<span class="sd">    AttributeError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">_getstate_with_exclusions</span><span class="p">(</span><span class="n">exclusions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Serializes based on all attributes except requested exclusions</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    exclusions : list of str, optional</span>
<span class="sd">        List of all attributes to exclude from serialization (should be</span>
<span class="sd">        descriptors and &#39;list&#39;). Default is None</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    If exclusions is None, it defaults to excluding &#39;list&#39;. If this is not</span>
<span class="sd">    desired, set exclusions to the empty list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exclusions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">exclusions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclusions</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">__getstate__</span>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<span class="c1"># Private classes and methods</span>

<span class="k">class</span> <span class="nc">_ListItem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helpful methods for items that appear in some kind of tracked list.</span>
<span class="sd">    Subclasses of this method interact with their `list` attribute, if they have</span>
<span class="sd">    one, in order to determine _where_ in the list they occur.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        This is intended to be a read-only variable that determines where in the</span>
<span class="sd">        list this particular object is. If there is no `list` attribute for this</span>
<span class="sd">        object, or the item is not in the list at all, `idx` is -1</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For lists that support indexing its members and tracking when that list is</span>
<span class="sd">    changed (so we know when to update indexes), this is a fast lookup, as</span>
<span class="sd">    indexing only needs to be done once, at most, for the entire list (until</span>
<span class="sd">    changes are made that could change the indexing).</span>

<span class="sd">    The ``idx`` lookup in a TrackedList is therefore an O(1) operation, while</span>
<span class="sd">    it is O(N) for standard containers (O(N^2) for looking up *all* indexes).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">mylist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">needs_indexing</span> <span class="o">=</span> <span class="n">mylist</span><span class="o">.</span><span class="n">needs_indexing</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># This isn&#39;t a tracked list, so just look through the list</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mylist</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span> <span class="k">return</span> <span class="n">i</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">needs_indexing</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="n">mylist</span><span class="o">.</span><span class="n">index_members</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mylist</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span> <span class="k">return</span> <span class="n">i</span>
                    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span>

<span class="k">class</span> <span class="nc">_FourAtomTerm</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class for a parameter that spans 4 atoms</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first atom in the term</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The second atom in the term</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        The third atom in the term</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        The fourth atom in the term</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is a base class that should be overridden by terms consisting of 4</span>
<span class="sd">    atoms (like torsions). There are a lot of such terms in the Amoeba force</span>
<span class="sd">    field, so this functionality is broken out into a new form</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">atom2</span> <span class="ow">or</span> <span class="n">atom1</span> <span class="ow">is</span> <span class="n">atom3</span> <span class="ow">or</span> <span class="n">atom1</span> <span class="ow">is</span> <span class="n">atom4</span> <span class="ow">or</span> <span class="n">atom2</span> <span class="ow">is</span> <span class="n">atom3</span> <span class="ow">or</span>
                <span class="n">atom2</span> <span class="ow">is</span> <span class="n">atom4</span> <span class="ow">or</span> <span class="n">atom3</span> <span class="ow">is</span> <span class="n">atom4</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;4-atom term cannot have duplicate atoms! &#39;</span>
                                <span class="s1">&#39;Atoms are: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span>
                                                            <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="n">atom3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="n">atom4</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">obj</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">is</span> <span class="n">obj</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">is</span> <span class="n">obj</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">is</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets all atoms in this term to None, and its type if it exists &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">_ParameterType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A parameter type that defines the nature of a particular molecular</span>
<span class="sd">    interaction. This is a base class that simply indicates whether a particular</span>
<span class="sd">    parameter type is &quot;used&quot;, which in turn is used to determine whether or not</span>
<span class="sd">    this parameter type needs to be printed</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    used : ``bool``</span>
<span class="sd">        If ``True``, then this parameter type should be considered *used*. If</span>
<span class="sd">        ``False``, it is not being used and does not need to be printed.</span>
<span class="sd">    penalty : float or None</span>
<span class="sd">        If this is assigned from a database, there might be a penalty assigned</span>
<span class="sd">        to the determination of this parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

<span class="k">def</span> <span class="nf">_delete_from_list</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes a requested item from a list. If the item does not exist in the</span>
<span class="sd">    list, a ValueError is raised</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    list : ``list``</span>
<span class="sd">        The list from which an item will be deleted</span>
<span class="sd">    item : ``object``</span>
<span class="sd">        The object to delete from the list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_safe_assigns</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shallow-copies all requested attributes from `source` to `dest` if they</span>
<span class="sd">    are present. If not present, nothing is done</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span> <span class="k">continue</span>
        <span class="n">myattr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">myattr</span><span class="p">)</span>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Atom"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Atom.html#parmed.Atom">[docs]</a><span class="k">class</span> <span class="nc">Atom</span><span class="p">(</span><span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An atom. Only use these as elements in AtomList instances, since AtomList</span>
<span class="sd">    will keep track of when indexes and other stuff needs to be updated. All</span>
<span class="sd">    parameters are optional.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atomic_number : ``int``</span>
<span class="sd">        The atomic number of this atom</span>
<span class="sd">    name : ``str``</span>
<span class="sd">        The name of this atom</span>
<span class="sd">    type : ``str``</span>
<span class="sd">        The type name of this atom</span>
<span class="sd">    charge : ``float``</span>
<span class="sd">        The partial atomic charge of this atom in fractions of an electron</span>
<span class="sd">    mass : ``float``</span>
<span class="sd">        The atomic mass of this atom in daltons</span>
<span class="sd">    nb_idx : ``int``</span>
<span class="sd">        The nonbonded index. This is a pointer that is relevant in the context</span>
<span class="sd">        of an Amber topology file and identifies its Lennard-Jones atom type</span>
<span class="sd">    solvent_radius : ``float``</span>
<span class="sd">        The intrinsic solvation radius of this atom.</span>
<span class="sd">    screen : ``float``</span>
<span class="sd">        The Generalized Born screening factor for this atom.</span>
<span class="sd">    occupancy : ``float``</span>
<span class="sd">        The occupancy of the atom (see PDB file)</span>
<span class="sd">    bfactor : ``float``</span>
<span class="sd">        The B-factor of the atom (see PDB file)</span>
<span class="sd">    altloc : ``str``</span>
<span class="sd">        Alternate location indicator (see PDB file)</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    list : :class:`AtomList`</span>
<span class="sd">        The AtomList that this atom belongs to. If None, this atom does not</span>
<span class="sd">        belong to any list. This can be any iterable, but should typically be an</span>
<span class="sd">        AtomList or None</span>
<span class="sd">    tree : ``str``</span>
<span class="sd">        The tree chain identifier assigned to this atom. Relevant in the context</span>
<span class="sd">        of an Amber topology file, and not used for very much.</span>
<span class="sd">    join : ``int``</span>
<span class="sd">        The &#39;join` property of atoms stored in the Amber topology file. At the</span>
<span class="sd">        time of writing this class, `join` is unused, but still oddly required.</span>
<span class="sd">        Add support for future-proofing</span>
<span class="sd">    irotat : ``int``</span>
<span class="sd">        The `irotat` property of atoms stored in the Amber topology file.</span>
<span class="sd">        Unused, but included for future-proofing.</span>
<span class="sd">    number : ``int``</span>
<span class="sd">        The serial number given to the atom (see PDB file)</span>
<span class="sd">    rmin : ``float``</span>
<span class="sd">        The Rmin/2 Lennard-Jones parameter for this atom. Default evaluates to 0</span>
<span class="sd">    epsilon : ``float``</span>
<span class="sd">        The epsilon (well depth) Lennard-Jones parameter for this atom. Default</span>
<span class="sd">        evaluates to 0</span>
<span class="sd">    rmin14 : ``float``</span>
<span class="sd">        The Rmin/2 Lennard-Jones parameter for this atom in 1-4 interactions.</span>
<span class="sd">        Default evaluates to 0</span>
<span class="sd">    epsilon14 : ``float``</span>
<span class="sd">        The epsilon (well depth) Lennard-Jones parameter for this atom in 1-4</span>
<span class="sd">        interactions. Default evaluates to 0</span>

<span class="sd">    Other Attributes</span>
<span class="sd">    ----------------</span>
<span class="sd">    element : ``int``</span>
<span class="sd">        This is an alias for atomic_number</span>
<span class="sd">    atom_type : :class:`AtomType`</span>
<span class="sd">        In some cases, &quot;type&quot; is an ambiguous choice of an integer serial number</span>
<span class="sd">        or a string descriptor. In this case, atom_type is an AtomType instance</span>
<span class="sd">        that disambiguates this discrepancy.</span>
<span class="sd">    anisou : numpy.ndarray(float64) (or list of floats)</span>
<span class="sd">        Anisotropic temperature scaling factors. This is a 6-element numpy array</span>
<span class="sd">        They are the 3x3 symmetric matrix elements U(1,1), U(2,2), U(3,3),</span>
<span class="sd">        U(1,2), U(1,3), U(2,3). If no factors available, it is None.</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this atom in the list. Set to -1 if this atom is not part</span>
<span class="sd">        of a list or the index cannot otherwise be determined (i.e., if the</span>
<span class="sd">        containing list does not support indexing its members)</span>
<span class="sd">    residue : :class:`Residue`</span>
<span class="sd">        The Residue that this atom belongs to. This is assigned when this atom</span>
<span class="sd">        is passed to `Residue.add_atom` -- see below for more information. Until</span>
<span class="sd">        it is set there, it is None</span>
<span class="sd">    other_locations : ``dict`` of :class:`Atom`</span>
<span class="sd">        A dict of Atom instances that represent alternate conformers of this</span>
<span class="sd">        atom. The keys are the `altloc` characters for those Atoms.</span>
<span class="sd">    bonds : ``list`` of :class:`Bond`</span>
<span class="sd">        list of Bond objects in which this atom is a member. This attribute</span>
<span class="sd">        should not be modified.</span>
<span class="sd">    angles : ``list`` of :class:`Angle`</span>
<span class="sd">        list of Angle objects in which this atom is a member. This attribute</span>
<span class="sd">        should not be modified.</span>
<span class="sd">    dihedrals : ``list`` of :class:`Dihedral`</span>
<span class="sd">        list of Dihedral objects in which this atom is a member. This attribute</span>
<span class="sd">        should not be modified.</span>
<span class="sd">    urey_bradleys : ``list`` of :class:`UreyBradley`</span>
<span class="sd">        list of UreyBradley objects in which this atom is a member (CHARMM,</span>
<span class="sd">        AMOEBA). This attribute should not be modified.</span>
<span class="sd">    impropers : ``list`` of :class:`Improper`</span>
<span class="sd">        list of Improper objects in which the atom is a member (CHARMM). This</span>
<span class="sd">        attribute should not be modified.</span>
<span class="sd">    cmaps : ``list`` of :class:`Cmap`</span>
<span class="sd">        list of Cmap objects in which the atom is a member (CHARMM, AMOEBA).</span>
<span class="sd">        This attribute should not be modified.</span>
<span class="sd">    tortors : ``list`` of :class:`TorsionTorsion`</span>
<span class="sd">        list of TorsionTorsion objects in which the atom is a member (AMOEBA).</span>
<span class="sd">        This attribute should not be modified.</span>
<span class="sd">    bond_partners : ``list`` of :class:`Atom`</span>
<span class="sd">        list of Atoms to which this atom is bonded. Do not modify this</span>
<span class="sd">        attribute -- it will almost certainly not do what you think it will</span>
<span class="sd">    angle_partners : ``list`` of :class:`Atom`</span>
<span class="sd">        list of Atoms to which this atom forms an angle, but not a bond. Do not</span>
<span class="sd">        modify this attribute -- it will almost certainly not do what you think</span>
<span class="sd">        it will</span>
<span class="sd">    dihedral_partners : ``list`` of :class:`Atom`</span>
<span class="sd">        list of Atoms to which this atom forms an dihedral, but not a bond or</span>
<span class="sd">        angle. Do not modify this attribute -- it will almost certainly not do</span>
<span class="sd">        what you think it will</span>
<span class="sd">    tortor_partners : ``list`` of :class:`Atom`</span>
<span class="sd">        list of Atoms to which this atom forms a coupled Torsion-Torsion, but</span>
<span class="sd">        not a bond or angle (AMOEBA). Do not modify this attribute -- it will</span>
<span class="sd">        almost certainly not do what you think it will</span>
<span class="sd">    exclusion_partners : ``list`` of :class:`Atom`</span>
<span class="sd">        list of Atoms with which this atom is excluded, but not bonded, angled,</span>
<span class="sd">        or dihedraled to. Do not modify this attribute -- it will almost</span>
<span class="sd">        certainly not do what you think it will</span>
<span class="sd">    marked : ``int``</span>
<span class="sd">        Mainly for internal use, it is used to indicate when certain atoms have</span>
<span class="sd">        been &quot;marked&quot; when traversing the bond network identifying topological</span>
<span class="sd">        features (like molecules and rings)</span>
<span class="sd">    children : ``list`` of :class:`ExtraPoint`</span>
<span class="sd">        This is the list of &quot;child&quot; ExtraPoint objects bonded to this atom</span>
<span class="sd">    number : ``int``</span>
<span class="sd">        The serial number of the atom in the input structure (e.g., PDB file).</span>
<span class="sd">        If not present in the original structure, a default value of -1 is used</span>
<span class="sd">    rmin : ``float``</span>
<span class="sd">        The Rmin/2 Lennard-Jones parameter for this atom. Default value is 0.</span>
<span class="sd">        If not set, it is taken from the `atom_type` attribute (if available)</span>
<span class="sd">    epsilon : ``float``</span>
<span class="sd">        The epsilon (well depth) Lennard-Jones parameter for this atom. Default</span>
<span class="sd">        value is 0. If not set, it is taken from the `atom_type` attribute (if</span>
<span class="sd">        available)</span>
<span class="sd">    rmin_14 : ``float``</span>
<span class="sd">        The Rmin/2 L-J parameter for 1-4 pairs. Default value is `rmin` (see</span>
<span class="sd">        above). If not set, it is taken from the `atom_type` attribute (if</span>
<span class="sd">        available).</span>
<span class="sd">    epsilon_14 : ``float``</span>
<span class="sd">        The epsilon L-J parameter for 1-4 pairs. Default value is `epsilon` (see</span>
<span class="sd">        above). If not set, it is taken from the `atom_type` attribute (if</span>
<span class="sd">        available).</span>

<span class="sd">    Possible Attributes</span>
<span class="sd">    -------------------</span>
<span class="sd">    xx : ``float``</span>
<span class="sd">        The X-component of the position of this atom. Only present if</span>
<span class="sd">        coordinates have been loaded. Otherwise raises AttributeError</span>
<span class="sd">    xy : ``float``</span>
<span class="sd">        The Y-component of the position of this atom. Only present if</span>
<span class="sd">        coordinates have been loaded. Otherwise raises AttributeError</span>
<span class="sd">    xz : ``float``</span>
<span class="sd">        The Z-component of the position of this atom. Only present if</span>
<span class="sd">        coordinates have been loaded. Otherwise raises AttributeError</span>
<span class="sd">    vx : ``float``</span>
<span class="sd">        The X-component of the velocity of this atom. Only present if the</span>
<span class="sd">        velocities have been loaded. Otherwise raises AttributeError</span>
<span class="sd">    vy : ``float``</span>
<span class="sd">        The Y-component of the velocity of this atom. Only present if the</span>
<span class="sd">        velocities have been loaded. Otherwise raises AttributeError</span>
<span class="sd">    vz : ``float``</span>
<span class="sd">        The Z-component of the velocity of this atom. Only present if the</span>
<span class="sd">        velocities have been loaded. Otherwise raises AttributeError</span>
<span class="sd">    type_idx : ``int``</span>
<span class="sd">        The AMOEBA atom type index. Only present if initialized with the AMOEBA</span>
<span class="sd">        force field. Otherwise raises AttributeError.</span>
<span class="sd">    class_idx : ``int``</span>
<span class="sd">        The AMOEBA class type index Only present if initialized with the AMOEBA</span>
<span class="sd">        force field. Otherwise raises AttributeError.</span>
<span class="sd">    multipoles : ``list(float)``</span>
<span class="sd">        The list of the 10 multipole moments up through quadrupoles Only present</span>
<span class="sd">        if initialized with the AMOEBA force field. Otherwise raises</span>
<span class="sd">        AttributeError.</span>
<span class="sd">    polarizability : ``list(float)``</span>
<span class="sd">        The polarizability of the atom. Only present if initialized with the</span>
<span class="sd">        AMOEBA force field. Otherwise raises AttributeError.</span>
<span class="sd">    vdw_parent : :class:`Atom`</span>
<span class="sd">        In the AMOEBA force field, this is the parent atom for the van der Waals</span>
<span class="sd">        term</span>
<span class="sd">    vdw_weight : ``float``</span>
<span class="sd">        In the AMOEBA force field, this is the weight of the van der Waals</span>
<span class="sd">        interaction on the parent atom</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The bond_partners, angle_partners, dihedral_partners, and exclusion_partners</span>
<span class="sd">    arrays are actually generated as properties by taking differences of sets</span>
<span class="sd">    and sorting them. As a result, accessing this attribute constantly can be</span>
<span class="sd">    less efficient than you would expect. Iterating over them in a loop requires</span>
<span class="sd">    minimal overhead. But if frequent access is needed and these sets are</span>
<span class="sd">    guaranteed not to change, you should save a reference to the object and use</span>
<span class="sd">    that instead.</span>

<span class="sd">    Binary comparisons are done by atom index and are used primarily for sorting</span>
<span class="sd">    sublists of atoms. The == operator is not defined, so Atom equality should</span>
<span class="sd">    be done using the `is` operator. This allows Atom instances to be hashable</span>
<span class="sd">    (and so used as `dict` keys and put in `set`s)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1 = Atom(name=&#39;CO&#39;, type=&#39;C&#39;, charge=0.5, mass=12.01)</span>
<span class="sd">    &gt;&gt;&gt; a2 = Atom(name=&#39;OC&#39;, type=&#39;O&#39;, charge=-0.5, mass=12.01)</span>
<span class="sd">    &gt;&gt;&gt; a1.bond_to(a2)</span>
<span class="sd">    &gt;&gt;&gt; a1 in a2.bond_partners and a2 in a1.bond_partners</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; a1.idx # Not part of a container</span>
<span class="sd">    -1</span>

<span class="sd">    This object also supports automatic indexing when it is part of a container</span>

<span class="sd">    &gt;&gt;&gt; atom_list = []</span>
<span class="sd">    &gt;&gt;&gt; atom_list.append(Atom(list=atom_list, name=&#39;CO&#39;, charge=0.5))</span>
<span class="sd">    &gt;&gt;&gt; atom_list.append(Atom(list=atom_list, name=&#39;OC&#39;, charge=-0.5))</span>
<span class="sd">    &gt;&gt;&gt; atom_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; atom_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Atom.html#parmed.Atom.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atomic_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">nb_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">solvent_radius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">screen</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tree</span><span class="o">=</span><span class="s1">&#39;BLA&#39;</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">irotat</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">occupancy</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">bfactor</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">altloc</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rmin14</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epsilon14</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span> <span class="o">=</span> <span class="n">atomic_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_charge</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">charge</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">elementary_charge</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">dalton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_idx</span> <span class="o">=</span> <span class="n">nb_idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solvent_radius</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">solvent_radius</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join</span> <span class="o">=</span> <span class="n">join</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irotat</span> <span class="o">=</span> <span class="n">irotat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfactor</span> <span class="o">=</span> <span class="n">bfactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">altloc</span> <span class="o">=</span> <span class="n">altloc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occupancy</span> <span class="o">=</span> <span class="n">occupancy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dihedral_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tortor_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclusion_partners</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># For arbitrary/other exclusions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marked</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># For setting molecules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedrals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urey_bradleys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmaps</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tortors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_locations</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># A dict of Atom instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span> <span class="o">=</span> <span class="n">UnassignedAtomType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anisou</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rmin</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">rmin14</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon14</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">epsilon14</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="c1">#===================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">atomic_number</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">atomic_number</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                  <span class="n">charge</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="n">nb_idx</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">nb_idx</span><span class="p">,</span>
                  <span class="n">solvent_radius</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">solvent_radius</span><span class="p">,</span> <span class="n">screen</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="n">tree</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span>
                  <span class="n">join</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">irotat</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">irotat</span><span class="p">,</span> <span class="n">occupancy</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">occupancy</span><span class="p">,</span>
                  <span class="n">bfactor</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">bfactor</span><span class="p">,</span> <span class="n">altloc</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">altloc</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">atom_type</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">atom_type</span>
        <span class="n">new</span><span class="o">.</span><span class="n">anisou</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">anisou</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">other_locations</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">other_locations</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">other_locations</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">_safe_assigns</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;xx&#39;</span><span class="p">,</span> <span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="s1">&#39;xz&#39;</span><span class="p">,</span> <span class="s1">&#39;vx&#39;</span><span class="p">,</span> <span class="s1">&#39;vy&#39;</span><span class="p">,</span> <span class="s1">&#39;vz&#39;</span><span class="p">,</span> <span class="s1">&#39;type_idx&#39;</span><span class="p">,</span> <span class="s1">&#39;class_idx&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;multipoles&#39;</span><span class="p">,</span> <span class="s1">&#39;polarizability&#39;</span><span class="p">,</span> <span class="s1">&#39;vdw_parent&#39;</span><span class="p">,</span> <span class="s1">&#39;vdw_weight&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a deep copy of this atom, but not attached to any list &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1">#===================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bond_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Go through all bonded partners &quot;&quot;&quot;</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">bp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">angle_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; List of all angle partners that are NOT bond partners &quot;&quot;&quot;</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">)</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">)</span> <span class="o">-</span> <span class="n">bp</span>
        <span class="n">toadd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ap</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">toadd</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">ap</span> <span class="o">|=</span> <span class="n">toadd</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ap</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dihedral_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot; List of all dihedral partners that are NOT angle or bond partners &quot;</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">)</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">)</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">)</span> <span class="o">-</span> <span class="n">ap</span> <span class="o">-</span> <span class="n">bp</span>
        <span class="n">toadd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">dp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">toadd</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">dp</span> <span class="o">|=</span> <span class="n">toadd</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tortor_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of all 1-5 partners that are NOT in angle or bond partners. This is</span>
<span class="sd">        *only* used in the Amoeba force field</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">)</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">)</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">)</span> <span class="o">-</span> <span class="n">dp</span> <span class="o">-</span> <span class="n">ap</span> <span class="o">-</span> <span class="n">bp</span>
        <span class="n">toadd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">toadd</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">|=</span> <span class="n">toadd</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tp</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exclusion_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of all exclusions not otherwise excluded by bonds/angles/torsions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># A little expensive, but the only way to ensure this is completely</span>
        <span class="c1"># correct easily</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">)</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle_partners</span><span class="p">)</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dihedral_partners</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tortor_partners</span><span class="p">)</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclusion_partners</span><span class="p">)</span> <span class="o">-</span> <span class="n">tp</span> <span class="o">-</span> <span class="n">dp</span> <span class="o">-</span> <span class="n">ap</span> <span class="o">-</span> <span class="n">bp</span>
        <span class="n">toadd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ep</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">toadd</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">ep</span> <span class="o">|=</span> <span class="n">toadd</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ep</span><span class="p">))</span>

    <span class="c1">#===================================================</span>

    <span class="c1"># Various parameters that can be taken from the AtomType if not set on the</span>
    <span class="c1"># atom directly.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">charge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">is</span> <span class="n">UnassignedAtomType</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">charge</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charge</span>

    <span class="nd">@charge</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_charge</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">elementary_charge</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ucharge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Charge with units &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">elementary_charge</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones Rmin/2 parameter (the Lennard-Jones radius) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">is</span> <span class="n">UnassignedAtomType</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">rmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">rmin</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmin</span>

    <span class="nd">@rmin</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones Rmin/2 parameter (the Lennard-Jones radius) &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rmin</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">urmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones Rmin/2 parameter with units &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstrom</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones sigma parameter -- directly related to Rmin &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="nd">@sigma</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rmin</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones sigma parameter with units &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones epsilon parameter (the Lennard-Jones well depth) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">is</span> <span class="n">UnassignedAtomType</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span>

    <span class="nd">@epsilon</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones epsilon parameter (the Lennard-Jones well depth) &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kilocalorie_per_mole</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uepsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones epsilon parameter with units &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rmin_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The 1-4 Lennard-Jones Rmin/2 parameter &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">is</span> <span class="n">UnassignedAtomType</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">rmin_14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">rmin_14</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span>

    <span class="nd">@rmin_14</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rmin_14</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The 1-4 Lennard-Jones Rmin/2 parameter &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">urmin_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The 1-4 Lennard-Jones Rmin/2 parameter with units &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lennard-Jones sigma parameter -- directly related to Rmin &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">is</span> <span class="n">UnassignedAtomType</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">rmin_14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="nd">@sigma_14</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma_14</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usigma_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The 1-4 Lennard-Jones sigma parameter with units &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_14</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">epsilon_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The 1-4 Lennard-Jones epsilon parameter &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">is</span> <span class="n">UnassignedAtomType</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">epsilon_14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">epsilon_14</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon14</span>

    <span class="nd">@epsilon_14</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">epsilon_14</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The 1-4 Lennard-Jones epsilon parameter &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon14</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uepsilon_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The 1-4 Lennard-Jones epsilon parameter &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_14</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">umass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mass</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">daltons</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usolvent_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Solvation radius with units attached &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_radius</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.nonbonded_exclusions"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Atom.nonbonded_exclusions">[docs]</a>    <span class="k">def</span> <span class="nf">nonbonded_exclusions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_greater</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_from</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of nonbonded atom exclusions for this atom. The</span>
<span class="sd">        general rules for building the exclusion list is to include both</span>
<span class="sd">        exceptions AND exclusions (i.e., the Amber scaling of 1-4 interactions</span>
<span class="sd">        means that the 1-4 terms are excluded and a special pairlist is built to</span>
<span class="sd">        handle those exceptions).</span>

<span class="sd">        All atoms in the `_partners` arrays are nonbonded exclusions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        only_greater : ``bool``, optional</span>
<span class="sd">            If True (default), only atoms whose `idx` value is greater than this</span>
<span class="sd">            `Atom`s `idx` will be counted as an exclusion (to avoid double-</span>
<span class="sd">            counting exclusions). If False, all exclusions will be counted.</span>
<span class="sd">        index_from : ``int``, optional</span>
<span class="sd">            This is the index of the first atom, and is intended to be 0 (for C-</span>
<span class="sd">            and Python-style numbering, default) or 1 (for Fortran-style</span>
<span class="sd">            numbering, such as that used in the Amber and CHARMM topology files)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ``list of int``</span>
<span class="sd">            The returned list will be the atom indexes of the exclusion partners</span>
<span class="sd">            for this atom (indexing starts from ``index_from``)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If this instance&#39;s `idx` attribute evaluates to -1 -- meaning it is not</span>
<span class="sd">        in an AtomList -- a IndexError will be raised. If you have two extra</span>
<span class="sd">        points (i.e., those with atomic numbers of 0) bonded to each other, this</span>
<span class="sd">        routine may raise a ``RuntimeError`` if the recursion depth is exceeded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Cannot find exclusions of an unindexed Atom&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">only_greater</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">excl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">atm</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="n">index_from</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">baseline</span><span class="p">:</span>
                <span class="n">excl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_partners</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">atm</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="n">index_from</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">baseline</span><span class="p">:</span>
                <span class="n">excl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_partners</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">atm</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="n">index_from</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">baseline</span><span class="p">:</span>
                <span class="n">excl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tortor_partners</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">atm</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="n">index_from</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">baseline</span><span class="p">:</span>
                <span class="n">excl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusion_partners</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">atm</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="n">index_from</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">baseline</span><span class="p">:</span>
                <span class="n">excl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">excl</span><span class="p">)</span></div>

    <span class="c1">#===================================================</span>

    <span class="c1"># Make &#39;element&#39; an alias for &#39;atomic_number&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span>
    <span class="nd">@element</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">element_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Element</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span><span class="p">]</span>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.bond_to"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Atom.bond_to">[docs]</a>    <span class="k">def</span> <span class="nf">bond_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log this atom as bonded to another atom.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`Atom`</span>
<span class="sd">            An atom that will be added to `bond_partners`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This action adds `self` to `other.bond_partners`. Raises</span>
<span class="sd">        :class:`MoleculeError` if `other is self`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">):</span>
            <span class="n">other</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s2">&quot;Cannot bond atom to itself! &quot;</span>
                                <span class="s2">&quot;Atoms are: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_bond_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.angle_to"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Atom.angle_to">[docs]</a>    <span class="k">def</span> <span class="nf">angle_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log this atom as angled to another atom.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`Atom`</span>
<span class="sd">            An atom that will be added to `angle_partners`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This action adds `self` to `other.angle_partners`. Raises</span>
<span class="sd">        :class:`MoleculeError` if `other is self`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s2">&quot;Cannot angle an atom with itself! &quot;</span>
                                <span class="s2">&quot;Atoms are: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_angle_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.dihedral_to"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Atom.dihedral_to">[docs]</a>    <span class="k">def</span> <span class="nf">dihedral_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log this atom as dihedral-ed to another atom.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`Atom`</span>
<span class="sd">            An atom that will be added to `dihedral_partners`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This action adds `self` to `other.dihedral_partners`. Raises</span>
<span class="sd">        :class:`MoleculeError` if `other is self`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s2">&quot;Cannot dihedral an atom with itself! &quot;</span>
                                <span class="s2">&quot;Atoms are: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.tortor_to"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Atom.tortor_to">[docs]</a>    <span class="k">def</span> <span class="nf">tortor_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log this atom as 1-5 partners to another atom</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`Atom`</span>
<span class="sd">            An atom that will be added to `tortor_partners`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This action adds `self` to `other.tortor_partners`. Raises</span>
<span class="sd">        :class:`MoleculeError` if `other is self`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;Cannot coupled-dihedral atom to itself &#39;</span>
                                <span class="s1">&#39;Atoms are: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.exclude"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Atom.exclude">[docs]</a>    <span class="k">def</span> <span class="nf">exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add one atom to my arbitrary exclusion list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`Atom`</span>
<span class="sd">            An atom that will be added to `exclusion_partners`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This action adds `self` to `other.exclusion_partners`. Raises</span>
<span class="sd">        :class:`MoleculeError` if `other is self`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s2">&quot;Cannot exclude an atom from itself! &quot;</span>
                                <span class="s2">&quot;Atoms are: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclusion_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_exclusion_partners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="Atom.prune_exclusions"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Atom.prune_exclusions">[docs]</a>    <span class="k">def</span> <span class="nf">prune_exclusions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For extra points, the exclusion partners may be filled before the bond,</span>
<span class="sd">        angle, dihedral, and tortor partners. Since we don&#39;t want memory of</span>
<span class="sd">        these exclusions if any of those topological features were to break, we</span>
<span class="sd">        want to *remove* those from the exclusion list. This function makes sure</span>
<span class="sd">        that nothing in the bond, angle, dihedral, and tortor lists appears in</span>
<span class="sd">        the exclusion list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclusion_partners</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">)</span> <span class="o">-</span>
                    <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">)</span> <span class="o">-</span>
                    <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclusion_partners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">excludes</span><span class="p">))</span></div>

    <span class="c1">#===================================================</span>

    <span class="c1"># Comparisons are done by comparing indexes</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">idx</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">idx</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;&lt;Atom </span><span class="si">%s</span><span class="s1"> [</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span> <span class="s1">&#39;idx&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">start</span> <span class="o">+</span> <span class="s1">&#39;; In </span><span class="si">%s</span><span class="s1"> </span><span class="si">%d</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">start</span> <span class="o">+</span> <span class="s1">&#39;; In object </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span>
        <span class="k">return</span> <span class="n">start</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>

    <span class="c1">#===================================================</span>

    <span class="c1"># For pickleability</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">atom_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_type</span><span class="p">,</span>
                      <span class="n">_charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_charge</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="n">nb_idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_idx</span><span class="p">,</span>
                      <span class="n">solvent_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">solvent_radius</span><span class="p">,</span> <span class="n">screen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span>
                      <span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">irotat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">irotat</span><span class="p">,</span> <span class="n">bfactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bfactor</span><span class="p">,</span>
                      <span class="n">altloc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">altloc</span><span class="p">,</span> <span class="n">occupancy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">occupancy</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
                      <span class="n">anisou</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anisou</span><span class="p">,</span> <span class="n">_rmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rmin</span><span class="p">,</span> <span class="n">_epsilon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
                      <span class="n">_rmin14</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rmin14</span><span class="p">,</span> <span class="n">_epsilon14</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_epsilon14</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span>
                      <span class="n">atomic_number</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;xx&#39;</span><span class="p">,</span> <span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="s1">&#39;xz&#39;</span><span class="p">,</span> <span class="s1">&#39;vx&#39;</span><span class="p">,</span> <span class="s1">&#39;vy&#39;</span><span class="p">,</span> <span class="s1">&#39;vz&#39;</span><span class="p">,</span> <span class="s1">&#39;multipoles&#39;</span><span class="p">,</span> <span class="s1">&#39;type_idx&#39;</span><span class="p">,</span> <span class="s1">&#39;class_idx&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;polarizability&#39;</span><span class="p">,</span> <span class="s1">&#39;vdw_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;weights&#39;</span><span class="p">,</span> <span class="s1">&#39;_frame_type&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">retval</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">retval</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angle_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dihedral_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tortor_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclusion_partners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marked</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedrals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urey_bradleys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmaps</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tortors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_locations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="ExtraPoint"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.ExtraPoint">[docs]</a><span class="k">class</span> <span class="nc">ExtraPoint</span><span class="p">(</span><span class="n">Atom</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An extra point is a massless, virtual site that is used to extend the</span>
<span class="sd">    flexibility of partial atomic charge fitting. They can be used to, for</span>
<span class="sd">    instance, give atoms permanent multipoles in a fixed-charge format.</span>

<span class="sd">    However, virtual sites are massless particles whose position is fixed with</span>
<span class="sd">    respect to a particular frame of reference. As a result, they must be</span>
<span class="sd">    treated specially when running dynamics. This class extends the `Atom` class</span>
<span class="sd">    with extra functionality specific to these &quot;Extra points&quot; or &quot;virtual</span>
<span class="sd">    sites&quot;. See the documentation for the :class:`Atom` class for more</span>
<span class="sd">    information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : list of float, optional, keyword-only</span>
<span class="sd">        This is the list of weights defining its frame.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :class:`Atom`: The ExtraPoint constructor also takes all `Atom` arguments</span>
<span class="sd">                   as well, and shares all of the same properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;weights&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;weights&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExtraPoint</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#===================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The parent atom of this extra point is the atom it is bonded to (there</span>
<span class="sd">        should only be 1 bond partner, but the parent is defined as its first)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">#===================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bond_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; List of all atoms bonded to this atom and its parent &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bond_partners</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">angle_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; List of all atoms angled to this atom and its parent &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">angle_partners</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dihedral_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">dihedral_partners</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tortor_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tortor_partners</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exclusion_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exclusion_partners</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="c1">#===================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frame_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The type of frame used for this extra point. Whether the EP lies</span>
<span class="sd">        beyond (outside) or between (inside) the is determined from the</span>
<span class="sd">        positions of each atom in the frame and the extra point. If those are</span>
<span class="sd">        not set, the EP is assumed to be between the two points in the frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">mybond</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">otherbond</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                    <span class="n">mybond</span> <span class="o">=</span> <span class="n">bond</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">otherbond</span> <span class="o">=</span> <span class="n">bond</span>
            <span class="k">assert</span> <span class="n">mybond</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">otherbond</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Strange bond pattern detected&#39;</span>
            <span class="n">bonddist</span> <span class="o">=</span> <span class="n">otherbond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="k">if</span> <span class="n">otherbond</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">otheratom</span> <span class="o">=</span> <span class="n">otherbond</span><span class="o">.</span><span class="n">atom2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">otheratom</span> <span class="o">=</span> <span class="n">otherbond</span><span class="o">.</span><span class="n">atom1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xz</span>
                <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">otheratom</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="n">otheratom</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">otheratom</span><span class="o">.</span><span class="n">xz</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">TwoParticleExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="o">-</span><span class="n">z2</span>
                <span class="k">if</span> <span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span><span class="o">*</span><span class="n">dz</span> <span class="o">&gt;</span> <span class="n">bonddist</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">TwoParticleExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">TwoParticleExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Just take 1 other atom -- an acute angle is &quot;inside&quot;, an obtuse</span>
            <span class="c1"># angle is &quot;outside&quot;</span>
            <span class="n">other_atom</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                        <span class="n">other_atom</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">atom2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">other_atom</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">atom1</span>
                    <span class="k">break</span>
            <span class="k">assert</span> <span class="n">other_atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Strange bond pattern detected&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">other_atom</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="n">other_atom</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">other_atom</span><span class="o">.</span><span class="n">xz</span>
                <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">xz</span>
                <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">z3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xz</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># See if both other atoms are hydrogens and the current atom is</span>
                <span class="c1"># an oxygen. If so, this is TIP4P and we go inside. Otherwise,</span>
                <span class="c1"># we go outside</span>
                <span class="n">other_atom2</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">bond</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">other_atom</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                            <span class="n">other_atom2</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">atom2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">other_atom2</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">atom1</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">other_atom2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Strange bond pattern detected&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">element</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">and</span> <span class="n">other_atom</span><span class="o">.</span><span class="n">element</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                        <span class="n">other_atom2</span><span class="o">.</span><span class="n">element</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="c1"># TIP4P!</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">ThreeParticleExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">ThreeParticleExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vec1</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="o">-</span><span class="n">z2</span><span class="p">]</span>
                <span class="n">vec2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x3</span><span class="o">-</span><span class="n">x2</span><span class="p">,</span> <span class="n">y3</span><span class="o">-</span><span class="n">y2</span><span class="p">,</span> <span class="n">z3</span><span class="o">-</span><span class="n">z2</span><span class="p">]</span>
                <span class="n">dot11</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec1</span><span class="p">)])</span>
                <span class="n">dot22</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vec2</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)])</span>
                <span class="n">dot12</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)])</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">dot12</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dot11</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dot22</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">ThreeParticleExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">ThreeParticleExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># Only supported option here is the OOP one (e.g., TIP5P) -- always</span>
            <span class="c1"># assume tetrahedral angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span> <span class="o">=</span> <span class="n">OutOfPlaneExtraPointFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_type</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span>
    <span class="k">def</span> <span class="nf">radii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_radius</span>
    <span class="nd">@radii</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@deprecated</span>
    <span class="k">def</span> <span class="nf">radii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solvent_radius</span> <span class="o">=</span> <span class="n">value</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="TwoParticleExtraPointFrame"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TwoParticleExtraPointFrame">[docs]</a><span class="k">class</span> <span class="nc">TwoParticleExtraPointFrame</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines a frame of reference for a given extra point with a frame</span>
<span class="sd">    of reference defined by 2 particles</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ep : :class:`ExtraPoint`</span>
<span class="sd">        The extra point defined by this frame</span>
<span class="sd">    inside : ``bool``</span>
<span class="sd">        If True, the extra point is contained inside the curve connecting all</span>
<span class="sd">        points in the frame of reference. If False, the point is outside that</span>
<span class="sd">        curve. See figures below for example</span>

<span class="sd">    Figures</span>
<span class="sd">    -------</span>
<span class="sd">    In the figures, x marks the real particles, e marks the extra point</span>
<span class="sd">    (properly numbered). The numbers refer to the ordering this class expects</span>
<span class="sd">    those atoms to be in. The real particle that is the parent of the extra</span>
<span class="sd">    point is shown in upper-case</span>

<span class="sd">    Inside  : x1-----e--X2</span>

<span class="sd">    Outside : x1--------X2--e</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Don&#39;t do error-checking now, since we want to give it time for the</span>
        <span class="c1"># bonds to be generated -- only error check when trying to get weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep</span> <span class="o">=</span> <span class="n">ep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inside</span> <span class="o">=</span> <span class="n">inside</span>

<div class="viewcode-block" id="TwoParticleExtraPointFrame.get_atoms"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TwoParticleExtraPointFrame.get_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the particles involved in the frame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a1, a2 : :class:`Atom`, :class:`Atom`</span>
<span class="sd">            a1 is the parent atom of the extra point. a2 is the other atom</span>
<span class="sd">            bonded to the parent atom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mybond</span><span class="p">,</span> <span class="o">=</span> <span class="p">[</span><span class="n">bond</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bad bond pattern in EP frame&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mybond</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">mybond</span><span class="o">.</span><span class="n">atom2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">mybond</span><span class="o">.</span><span class="n">atom1</span></div>

<div class="viewcode-block" id="TwoParticleExtraPointFrame.get_weights"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TwoParticleExtraPointFrame.get_weights">[docs]</a>    <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the weights for the two particles</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w1, w2 : ``float, float``</span>
<span class="sd">            w1 is the weight of particle 1 (the parent atom), whereas w2 is the</span>
<span class="sd">            weight of particle 2 (the atom bonded to the parent atom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;EP parent bond pattern inconsistent with 2-point virtual site frame&#39;</span><span class="p">)</span>
        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span>
        <span class="k">if</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">b1</span><span class="p">:</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inside</span><span class="p">:</span>
            <span class="c1"># It is closer to atom 1, but both weights are positive and add to 1</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">r1</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">/</span> <span class="n">r1</span><span class="p">),</span> <span class="p">(</span><span class="n">r2</span> <span class="o">/</span> <span class="n">r1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="p">)</span> <span class="o">/</span> <span class="n">r1</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">r2</span> <span class="o">/</span> <span class="n">r1</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="ThreeParticleExtraPointFrame"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.ThreeParticleExtraPointFrame">[docs]</a><span class="k">class</span> <span class="nc">ThreeParticleExtraPointFrame</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines a frame of reference for a given extra point with a frame</span>
<span class="sd">    of reference defined by 3 particles</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ep : :class:`ExtraPoint`</span>
<span class="sd">        The extra point defined by this frame</span>
<span class="sd">    inside : ``bool``</span>
<span class="sd">        If True, the extra point is contained inside the curve connecting all</span>
<span class="sd">        points in the frame of reference. If False, the point is outside that</span>
<span class="sd">        curve. See figures below for example</span>

<span class="sd">    Figures</span>
<span class="sd">    -------</span>
<span class="sd">    In the figures, x marks the real particles, e marks the extra point</span>
<span class="sd">    (properly numbered). The numbers refer to the ordering this class expects</span>
<span class="sd">    those atoms to be in. The real particle that is the parent of the extra</span>
<span class="sd">    point is shown in upper-case</span>

<span class="sd">    Inside :         X</span>
<span class="sd">                    /|\</span>
<span class="sd">                   / e \</span>
<span class="sd">                  x     x</span>
<span class="sd">    Outside :</span>
<span class="sd">                     e</span>
<span class="sd">                     |</span>
<span class="sd">                     X</span>
<span class="sd">                    / \</span>
<span class="sd">                   /   \</span>
<span class="sd">                  x     x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Don&#39;t do error-checking now, since we want to give it time for the</span>
        <span class="c1"># bonds to be generated -- only error check when trying to get weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep</span> <span class="o">=</span> <span class="n">ep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inside</span> <span class="o">=</span> <span class="n">inside</span>

<div class="viewcode-block" id="ThreeParticleExtraPointFrame.get_atoms"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.ThreeParticleExtraPointFrame.get_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the particles involved in the frame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a1, a2, a3 : :class:`Atom`, :class:`Atom`, :class:`Atom`</span>
<span class="sd">            a1 is the parent atom of the extra point. a2 and a3 are the other</span>
<span class="sd">            atoms that are both bonded to the parent atom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="p">[</span><span class="n">bond</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unsupported bonding pattern in EP frame&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">oatom1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">oatom1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span>
        <span class="k">if</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">oatom2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">oatom2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">oatom1</span><span class="p">,</span> <span class="n">oatom2</span></div>

<div class="viewcode-block" id="ThreeParticleExtraPointFrame.from_weights"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.ThreeParticleExtraPointFrame.from_weights">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_weights</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">dp1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dp2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theteq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d12</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the necessary bond length between an ExtraPoint</span>
<span class="sd">        and its parent atom from the weights that are calculated in</span>
<span class="sd">        ``get_weights``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : :class:`Atom`</span>
<span class="sd">            The parent atom to the ExtraPoint</span>
<span class="sd">        a1 : :class:`Atom`</span>
<span class="sd">            The first atom in the frame bonded to the parent</span>
<span class="sd">        a2 : :class:`Atom`</span>
<span class="sd">            The second atom in the frame bonded to the parent</span>
<span class="sd">        w1 : float</span>
<span class="sd">            The first weight defining the ExtraPoint position wrt ``a1``</span>
<span class="sd">        w2 : float</span>
<span class="sd">            The second weight defining the ExtraPoint position wrt ``a2``</span>
<span class="sd">        dp1 : float, optional</span>
<span class="sd">            Equilibrium distance between parent and a1. If None, a bond with a</span>
<span class="sd">            bond type must be defined between parent and a1, and the distance</span>
<span class="sd">            will be taken from there. Units must be Angstroms. Default is None</span>
<span class="sd">        dp2 : float, optional</span>
<span class="sd">            Same as dp1 above, but between atoms parent and a2. Either both dp1</span>
<span class="sd">            and dp2 should be None or neither should be. If one is None, the</span>
<span class="sd">            other will be ignored if not None.</span>
<span class="sd">        theteq : float, optional</span>
<span class="sd">            Angle between bonds parent-a1 and parent-a2. If None, d12 (below)</span>
<span class="sd">            will be used to calculate the angle. If both are None, the angle</span>
<span class="sd">            or d12 distance will be calculated from parametrized bonds or</span>
<span class="sd">            angles between a1, parent, and a2. Units of degrees. Default None.</span>
<span class="sd">        d12 : float, optional</span>
<span class="sd">            Distance between a1 and a2 as an alternative way to specify theteq.</span>
<span class="sd">            Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dist : float</span>
<span class="sd">            The distance between the ExtraPoint and its parent atom that</span>
<span class="sd">            satisfies the weights</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        parent must form a Bond with both a1 and a2.  Then, if a1-parent-a2</span>
<span class="sd">        forms an angle and it has an assigned type, that equilibrium value is</span>
<span class="sd">        used. Otherwise, the a1-a2 bond distance is used.  If neither of those</span>
<span class="sd">        are defined, a ValueError is raised.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError if the necessary geometry requirements are not set or if the</span>
<span class="sd">        two weights are different</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">a1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">bond_partners</span> <span class="ow">or</span> <span class="n">a2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parent atom not bound to other 2 atoms in frame&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a1</span><span class="o">.</span><span class="n">angle_partners</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a1</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No geometry defined between 2 non-parent atoms&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">w1</span> <span class="o">!=</span> <span class="n">w2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Currently only equal weights are supported&#39;</span><span class="p">)</span>
        <span class="c1"># distance(OV) = w1 * cos(EP-Parent-a1) * parent-a1 dist</span>
        <span class="k">if</span> <span class="n">dp1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dp2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Could not determine virtual site geometry&#39;</span><span class="p">)</span>
                    <span class="n">dp1</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
                <span class="k">if</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Could not determine virtual site geometry&#39;</span><span class="p">)</span>
                    <span class="n">dp2</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
        <span class="k">if</span> <span class="n">theteq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">d12</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a1</span><span class="o">.</span><span class="n">angle_partners</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">a1</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">a2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Could not determine virtual site geometry&#39;</span><span class="p">)</span>
                    <span class="n">d12</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
                <span class="c1"># Get angle from law of cosines</span>
                <span class="n">theteq</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">((</span><span class="n">dp1</span><span class="o">*</span><span class="n">dp1</span><span class="o">+</span><span class="n">dp2</span><span class="o">*</span><span class="n">dp2</span><span class="o">-</span><span class="n">d12</span><span class="o">*</span><span class="n">d12</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dp1</span><span class="o">*</span><span class="n">dp2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">a1</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">ang</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ang</span><span class="o">.</span><span class="n">atom2</span><span class="p">:</span> <span class="c1">#TODO test angle.type is None</span>
                        <span class="n">theteq</span> <span class="o">=</span> <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">theteq</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Could not find matching angle&quot;</span>
        <span class="k">elif</span> <span class="n">theteq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">theteq</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">((</span><span class="n">dp1</span><span class="o">*</span><span class="n">dp1</span><span class="o">+</span><span class="n">dp2</span><span class="o">*</span><span class="n">dp2</span><span class="o">-</span><span class="n">d12</span><span class="o">*</span><span class="n">d12</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dp1</span><span class="o">*</span><span class="n">dp2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theteq</span> <span class="o">*=</span> <span class="n">DEG_TO_RAD</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dp1</span> <span class="o">-</span> <span class="n">dp2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TINY</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot deal with asymmetry in EP frame&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">w1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theteq</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dp1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThreeParticleExtraPointFrame.get_weights"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.ThreeParticleExtraPointFrame.get_weights">[docs]</a>    <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the weights for the three particles</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w1, w2, w3 : ``float, float, float``</span>
<span class="sd">            w1 is the weight of particle 1 (the parent atom), whereas w2 and w3</span>
<span class="sd">            are the weights of particles 2 and 3 (the atoms bonded to the</span>
<span class="sd">            parent atom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;EP parent bond pattern inconsistent with 3-point virtual site frame&#39;</span><span class="p">)</span>
        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span>
        <span class="c1"># There are 2 possibilities here -- there is an angle between the 3</span>
        <span class="c1"># atoms in the frame OR there is a triangle of bonds (e.g., TIP4P).</span>
        <span class="c1"># Compute the &#39;ideal&#39; distance between the 3 frame-of-ref. atoms</span>
        <span class="k">if</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">b1</span><span class="p">:</span>
            <span class="n">b1</span><span class="p">,</span> <span class="n">b3</span> <span class="o">=</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b1</span>
        <span class="k">elif</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">b2</span><span class="p">:</span>
            <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span> <span class="o">=</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b2</span>
        <span class="c1"># See if there is an angle with both b1 and b2 in it</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b1</span> <span class="ow">in</span> <span class="n">ang</span> <span class="ow">and</span> <span class="n">b2</span> <span class="ow">in</span> <span class="n">ang</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="c1"># Compute the 2-3 distance from the two bond lengths and the angles</span>
            <span class="c1"># using law of cosines</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">theteq</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span>
            <span class="n">req23</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r1</span><span class="o">*</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="o">*</span><span class="n">r2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">r1</span><span class="o">*</span><span class="n">r2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># See if there is a bond between particles 2 and 3</span>
            <span class="k">if</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span>
            <span class="k">if</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span>
            <span class="k">if</span> <span class="n">a1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a2</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;EP frame definition incomplete for 3-point virtual site... &#39;</span>
                                   <span class="s1">&#39;cannot determine distance between particles 2 and 3&#39;</span><span class="p">)</span>
            <span class="n">req23</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">a1</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                    <span class="n">req23</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="k">if</span> <span class="n">req23</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Cannot determine 2-3 particle distance in &#39;</span>
                                   <span class="s1">&#39;three-site virtual site frame&#39;</span><span class="p">)</span>
        <span class="n">req12</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
        <span class="n">req13</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">b3</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">req12</span><span class="o">*</span><span class="n">req13</span> <span class="o">-</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">req23</span><span class="o">*</span><span class="n">req23</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inside</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">weight</span><span class="p">,</span> <span class="n">weight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">weight</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="n">weight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">weight</span> <span class="o">/</span> <span class="mi">2</span></div></div>

<div class="viewcode-block" id="OutOfPlaneExtraPointFrame"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.OutOfPlaneExtraPointFrame">[docs]</a><span class="k">class</span> <span class="nc">OutOfPlaneExtraPointFrame</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines a frame of reference for a given extra point with a frame</span>
<span class="sd">    of reference defined by 3 particles, but with the virtual site out of the</span>
<span class="sd">    plane of those 3 particles. For example, TIP5P</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ep : :class:`ExtraPoint`</span>
<span class="sd">        The extra point defined by this frame</span>
<span class="sd">    angle : ``float``</span>
<span class="sd">        The angle out-of-plane that the extra point is. By default, it is half</span>
<span class="sd">        of the angle of a tetrahedron. Given in degrees</span>

<span class="sd">    Figures</span>
<span class="sd">    -------</span>
<span class="sd">    In the figures, x marks the real particles, e marks the extra point</span>
<span class="sd">    (properly numbered). The numbers refer to the ordering this class expects</span>
<span class="sd">    those atoms to be in. The real particle that is the parent of the extra</span>
<span class="sd">    point is shown in upper-case</span>

<span class="sd">                   e   e</span>
<span class="sd">                    \ /</span>
<span class="sd">                     X</span>
<span class="sd">                    / \</span>
<span class="sd">                   /   \</span>
<span class="sd">                  x     x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">54.735</span><span class="p">):</span>
        <span class="c1"># Don&#39;t do error-checking now, since we want to give it time for the</span>
        <span class="c1"># bonds to be generated -- only error check when trying to get weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep</span> <span class="o">=</span> <span class="n">ep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span>

<div class="viewcode-block" id="OutOfPlaneExtraPointFrame.get_atoms"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.OutOfPlaneExtraPointFrame.get_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the particles involved in the frame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a1, a2, a3 : :class:`Atom`, :class:`Atom`, :class:`Atom`</span>
<span class="sd">            a1 is the parent atom of the extra point. a2 and a3 are the other</span>
<span class="sd">            atoms that are both bonded to the parent atom but are not EPs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="p">[</span><span class="n">bond</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span>
                      <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">)</span> <span class="ow">and</span>
                          <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">))</span>
                     <span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unsupported bonding pattern in EP frame&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">oatom1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">oatom1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span>
        <span class="k">if</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">oatom2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">oatom2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">oatom2</span><span class="p">,</span> <span class="n">oatom1</span></div>

<div class="viewcode-block" id="OutOfPlaneExtraPointFrame.get_weights"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.OutOfPlaneExtraPointFrame.get_weights">[docs]</a>    <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the weights for the three particles</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w1, w2, w3 : ``float, float, float``</span>
<span class="sd">            w1 and w2 are the weights with respect to the second two particles</span>
<span class="sd">            in the frame (i.e., NOT the parent atom). w3 is the weight of the</span>
<span class="sd">            cross-product</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span>
        <span class="c1"># Find the two bonds that do not involve any extra points</span>
        <span class="n">regbonds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mybond</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">)):</span>
                <span class="n">regbonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mybond</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;multiple bonds detected to extra point&#39;</span><span class="p">)</span>
                <span class="n">mybond</span> <span class="o">=</span> <span class="n">bond</span>
        <span class="c1">#FIXME -- is this necessary?</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">regbonds</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;EP parent bond pattern inconsistent with an &#39;</span>
                             <span class="s1">&#39;out-of-plane, 3-point virtual site frame&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mybond</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No EP bond found... should not be here&#39;</span><span class="p">)</span>
        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">regbonds</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">req12</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
        <span class="n">req13</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
        <span class="c1"># See if there is an angle with both b1 and b2 in it</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b1</span> <span class="ow">in</span> <span class="n">ang</span> <span class="ow">and</span> <span class="n">b2</span> <span class="ow">in</span> <span class="n">ang</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="c1"># Compute the 2-3 distance from the two bond lengths and the angles</span>
            <span class="c1"># using law of cosines</span>
            <span class="n">t213</span> <span class="o">=</span> <span class="n">ang</span><span class="o">.</span><span class="n">theteq</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">theteq</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span>
            <span class="n">req23</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r1</span><span class="o">*</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="o">*</span><span class="n">r2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">r1</span><span class="o">*</span><span class="n">r2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># See if there is a bond between particles 2 and 3</span>
            <span class="k">if</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">atom1</span>
            <span class="k">if</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">atom1</span>
            <span class="k">if</span> <span class="n">a1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a2</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;EP frame definition incomplete for 3-point virtual site... &#39;</span>
                                   <span class="s1">&#39;cannot determine distance between particles 2 and 3&#39;</span><span class="p">)</span>
            <span class="n">req23</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">a1</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
                    <span class="n">req23</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
            <span class="k">if</span> <span class="n">req23</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Cannot determine 2-3 particle distance in &#39;</span>
                                   <span class="s1">&#39;three-site virtual site frame&#39;</span><span class="p">)</span>
            <span class="c1"># Now calculate the angle</span>
            <span class="n">t213</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">req23</span> <span class="o">/</span> <span class="p">(</span><span class="n">req12</span> <span class="o">+</span> <span class="n">req13</span><span class="p">))</span> <span class="o">*</span> <span class="n">RAD_TO_DEG</span>
        <span class="c1"># Some necessary constants</span>
        <span class="n">length_conv</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="o">.</span><span class="n">conversion_factor_to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">nanometers</span><span class="p">)</span>
        <span class="n">req12</span> <span class="o">*=</span> <span class="n">length_conv</span>
        <span class="n">req13</span> <span class="o">*=</span> <span class="n">length_conv</span>
        <span class="n">req23</span> <span class="o">*=</span> <span class="n">length_conv</span>
        <span class="n">sinOOP</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span><span class="p">)</span>
        <span class="n">cosOOP</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span><span class="p">)</span>
        <span class="n">sin213</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t213</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span><span class="p">)</span>
        <span class="c1"># Find how big the cross product is</span>
        <span class="n">lenCross</span> <span class="o">=</span> <span class="n">req12</span> <span class="o">*</span> <span class="n">req13</span> <span class="o">*</span> <span class="n">sin213</span>
        <span class="c1"># Find our weights (assume symmetric)</span>
        <span class="n">weightCross</span> <span class="o">=</span> <span class="n">sinOOP</span> <span class="o">*</span> <span class="n">mybond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span> <span class="o">*</span> <span class="n">length_conv</span> <span class="o">/</span> <span class="n">lenCross</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">cosOOP</span> <span class="o">*</span> <span class="n">mybond</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span> <span class="o">*</span> <span class="n">length_conv</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">req12</span><span class="o">*</span><span class="n">req13</span> <span class="o">-</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">req23</span><span class="o">*</span><span class="n">req23</span><span class="p">)</span>
        <span class="c1"># Find out of the cross product weight should be positive or negative.</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">v12</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">xx</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="n">a2</span><span class="o">.</span><span class="n">xy</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">a2</span><span class="o">.</span><span class="n">xz</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xz</span><span class="p">)</span>
            <span class="n">v13</span> <span class="o">=</span> <span class="p">(</span><span class="n">a3</span><span class="o">.</span><span class="n">xx</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="n">a3</span><span class="o">.</span><span class="n">xy</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">a3</span><span class="o">.</span><span class="n">xz</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xz</span><span class="p">)</span>
            <span class="n">v1e</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">xx</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">xy</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">xz</span><span class="o">-</span><span class="n">a1</span><span class="o">.</span><span class="n">xz</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># No coordinates... we have to guess. The first EP will have a</span>
            <span class="c1"># positive weight, the second will have a negative (this matches</span>
            <span class="c1"># what happens with Amber prmtop files...)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">):</span>
                    <span class="n">weightCross</span> <span class="o">=</span> <span class="o">-</span><span class="n">weightCross</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Take the cross product of v12 and v13, then dot that with the EP</span>
            <span class="c1"># vector. An acute angle is a positive weightCross. An obtuse one is</span>
            <span class="c1"># negative</span>
            <span class="n">cross</span> <span class="o">=</span> <span class="p">(</span><span class="n">v12</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v13</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">v12</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">v13</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">v12</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">v13</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">v12</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">v13</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                     <span class="n">v12</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">v13</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v12</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v13</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">lencross</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">cross</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">cross</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]))</span>
            <span class="n">lenv1e</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">v1e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">v1e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]))</span>
            <span class="n">v1edotcross</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v1e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">cross</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="n">costheta</span> <span class="o">=</span> <span class="n">v1edotcross</span> <span class="o">/</span> <span class="p">(</span><span class="n">lenv1e</span><span class="o">*</span><span class="n">lencross</span><span class="p">)</span>
            <span class="n">weightCross</span> <span class="o">=</span> <span class="o">-</span><span class="n">weightCross</span> <span class="k">if</span> <span class="n">costheta</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">weightCross</span>
        <span class="k">return</span> <span class="n">weight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">weight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">weightCross</span></div></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Bond"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Bond.html#parmed.Bond">[docs]</a><span class="k">class</span> <span class="nc">Bond</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A covalent bond connecting two atoms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first atom involved in the bond</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The other atom involved in the bond</span>
<span class="sd">    type : :class:`BondType` or None, optional</span>
<span class="sd">        The bond type that defines the parameters for this bond. Default is None</span>
<span class="sd">    order : float, optional</span>
<span class="sd">        The bond order of this bond. Bonds are classified as follows:</span>
<span class="sd">            1.0 -- single bond</span>
<span class="sd">            2.0 -- double bond</span>
<span class="sd">            3.0 -- triple bond</span>
<span class="sd">            1.5 -- aromatic bond</span>
<span class="sd">            1.25 -- amide bond</span>
<span class="sd">        Default is 1.0</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    You can test whether an :class:`Atom` is contained within the bond using the</span>
<span class="sd">    `in` operator. A `MoleculeError` is raised if `atom1` and `atom2` are identical.</span>
<span class="sd">    This bond instance is `append`ed to the `bonds` list for both `atom1` and</span>
<span class="sd">    `atom2` and is automatically removed from those lists upon garbage</span>
<span class="sd">    collection</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1, a2 = Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; bond = Bond(a1, a2)</span>
<span class="sd">    &gt;&gt;&gt; a1 in bond and a2 in bond</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Bond.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Bond.html#parmed.Bond.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Bond constructor &quot;&quot;&quot;</span>
        <span class="c1"># Make sure we&#39;re not bonding me to myself</span>
        <span class="k">if</span> <span class="n">atom1</span> <span class="ow">is</span> <span class="n">atom2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;Cannot bond atom to itself! Atoms are: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom2</span><span class="p">,</span> <span class="n">ExtraPoint</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;Cannot bond two virtual sites/extra points together&#39;</span><span class="p">)</span>
        <span class="c1"># Order the atoms so the lowest atom # is first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="c1"># Load this struct into the atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">bond_to</span><span class="p">(</span><span class="n">atom2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funct</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Quick and easy way to see if an Atom is in this Bond &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span>

<div class="viewcode-block" id="Bond.delete"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Bond.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes this bond from the atoms that make it up. This method removes</span>
<span class="sd">        this bond from the `bonds` list for both atom1 and atom2 as well as</span>
<span class="sd">        removing atom1 from atom2.bond_partners and vice versa.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">bonds</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">bonds</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_bond_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Bond order. See description in :class:`Bond` argument list &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span>

    <span class="nd">@order</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Order of the bond. Must be a float, or ValueError or TypeError will be</span>
<span class="sd">        raised</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="Bond.measure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Bond.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current bond</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        measurement : float or None</span>
<span class="sd">            If the atoms have coordinates, returns the distance between the two</span>
<span class="sd">            atoms. If any coordinates are missing, returns None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">distance2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Bond.umeasure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Bond.umeasure">[docs]</a>    <span class="k">def</span> <span class="nf">umeasure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as &quot;measure&quot;, but with units &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Bond.energy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Bond.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current bond energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        energy : float or None</span>
<span class="sd">            Bond strain energy in kcal/mol. Return value is None if either the</span>
<span class="sd">            coordinates of either atom is not set or the bond type is not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span></div>

<div class="viewcode-block" id="Bond.uenergy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Bond.uenergy">[docs]</a>    <span class="k">def</span> <span class="nf">uenergy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as energy(), but with units &quot;&quot;&quot;</span>
        <span class="n">ene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ene</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="k">if</span> <span class="n">ene</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">; type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="BondType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.BondType.html#parmed.BondType">[docs]</a><span class="k">class</span> <span class="nc">BondType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A bond type with a set of bond parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : ``float``</span>
<span class="sd">        Force constant in kcal/mol/Angstrom^2</span>
<span class="sd">    req : ``float``</span>
<span class="sd">        Equilibrium bond distance in Angstroms</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        A list of :class:`BondType`s in which this is a member</span>

<span class="sd">    Inherited Attributes</span>
<span class="sd">    --------------------</span>
<span class="sd">    idx : int</span>
<span class="sd">        The index of this BondType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two `BondType`s are equal if their `k` and `req` attributes are equal</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; bt1 = BondType(10.0, 1.0)</span>
<span class="sd">    &gt;&gt;&gt; bt2 = BondType(10.0, 1.0)</span>
<span class="sd">    &gt;&gt;&gt; bt1 is bt2</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bt1 == bt2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; bt1.idx # Not in a list or container</span>
<span class="sd">    -1</span>

<span class="sd">    As part of a list, they can be indexed</span>

<span class="sd">    &gt;&gt;&gt; bond_list = []</span>
<span class="sd">    &gt;&gt;&gt; bond_list.append(BondType(10.0, 1.0, list=bond_list))</span>
<span class="sd">    &gt;&gt;&gt; bond_list.append(BondType(10.0, 1.0, list=bond_list))</span>
<span class="sd">    &gt;&gt;&gt; bond_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bond_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BondType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.BondType.html#parmed.BondType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">req</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">req</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; k=</span><span class="si">%.3f</span><span class="s1">, req=</span><span class="si">%.3f</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Not bound to any list &quot;&quot;&quot;</span>
        <span class="c1"># Hack to keep NoUreyBradley as a singleton</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">NoUreyBradley</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">BondType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Special-case NoUreyBradley, which should be a singleton. So if it&#39;s</span>
<span class="sd">        NoUreyBradley, return the same object. Otherwise, create a new one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">NoUreyBradley</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;NoUreyBradley&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">BondType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="o">**</span><span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ureq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">req</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Angle"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Angle.html#parmed.Angle">[docs]</a><span class="k">class</span> <span class="nc">Angle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A valence angle between 3 atoms separated by two covalent bonds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        An atom one end of the valence angle</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The atom in the middle of the valence angle bonded to both other atoms</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        An atom on the other end of the valence angle to atom1</span>
<span class="sd">    type : :class:`AngleType`</span>
<span class="sd">        The AngleType object containing the parameters for this angle</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    An Angle can contain bonds or atoms. A bond is contained if it exists</span>
<span class="sd">    between atoms 1 and 2 or atoms 2 and 3.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1, a2, a3 = Atom(), Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; angle = Angle(a1, a2, a3)</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a2) in angle and Bond(a3, a2) in angle</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; a1 in angle and a2 in angle and a3 in angle</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a3) in angle # this is not part of the angle definition</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Angle.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Angle.html#parmed.Angle.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Make sure we&#39;re not angling me to myself</span>
        <span class="k">if</span> <span class="n">atom1</span> <span class="ow">is</span> <span class="n">atom2</span> <span class="ow">or</span> <span class="n">atom1</span> <span class="ow">is</span> <span class="n">atom3</span> <span class="ow">or</span> <span class="n">atom2</span> <span class="ow">is</span> <span class="n">atom3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;Cannot angle atom to itself! &#39;</span>
                                <span class="s1">&#39;Atoms are: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="n">atom3</span>
        <span class="c1"># Log these angles in each atom</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom3</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Load the force constant and equilibrium angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">angle_to</span><span class="p">(</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">angle_to</span><span class="p">(</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">angle_to</span><span class="p">(</span><span class="n">atom3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funct</span> <span class="o">=</span> <span class="mi">1</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Quick and easy way to see if an Atom or a Bond is in this Angle &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">or</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">obj</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">obj</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">))</span>

<div class="viewcode-block" id="Angle.delete"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Angle.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes this angle from the atoms that make it up. This method removes</span>
<span class="sd">        this angle from the `angles` list for atom1, atom2, and atom3 as well as</span>
<span class="sd">        removing each atom form each others&#39; angle partner lists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_angle_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Angle.measure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Angle.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current angle</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        measurement : float or None</span>
<span class="sd">            If the atoms have coordinates, returns the angle between the three</span>
<span class="sd">            atoms. If any coordinates are missing, returns None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Angle.umeasure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Angle.umeasure">[docs]</a>    <span class="k">def</span> <span class="nf">umeasure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as measure(), but with units &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Angle.energy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Angle.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current angle energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        energy : float or None</span>
<span class="sd">            Angle strain energy in kcal/mol. Return value is None if either the</span>
<span class="sd">            coordinates of either atom is not set or the angle type is not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">da</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">theteq</span><span class="p">)</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">da</span> <span class="o">*</span> <span class="n">da</span></div>

<div class="viewcode-block" id="Angle.uenergy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Angle.uenergy">[docs]</a>    <span class="k">def</span> <span class="nf">uenergy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as energy(), but with units &quot;&quot;&quot;</span>
        <span class="n">ene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ene</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="k">if</span> <span class="n">ene</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">; type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="AngleType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.AngleType.html#parmed.AngleType">[docs]</a><span class="k">class</span> <span class="nc">AngleType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An angle type with a set of angle parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : ``float``</span>
<span class="sd">        Force constant in kcal/mol/radians^2</span>
<span class="sd">    theteq : ``float``</span>
<span class="sd">        Equilibrium angle in Degrees</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        A list of `AngleType`s in which this is a member</span>

<span class="sd">    Inherited Attributes</span>
<span class="sd">    --------------------</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this AngleType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two `AngleType`s are equal if their `k` and `theteq` attributes are equal</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; at1 = AngleType(10.0, 180.0)</span>
<span class="sd">    &gt;&gt;&gt; at2 = AngleType(10.0, 180.0)</span>
<span class="sd">    &gt;&gt;&gt; at1 is at2</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; at1 == at2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; at1.idx # not part of any list or iterable</span>
<span class="sd">    -1</span>

<span class="sd">    As part of a list, they can be indexed</span>

<span class="sd">    &gt;&gt;&gt; angle_list = []</span>
<span class="sd">    &gt;&gt;&gt; angle_list.append(AngleType(10.0, 180.0, list=angle_list))</span>
<span class="sd">    &gt;&gt;&gt; angle_list.append(AngleType(10.0, 180.0, list=angle_list))</span>
<span class="sd">    &gt;&gt;&gt; angle_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; angle_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AngleType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.AngleType.html#parmed.AngleType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">theteq</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">radians</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">theteq</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theteq</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">theteq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; k=</span><span class="si">%.3f</span><span class="s1">, theteq=</span><span class="si">%.3f</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AngleType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theteq</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">radians</span><span class="o">**</span><span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">utheteq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Dihedral"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Dihedral.html#parmed.Dihedral">[docs]</a><span class="k">class</span> <span class="nc">Dihedral</span><span class="p">(</span><span class="n">_FourAtomTerm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A valence dihedral between 4 atoms separated by three covalent bonds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        An atom on one end of the valence dihedral bonded to atom 2</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the valence dihedral bonded to atom1 and atom3</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the valence dihedral bonded to atom2 and atom4</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        An atom on the other end of the valence dihedral bonded to atom 3</span>
<span class="sd">    improper : ``bool``</span>
<span class="sd">        If True, this is an Amber-style improper torsion, where atom3 is the</span>
<span class="sd">        &quot;central&quot; atom bonded to atoms 1, 2, and 4 (atoms 1, 2, and 4 are *only*</span>
<span class="sd">        bonded to atom 3 in this instance)</span>
<span class="sd">    ignore_end : ``bool``</span>
<span class="sd">        If True, the end-group interactions for this torsion are ignored, either</span>
<span class="sd">        because it is involved in a ring where the end-group atoms are excluded</span>
<span class="sd">        or because it is one term in a multi-term dihedral expansion</span>
<span class="sd">    type : :class:`DihedralType`</span>
<span class="sd">        The DihedralType object containing the parameters for this dihedral</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A Dihedral can contain bonds or atoms. A bond is contained if it exists</span>
<span class="sd">    between atoms 1 and 2, between atoms 2 and 3, or between atoms 3 and 4.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1, a2, a3, a4 = Atom(), Atom(), Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; dihed = Dihedral(a1, a2, a3, a4)</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1,a2) in dihed and Bond(a3,a2) in dihed and Bond(a3,a4) in dihed</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; a1 in dihed and a2 in dihed and a3 in dihed and a4 in dihed</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a4) in dihed # this is not part of the angle definition</span>
<span class="sd">    False</span>

<span class="sd">    For improper torsions, the bond pattern is different</span>

<span class="sd">    &gt;&gt;&gt; a1, a2, a3, a4 = Atom(), Atom(), Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; dihed = Dihedral(a1, a2, a3, a4, improper=True)</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1,a3) in dihed and Bond(a2,a3) in dihed and Bond(a3,a4) in dihed</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1,a2) in dihed # Not like a normal dihedral!</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; a1 in dihed and a2 in dihed and a3 in dihed and a4 in dihed</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Dihedral.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Dihedral.html#parmed.Dihedral.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">improper</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_end</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">)</span>
        <span class="c1"># improper _implies_ ignore_end</span>
        <span class="n">ignore_end</span> <span class="o">=</span> <span class="n">improper</span> <span class="ow">or</span> <span class="n">ignore_end</span>
        <span class="c1"># Log these dihedrals in each atom</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">dihedrals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">dihedrals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom3</span><span class="o">.</span><span class="n">dihedrals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom4</span><span class="o">.</span><span class="n">dihedrals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">improper</span> <span class="o">=</span> <span class="n">improper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_end</span> <span class="o">=</span> <span class="n">ignore_end</span>
        <span class="k">if</span> <span class="n">improper</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_funct</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">atom1</span><span class="o">.</span><span class="n">dihedral_to</span><span class="p">(</span><span class="n">atom2</span><span class="p">)</span>
            <span class="n">atom1</span><span class="o">.</span><span class="n">dihedral_to</span><span class="p">(</span><span class="n">atom3</span><span class="p">)</span>
            <span class="n">atom1</span><span class="o">.</span><span class="n">dihedral_to</span><span class="p">(</span><span class="n">atom4</span><span class="p">)</span>
            <span class="n">atom2</span><span class="o">.</span><span class="n">dihedral_to</span><span class="p">(</span><span class="n">atom3</span><span class="p">)</span>
            <span class="n">atom2</span><span class="o">.</span><span class="n">dihedral_to</span><span class="p">(</span><span class="n">atom4</span><span class="p">)</span>
            <span class="n">atom3</span><span class="o">.</span><span class="n">dihedral_to</span><span class="p">(</span><span class="n">atom4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_funct</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">funct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">DihedralTypeList</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">9</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">RBTorsionType</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">3</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funct</span>

    <span class="nd">@funct</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">funct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_funct</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Quick and easy way to find out if an Atom or Bond is in this Dihedral &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
        <span class="c1"># A dihedral is made up of 3 bonds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">improper</span><span class="p">:</span>
            <span class="c1"># An improper is different... Atom 3 is the central atom</span>
            <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>

<div class="viewcode-block" id="Dihedral.same_atoms"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Dihedral.same_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">same_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines if this dihedral has the same atoms (or atom indexes) as</span>
<span class="sd">        another object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        thing : :class:`Dihedral` or other ``iterable``</span>
<span class="sd">            A Dihedral or an iterable with 4 indexes that will be used to</span>
<span class="sd">            identify whether this torsion has the same atoms</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        is_same : ``bool``</span>
<span class="sd">            True if ``thing`` and ``self`` have the same atoms. ``False``</span>
<span class="sd">            otherwise</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This raises a ``TypeError`` if thing is not a Dihedral and is not</span>
<span class="sd">        iterable</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Dihedral</span><span class="p">):</span>
            <span class="c1"># I&#39;m comparing with another Dihedral here</span>
            <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">and</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">and</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
                   <span class="p">)</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
        <span class="c1"># Here, atoms are expected to index from 0 (Python standard) if we</span>
        <span class="c1"># are comparing with a list or tuple</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;comparative </span><span class="si">%s</span><span class="s1"> has </span><span class="si">%d</span><span class="s1"> elements! Expect 4.&#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing</span><span class="p">)))</span>
        <span class="c1"># Compare starting_index, since we may not have an index right now</span>
        <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span></div>

<div class="viewcode-block" id="Dihedral.delete"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Dihedral.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes this dihedral from the atoms that make it up. This method</span>
<span class="sd">        removes this dihedral from the `dihedrals` list for atom1, atom2, atom3,</span>
<span class="sd">        and atom4 as well as removing each atom form each others&#39; dihedral</span>
<span class="sd">        partner lists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">improper</span><span class="p">:</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
            <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">_dihedral_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dihedral.measure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Dihedral.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current dihedral angle</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        measurement : float or None</span>
<span class="sd">            If the atoms have coordinates, returns the dihedral angle between the four atoms in</span>
<span class="sd">            degrees. If any coordinates are missing, returns None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dihedral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dihedral.umeasure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Dihedral.umeasure">[docs]</a>    <span class="k">def</span> <span class="nf">umeasure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as measure(), but with units &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dihedral.energy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Dihedral.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current dihedral angle energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        energy : float or None</span>
<span class="sd">            Dihedral angle energy in kcal/mol. Return value is None if either</span>
<span class="sd">            the coordinates of either atom is not set or the angle type is not</span>
<span class="sd">            set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">phi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">phi</span> <span class="o">*=</span>  <span class="n">DEG_TO_RAD</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">DihedralType</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">phi_k</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">per</span><span class="o">*</span><span class="n">phi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">phase</span><span class="o">*</span><span class="n">DEG_TO_RAD</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">DihedralTypeList</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">+=</span> <span class="n">term</span><span class="o">.</span><span class="n">phi_k</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">per</span><span class="o">*</span><span class="n">phi</span> <span class="o">-</span>
                                                <span class="n">term</span><span class="o">.</span><span class="n">phase</span><span class="o">*</span><span class="n">DEG_TO_RAD</span><span class="p">))</span>
            <span class="n">e</span> <span class="o">*=</span> <span class="mf">0.5</span>
            <span class="k">return</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Only DihedralType and DihedralTypeList &#39;</span>
                                      <span class="s1">&#39;are supported for energy calculations&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dihedral.uenergy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Dihedral.uenergy">[docs]</a>    <span class="k">def</span> <span class="nf">uenergy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as energy(), but with units &quot;&quot;&quot;</span>
        <span class="n">ene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ene</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="k">if</span> <span class="n">ene</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">improper</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [imp]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_end</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [ign]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">; type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="DihedralType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.DihedralType.html#parmed.DihedralType">[docs]</a><span class="k">class</span> <span class="nc">DihedralType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dihedral type with a set of dihedral parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    phi_k : ``float``</span>
<span class="sd">        The force constant in kcal/mol</span>
<span class="sd">    per : ``int``</span>
<span class="sd">        The dihedral periodicity</span>
<span class="sd">    phase : ``float``</span>
<span class="sd">        The dihedral phase in degrees</span>
<span class="sd">    scee : ``float``, optional</span>
<span class="sd">        1-4 electrostatic scaling factor. Default is 1.0</span>
<span class="sd">    scnb : ``float``, optional</span>
<span class="sd">        1-4 Lennard-Jones scaling factor. Default is 1.0</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        A list of `DihedralType`s in which this is a member</span>

<span class="sd">    Inherited Attributes</span>
<span class="sd">    --------------------</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this DihedralType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two :class:`DihedralType`s are equal if their `phi_k`, `per`, `phase`,</span>
<span class="sd">    `scee`, and `scnb` attributes are equal</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; dt1 = DihedralType(10.0, 2, 180.0, 1.2, 2.0)</span>
<span class="sd">    &gt;&gt;&gt; dt2 = DihedralType(10.0, 2, 180.0, 1.2, 2.0)</span>
<span class="sd">    &gt;&gt;&gt; dt1 is dt2</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; dt1 == dt2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; dt1.idx # not part of any list or iterable</span>
<span class="sd">    -1</span>

<span class="sd">    As part of a list, they can be indexed</span>

<span class="sd">    &gt;&gt;&gt; dihedral_list = []</span>
<span class="sd">    &gt;&gt;&gt; dihedral_list.append(DihedralType(10.0, 2, 180.0, 1.2, 2.0,</span>
<span class="sd">    ...                                   list=dihedral_list))</span>
<span class="sd">    &gt;&gt;&gt; dihedral_list.append(DihedralType(10.0, 2, 180.0, 1.2, 2.0,</span>
<span class="sd">    ...                                   list=dihedral_list))</span>
<span class="sd">    &gt;&gt;&gt; dihedral_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; dihedral_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#===================================================</span>

<div class="viewcode-block" id="DihedralType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.DihedralType.html#parmed.DihedralType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phi_k</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">scee</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scnb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; DihedralType constructor &quot;&quot;&quot;</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_k</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">phi_k</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scee</span> <span class="o">=</span> <span class="n">scee</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scnb</span> <span class="o">=</span> <span class="n">scnb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1">#===================================================</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_k</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">phi_k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">per</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">per</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scee</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">scee</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scnb</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">scnb</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; phi_k=</span><span class="si">%.3f</span><span class="s1">, per=</span><span class="si">%d</span><span class="s1">, phase=</span><span class="si">%.3f</span><span class="s1">, &#39;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">per</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)]</span>
        <span class="n">retstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; scee=</span><span class="si">%.3f</span><span class="s1">, scnb=</span><span class="si">%.3f</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scee</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scnb</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">retstr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DihedralType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">per</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scee</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scnb</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_k</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">per</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scee</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scnb</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uphi_k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_k</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uphase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="RBTorsionType"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.RBTorsionType">[docs]</a><span class="k">class</span> <span class="nc">RBTorsionType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Ryckaert-Bellemans type with a set of dihedral parameters</span>

<span class="sd">    Parameters (and Attributes)</span>
<span class="sd">    ---------------------------</span>
<span class="sd">    c0 : float</span>
<span class="sd">        The coefficient of the constant term in kcal/mol</span>
<span class="sd">    c1 : float</span>
<span class="sd">        The coefficient of the linear term in kcal/mol</span>
<span class="sd">    c2 : float</span>
<span class="sd">        The coefficient of the quadratic term in kcal/mol</span>
<span class="sd">    c3 : float</span>
<span class="sd">        The coefficient of the cubic term in kcal/mol</span>
<span class="sd">    c4 : float</span>
<span class="sd">        The coefficient of the quartic term in kcal/mol</span>
<span class="sd">    c5 : float</span>
<span class="sd">        The coefficient of the quintic term in kcal/mol</span>
<span class="sd">    scee : float, optional</span>
<span class="sd">        1-4 electrostatic scaling factor. Default is 1.0</span>
<span class="sd">    scnb : float, optional</span>
<span class="sd">        1-4 van der Waals scaling factor. Default is 1.0</span>
<span class="sd">    list : TrackedList=None</span>
<span class="sd">        A list of `RBTorsionType`s in which this is a member</span>

<span class="sd">    Inherited Attributes</span>
<span class="sd">    --------------------</span>
<span class="sd">    idx : int</span>
<span class="sd">        The index of this RBTorsionType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two `RBTorsionType`s are equal if their coefficients are all equal</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; dt1 = RBTorsionType(10.0, 20.0, 30.0, 40.0, 50.0, 60.0)</span>
<span class="sd">    &gt;&gt;&gt; dt2 = RBTorsionType(10.0, 20.0, 30.0, 40.0, 50.0, 60.0)</span>
<span class="sd">    &gt;&gt;&gt; dt1 is dt2</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; dt1 == dt2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; dt1.idx # not part of any list or iterable</span>
<span class="sd">    -1</span>

<span class="sd">    As part of a list, they can be indexed</span>

<span class="sd">    &gt;&gt;&gt; rb_torsion_list = []</span>
<span class="sd">    &gt;&gt;&gt; rb_torsion_list.append(RBTorsionType(10.0, 20.0, 30.0, 40.0, 50.0, 60.0,</span>
<span class="sd">    ...                                      list=rb_torsion_list))</span>
<span class="sd">    &gt;&gt;&gt; rb_torsion_list.append(RBTorsionType(10.0, 20.0, 30.0, 40.0, 50.0, 60.0,</span>
<span class="sd">    ...                                      list=rb_torsion_list))</span>
<span class="sd">    &gt;&gt;&gt; rb_torsion_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; rb_torsion_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#===================================================</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="n">scee</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scnb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c3</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c4</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c5</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">c5</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scee</span> <span class="o">=</span> <span class="n">scee</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scnb</span> <span class="o">=</span> <span class="n">scnb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1">#===================================================</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c0</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c3</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c4</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c5</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">c5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RBTorsionType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c4</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">c5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scee</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scnb</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&lt;RBTorsionType; c0=</span><span class="si">%.3f</span><span class="s1">; c1=</span><span class="si">%.3f</span><span class="s1">; c2=</span><span class="si">%.3f</span><span class="s1">; c3=</span><span class="si">%.3f</span><span class="s1">; c4=</span><span class="si">%.3f</span><span class="s1">; &#39;</span>
                <span class="s1">&#39;c5=</span><span class="si">%.3f</span><span class="s1">; scee=</span><span class="si">%s</span><span class="s1">; scnb=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c5</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">scee</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scnb</span><span class="p">))</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c3</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c4</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c5</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uc0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uc1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uc2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uc3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uc4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uc5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="DihedralTypeList"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.DihedralTypeList.html#parmed.DihedralTypeList">[docs]</a><span class="k">class</span> <span class="nc">DihedralTypeList</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dihedral types are a Fourier expansion of terms. In some cases, they are</span>
<span class="sd">    stored in a list like this one inside another TrackedList. In other cases,</span>
<span class="sd">    each term is a separate entry in the :class:`TrackedList`.</span>

<span class="sd">    In cases where `DihedralType`s are stored with every term in the same</span>
<span class="sd">    container, this object supports list assignment and indexing like</span>
<span class="sd">    :class:`DihedralType`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args : objects</span>
<span class="sd">        Any arguments that ``list`` would take.</span>
<span class="sd">    list : TrackedList, optional</span>
<span class="sd">        A list that &quot;contains&quot; this DihedralTypeList instance. This is a</span>
<span class="sd">        keyword-only argument. Default is ``None`` (i.e., belonging to no list)</span>
<span class="sd">    **kwargs : keyword argument list</span>
<span class="sd">        All other keyword arguments passed directly to the ``list`` constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DihedralTypeList.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.DihedralTypeList.html#parmed.DihedralTypeList.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;list&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="DihedralTypeList.from_rbtorsion"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.DihedralTypeList.from_rbtorsion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_rbtorsion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rbtorsion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Fourier series of proper torsions from a Ryckaerts-Bellemans</span>
<span class="sd">        torsion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rbtorsion : RBTorsionType</span>
<span class="sd">            The R-B torsion type to convert to a series of proper torsions</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError if all terms in rbtorsion are zero except for c0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">rbtorsion</span><span class="o">.</span><span class="n">c0</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">rbtorsion</span><span class="o">.</span><span class="n">c1</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">rbtorsion</span><span class="o">.</span><span class="n">c2</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">rbtorsion</span><span class="o">.</span><span class="n">c3</span>
        <span class="n">c4</span> <span class="o">=</span> <span class="n">rbtorsion</span><span class="o">.</span><span class="n">c4</span>
        <span class="n">c5</span> <span class="o">=</span> <span class="n">rbtorsion</span><span class="o">.</span><span class="n">c5</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span>
        <span class="n">fc0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">c0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">c4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c5</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.</span>
        <span class="n">fc1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">c5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span>
        <span class="n">fc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c2</span> <span class="o">+</span> <span class="n">c4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">fc3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">c5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span>
        <span class="n">fc4</span> <span class="o">=</span> <span class="n">c4</span> <span class="o">/</span> <span class="mi">8</span>
        <span class="n">fc5</span> <span class="o">=</span> <span class="o">-</span><span class="n">c5</span> <span class="o">/</span> <span class="mi">16</span>

        <span class="n">inst</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">fc0</span><span class="p">,</span> <span class="n">fc1</span><span class="p">,</span> <span class="n">fc2</span><span class="p">,</span> <span class="n">fc3</span><span class="p">,</span> <span class="n">fc4</span><span class="p">,</span> <span class="n">fc5</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TINY</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DihedralType</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">scee</span><span class="o">=</span><span class="n">rbtorsion</span><span class="o">.</span><span class="n">scee</span><span class="p">,</span> <span class="n">scnb</span><span class="o">=</span><span class="n">rbtorsion</span><span class="o">.</span><span class="n">scnb</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># All force constants were zeros:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fc0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DihedralType</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">scee</span><span class="o">=</span><span class="n">rbtorsion</span><span class="o">.</span><span class="n">scee</span><span class="p">,</span> <span class="n">scnb</span><span class="o">=</span><span class="n">rbtorsion</span><span class="o">.</span><span class="n">scnb</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unable to convert RB torsion to propers.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t1</span> <span class="o">==</span> <span class="n">t2</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="DihedralTypeList.append"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.DihedralTypeList.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a DihedralType to the DihedralTypeList</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`DihedralType`</span>
<span class="sd">            The DihedralType instance to add to this list. It cannot have the</span>
<span class="sd">            same periodicity as any other DihedralType in the list</span>
<span class="sd">        override : bool, optional, default=False</span>
<span class="sd">            If True, this will override an existing torsion, but will raise a</span>
<span class="sd">            warning if it does so</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError if other is not an instance of :class:`DihedralTypeList`</span>

<span class="sd">        ParameterError if other has the same periodicity as another member in</span>
<span class="sd">        this list and override is False</span>

<span class="sd">        ParameterWarning if other has same periodicit as another member in this</span>
<span class="sd">        list and override is True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DihedralType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Can only add DihedralType to DihedralTypeList&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">existing</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">existing</span><span class="o">.</span><span class="n">per</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">per</span><span class="p">:</span>
                <span class="c1"># Do not add duplicate periodicities</span>
                <span class="k">if</span> <span class="n">existing</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span> <span class="k">return</span>
                <span class="k">if</span> <span class="n">override</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Overriding DihedralType in DihedralTypeList &#39;</span>
                                  <span class="s1">&#39;with same periodicity&#39;</span><span class="p">,</span> <span class="n">ParameterWarning</span><span class="p">)</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Cannot add two DihedralType instances with the same &#39;</span>
                                         <span class="s1">&#39;periodicity to the same DihedralTypeList&#39;</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">penalty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">penalty</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">penalty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">penalty</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">penalty</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">penalty</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">penalty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">penalty</span><span class="p">,</span> <span class="n">penalty</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">penalty</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;DihedralTypes </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DihedralTypeList</span><span class="p">([</span><span class="n">copy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">([</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="UreyBradley"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.UreyBradley.html#parmed.UreyBradley">[docs]</a><span class="k">class</span> <span class="nc">UreyBradley</span><span class="p">(</span><span class="n">Bond</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Urey-Bradley angle type with a set of parameters. It has the same</span>
<span class="sd">    functional form as a bond, but it is defined between two atoms forming a</span>
<span class="sd">    valence angle separated by two bonds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first atom involved in the Urey-Bradley bond</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The other atom involved in the Urey-Bradley bond</span>
<span class="sd">    type : :class:`BondType`</span>
<span class="sd">        The Urey-Bradley bond type that defines the parameters for this bond</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    You can test whether an :class:`Atom` is contained within the bond using the</span>
<span class="sd">    `in` operator. A :class:`MoleculeError` is raised if `atom1` and `atom2` are</span>
<span class="sd">    identical.  You can also test that a :class:`Bond` is contained in this</span>
<span class="sd">    Urey-Bradley valence angle</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1, a2, a3 = Atom(), Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; b1 = Bond(a1, a2)</span>
<span class="sd">    &gt;&gt;&gt; b2 = Bond(a2, a3)</span>
<span class="sd">    &gt;&gt;&gt; angle = Angle(a1, a2, a3)</span>
<span class="sd">    &gt;&gt;&gt; urey = UreyBradley(a1, a3)</span>
<span class="sd">    &gt;&gt;&gt; a1 in urey and a3 in urey</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; b1 in urey and b2 in urey</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="UreyBradley.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.UreyBradley.html#parmed.UreyBradley.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Bond constructor &quot;&quot;&quot;</span>
        <span class="c1"># Make sure we&#39;re not bonding me to myself</span>
        <span class="k">if</span> <span class="n">atom1</span> <span class="ow">is</span> <span class="n">atom2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;Cannot bond atom to itself! &#39;</span>
                                <span class="s1">&#39;Atoms are </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">))</span>
        <span class="c1"># Order the atoms so the lowest atom # is first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="c1"># Log this urey-bradley in the atoms</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">urey_bradleys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">urey_bradleys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Load the force constant and equilibrium distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="s2">&quot; Quick and easy way to see if an Atom or Bond is in this Urey-Bradley &quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span>
        <span class="c1"># If this is a bond things are a bit more complicated since we don&#39;t</span>
        <span class="c1"># know the central atom of this Urey-Bradley. We need to make sure that</span>
        <span class="c1"># one of the atoms of the bond is either atom1 or atom2 and that the</span>
        <span class="c1"># OTHER atom in Bond &quot;thing&quot; has the OTHER atom in this Urey-Bradley in</span>
        <span class="c1"># its list of bonded partners.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># Neither atom is in this Urey-Bradley...</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># If we are here, thing.atom2 is in self</span>
            <span class="n">end1</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom2</span>
            <span class="n">cent</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we are here, thing.atom1 is in self</span>
            <span class="n">end1</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span>
            <span class="n">cent</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom2</span>
        <span class="c1"># If we are here, end1 and cent are set. Look through the bond</span>
        <span class="c1"># partners of cent(er) and see if any of them is in this</span>
        <span class="c1"># Urey-Bradley (but ONLY if that atom is not the original end1)</span>
        <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="n">cent</span><span class="o">.</span><span class="n">bond_partners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atm</span> <span class="ow">is</span> <span class="n">end1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">atm</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># If we got here, we found both atoms in this Urey-Bradley</span>
            <span class="c1"># separated by 2 bonds, so &quot;thing&quot; IS in this Urey-Bradley</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># If we got here, we could not find the other atom connected by 2</span>
        <span class="c1"># bonds</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="UreyBradley.delete"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.UreyBradley.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes this Urey-Bradley from the atoms that make it up. This method</span>
<span class="sd">        removes this urey-bradley from the `urey_bradleys` list for atom1 and</span>
<span class="sd">        atom2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">urey_bradleys</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">urey_bradleys</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">; type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Improper"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Improper.html#parmed.Improper">[docs]</a><span class="k">class</span> <span class="nc">Improper</span><span class="p">(</span><span class="n">_FourAtomTerm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A CHARMM-style improper torsion between 4 atoms. The first atom must be the</span>
<span class="sd">    central atom, as shown in the schematic below</span>

<span class="sd">                      A3</span>
<span class="sd">                      |</span>
<span class="sd">                      |</span>
<span class="sd">             A4 ----- A1 ----- A2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The central atom A1 in the schematic above</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        An atom in the improper, A2 in the schematic above</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        An atom in the improper, A3 in the schematic above</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        An atom in the improper, A4 in the schematic above</span>
<span class="sd">    type : :class:`ImproperType`</span>
<span class="sd">        The ImproperType object containing the parameters for this improper</span>
<span class="sd">        torsion</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    An Improper torsion can contain bonds or atoms. A bond is contained if it</span>
<span class="sd">    exists between atom 1 and any other atom. Raises :class:`MoleculeError` if any</span>
<span class="sd">    of the atoms are duplicates.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1, a2, a3, a4 = Atom(), Atom(), Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; imp = Improper(a1, a2, a3, a4)</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a2) in imp and Bond(a1, a3) in imp and Bond(a1, a4) in imp</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Bond(a2, a3) in imp</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Improper.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Improper.html#parmed.Improper.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">)</span>
        <span class="c1"># Log these impropers in each atom</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">impropers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">impropers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom3</span><span class="o">.</span><span class="n">impropers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom4</span><span class="o">.</span><span class="n">impropers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Load the force constant and equilibrium angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funct</span> <span class="o">=</span> <span class="mi">2</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Quick and easy way to find out if an Atom or Bond is in this Improper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
        <span class="c1"># Treat it like a Bond</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>

<div class="viewcode-block" id="Improper.same_atoms"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Improper.same_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">same_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An improper has the same 4 atoms if atom1 is the same for both and the</span>
<span class="sd">        other 3 can be in any order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Improper</span><span class="p">):</span>
            <span class="c1"># I&#39;m comparing with another Improper here. Central atom must be</span>
            <span class="c1"># the same. Others can be in any order</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Make a set with the remaining atoms. If they are equal, the</span>
            <span class="c1"># impropers are equivalent</span>
            <span class="n">selfset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">])</span>
            <span class="n">otherset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thing</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom4</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">selfset</span> <span class="o">==</span> <span class="n">otherset</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
        <span class="c1"># Here, atoms are expected to index from 0 (Python standard) if we</span>
        <span class="c1"># are comparing with a list or tuple</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;Impropers have 4 atoms, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">idx</span> <span class="o">!=</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">selfset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">otherset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thing</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">thing</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">thing</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">selfset</span> <span class="o">==</span> <span class="n">otherset</span></div>

<div class="viewcode-block" id="Improper.measure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Improper.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current torsional angle</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        measurement : float or None</span>
<span class="sd">            If the atoms have coordinates, returns the torsional angle between</span>
<span class="sd">            the four atoms. If any coordinates are missing, returns None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dihedral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Improper.umeasure"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Improper.umeasure">[docs]</a>    <span class="k">def</span> <span class="nf">umeasure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as measure(), but with units &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Improper.energy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Improper.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Measures the current dihedral angle energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        energy : float or None</span>
<span class="sd">            Dihedral angle energy in kcal/mol. Return value is None if either</span>
<span class="sd">            the coordinates of either atom is not set or the angle type is not</span>
<span class="sd">            set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">phi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">psi_eq</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">DEG_TO_RAD</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">psi_k</span> <span class="o">*</span> <span class="n">dphi</span> <span class="o">*</span> <span class="n">dphi</span></div>

<div class="viewcode-block" id="Improper.uenergy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Improper.uenergy">[docs]</a>    <span class="k">def</span> <span class="nf">uenergy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Same as energy(), but with units &quot;&quot;&quot;</span>
        <span class="n">ene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ene</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="k">if</span> <span class="n">ene</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Improper.delete"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Improper.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes this Improper from the atoms that make it up. This method</span>
<span class="sd">        removes this Improper from the `impropers` list for atom1, atom2, atom3,</span>
<span class="sd">        and atom4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1">--(</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">); type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="ImproperType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.ImproperType.html#parmed.ImproperType">[docs]</a><span class="k">class</span> <span class="nc">ImproperType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An improper type with a set of improper torsion parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi_k : ``float``</span>
<span class="sd">        Force constant in kcal/mol/radians^2</span>
<span class="sd">    psi_eq : ``float``</span>
<span class="sd">        Equilibrium torsion angle in Degrees</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        A list of `ImproperType`s in which this is a member</span>

<span class="sd">    Inherited Attributes</span>
<span class="sd">    --------------------</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this ImproperType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two `ImproperType`s are equal if their `psi_k` and `psi_eq` attributes are</span>
<span class="sd">    equal</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; it1 = ImproperType(10.0, 180.0)</span>
<span class="sd">    &gt;&gt;&gt; it2 = ImproperType(10.0, 180.0)</span>
<span class="sd">    &gt;&gt;&gt; it1 is it2</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; it1 == it2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; it1.idx # Not part of any list or iterable</span>
<span class="sd">    -1</span>

<span class="sd">    As part of a list, they can be indexed</span>

<span class="sd">    &gt;&gt;&gt; improper_list = []</span>
<span class="sd">    &gt;&gt;&gt; improper_list.append(ImproperType(10.0, 180.0, list=improper_list))</span>
<span class="sd">    &gt;&gt;&gt; improper_list.append(ImproperType(10.0, 180.0, list=improper_list))</span>
<span class="sd">    &gt;&gt;&gt; improper_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; improper_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ImproperType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.ImproperType.html#parmed.ImproperType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi_k</span><span class="p">,</span> <span class="n">psi_eq</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi_k</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">psi_k</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">radians</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi_eq</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">psi_eq</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi_k</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">psi_k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi_eq</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">psi_eq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; psi_k=</span><span class="si">%.3f</span><span class="s1">, psi_eq=</span><span class="si">%.3f</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi_k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi_eq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ImproperType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi_k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi_eq</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi_k</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi_eq</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">upsi_k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi_k</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">radians</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">upsi_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi_eq</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Cmap"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Cmap.html#parmed.Cmap">[docs]</a><span class="k">class</span> <span class="nc">Cmap</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A coupled-torsion correction map term defined between 5 atoms connected by</span>
<span class="sd">    four covalent bonds. This is a coupled-torsion potential in which the</span>
<span class="sd">    torsions are consecutive.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        An atom on one end of the valence coupled-torsion bonded to atom2</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the CMAP bonded to atoms 1 and 3</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the CMAP bonded to atoms 2 and 4</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the CMAP bonded to atoms 3 and 5</span>
<span class="sd">    atom5 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the CMAP bonded to atom 4</span>
<span class="sd">    type : :class:`CmapType`</span>
<span class="sd">        The CmapType object containing the parameter map for this term</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A CMAP can contain bonds or atoms. A bond is contained if it exists between</span>
<span class="sd">    atoms 1 and 2, between atoms 2 and 3, between atoms 3 and 4, or between</span>
<span class="sd">    atoms 4 and 5.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1, a2, a3, a4, a5 = Atom(), Atom(), Atom(), Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; cmap = Cmap(a1, a2, a3, a4, a5)</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a2) in cmap and Bond(a2, a3) in cmap</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a3) in cmap</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Cmap.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Cmap.html#parmed.Cmap.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">atom5</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Make sure we&#39;re not CMAPping me to myself</span>
        <span class="n">atmlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">atom5</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atmlist</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">atmlist</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">atmlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="n">atmlist</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;Cannot cmap atom to itself! &#39;</span>
                                        <span class="s1">&#39;Atoms are </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atmlist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                             <span class="n">atmlist</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="c1"># Set up instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="n">atom3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="n">atom4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="o">=</span> <span class="n">atom5</span>
        <span class="c1"># Log these cmaps in each atom</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">cmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">cmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom3</span><span class="o">.</span><span class="n">cmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom4</span><span class="o">.</span><span class="n">cmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom5</span><span class="o">.</span><span class="n">cmaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Load the CMAP interpolation table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funct</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Cmap.extended"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Cmap.extended">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">extended</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">atom5</span><span class="p">,</span> <span class="n">atom6</span><span class="p">,</span> <span class="n">atom7</span><span class="p">,</span> <span class="n">atom8</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alternative constructor for correction maps defined with 8 atoms (each</span>
<span class="sd">        torsion being separately specified). Correction maps are, to the best of</span>
<span class="sd">        my knowledge, used to parametrized &quot;consecutive&quot; torsions (i.e., atoms</span>
<span class="sd">        2, 3, and 4 are common to both torsions). However, the CHARMM definition</span>
<span class="sd">        specifies the torsions separately.</span>

<span class="sd">        If the torsions are _not_ consecutive (i.e., if atoms 2, 3, and 4 are</span>
<span class="sd">        not the same as atoms 5, 6, and 7), NotImplementedError is raised.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atom1 : :class:`Atom`</span>
<span class="sd">            The first atom of the first torsion</span>
<span class="sd">        atom2 : :class:`Atom`</span>
<span class="sd">            The second atom of the first torsion</span>
<span class="sd">        atom3 : :class:`Atom`</span>
<span class="sd">            The third atom of the first torsion</span>
<span class="sd">        atom4 : :class:`Atom`</span>
<span class="sd">            The fourth atom of the first torsion</span>
<span class="sd">        atom5 : :class:`Atom`</span>
<span class="sd">            The first atom of the second torsion</span>
<span class="sd">        atom6 : :class:`Atom`</span>
<span class="sd">            The second atom of the second torsion</span>
<span class="sd">        atom7 : :class:`Atom`</span>
<span class="sd">            The third atom of the second torsion</span>
<span class="sd">        atom8 : :class:`Atom`</span>
<span class="sd">            The fourth atom of the second torsion</span>
<span class="sd">        type : :class:`CmapType`</span>
<span class="sd">            The CmapType object containing the parameter map for this term</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">atom2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">atom5</span> <span class="ow">or</span> <span class="n">atom3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">atom6</span> <span class="ow">or</span> <span class="n">atom7</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">atom4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Only consecutive coupled-torsions are &#39;</span>
                                      <span class="s1">&#39;supported by CMAPs currently&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">atom8</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Quick and easy way to find out an atom or bond is in this</span>
<span class="sd">        coupled-torsion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">or</span>
                    <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">or</span>
                    <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>

<div class="viewcode-block" id="Cmap.same_atoms"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Cmap.same_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">same_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A coupled-torsion is equivalent if the 5 atoms are in the same or</span>
<span class="sd">        reverse order Allow comparison with another type of cmap or with a</span>
<span class="sd">        sequence of 5 indexes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Cmap</span><span class="p">):</span>
            <span class="c1"># I&#39;m comparing with another Improper here. Central atom must be the</span>
            <span class="c1"># same. Others can be in any order</span>
            <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom5</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="ow">is</span> <span class="n">thing</span><span class="o">.</span><span class="n">atom1</span><span class="p">))</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
        <span class="c1"># Here, atoms are expected to index from 0 (Python standard) if we</span>
        <span class="c1"># are comparing with a list or tuple</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MoleculeError</span><span class="p">(</span><span class="s1">&#39;CMAP can compare to 5 elements, not </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Cmap.delete"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Cmap.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes this Cmap from the atoms that make it up. This method removes</span>
<span class="sd">        the Cmap from the `cmaps` list for atom1, atom2, atom3, atom4, and atom5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">cmaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">cmaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">cmaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">cmaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">cmaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">; type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="CmapType"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.CmapType">[docs]</a><span class="k">class</span> <span class="nc">CmapType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A CMAP type with a potential energy interpoloation grid mapping out the 2-D</span>
<span class="sd">    potential of coupled torsions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resolution : ``int``</span>
<span class="sd">        The number of grid points in the correction map potential in both</span>
<span class="sd">        torsion dimensions</span>
<span class="sd">    grid : ``iterable of floats``</span>
<span class="sd">        This must be a 1-dimensional list of grid values. The dimension must be</span>
<span class="sd">        `resolution*resolution`, and must be row-major (i.e., the second</span>
<span class="sd">        dimension changes the fastest) when indexed with 2 indices.</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        A list of `CmapType`s in which this is a member</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    resolution : ``int``</span>
<span class="sd">        Potential grid resolution (see description in Parameters)</span>
<span class="sd">    grid : :class:`_CmapGrid`</span>
<span class="sd">        A _CmapGrid object defining the interpolating potential energy grid,</span>
<span class="sd">        with each point having the units kcal/mol</span>
<span class="sd">    comments : ``list(str)``</span>
<span class="sd">        List of strings that represent comments about this parameter type</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        If not None, this is a list in which this instance _may_ be a member</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this CmapType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two `CmapType`s are equal if their resolution is the same and each grid</span>
<span class="sd">    point is the same to within 1E-8</span>

<span class="sd">    See the docs for `_CmapGrid` for information on how to access the</span>
<span class="sd">    interpolating grid data if necessary.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError is raised if the grid does not have the correct number of elements</span>
<span class="sd">    for the given resolution</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ct = CmapType(2, [0, 1, 2, 3])</span>
<span class="sd">    &gt;&gt;&gt; ct.grid[0,0], ct.grid[0]</span>
<span class="sd">    (0, 0)</span>
<span class="sd">    &gt;&gt;&gt; ct.grid[0,1], ct.grid[1]</span>
<span class="sd">    (1, 1)</span>
<span class="sd">    &gt;&gt;&gt; ct.grid[1,0], ct.grid[2]</span>
<span class="sd">    (2, 2)</span>
<span class="sd">    &gt;&gt;&gt; ct.grid[1,1], ct.grid[3]</span>
<span class="sd">    (3, 3)</span>
<span class="sd">    &gt;&gt;&gt; ct.idx # not part of a list or iterable</span>
<span class="sd">    -1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">_CmapGrid</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;CMAP grid does not match expected resolution&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="n">comments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">and</span>
                <span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">grid</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; resolution=</span><span class="si">%d</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CmapType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">[:])</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">))</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<span class="k">class</span> <span class="nc">_CmapGrid</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A grid object for storing Correction map data. Data can be accessed in one</span>
<span class="sd">    of two ways; either with 1 or 2 indexes. If 2 indexes [i,j] are given, the</span>
<span class="sd">    index into the flattened array is i*resolution+j. Indexing starts from 0.</span>

<span class="sd">    The _CmapGrid usually has ranges for the two angles from -180 to 180. Some</span>
<span class="sd">    places will expect the range to be 0-360 degrees (e.g., OpenMM). The</span>
<span class="sd">    switch_range method returns a _CmapGrid with the &quot;other&quot; range than the</span>
<span class="sd">    current object.  i.e., if the current range is from 0 to 360 degrees, the</span>
<span class="sd">    _CmapGrid returned by `switch_range` will be from -180 to 180, and vice</span>
<span class="sd">    versa.</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; g = _CmapGrid(2, [0, 1, 2, 3])</span>
<span class="sd">    &gt;&gt;&gt; print(&#39;%s %s&#39; % (g[0], g[0,0]))</span>
<span class="sd">    0 0</span>
<span class="sd">    &gt;&gt;&gt; print(&#39;%s %s&#39; % (g[1], g[0,1]))</span>
<span class="sd">    1 1</span>
<span class="sd">    &gt;&gt;&gt; print(g[1,0])</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; g[1,1] = 10</span>
<span class="sd">    &gt;&gt;&gt; print(g[3])</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; print(g.switch_range())</span>
<span class="sd">    [10.0000, 2.0000</span>
<span class="sd">     1.0000, 0.0000]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The transpose of the potential grid &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_transpose&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span>
        <span class="n">_transpose</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">):</span>
            <span class="n">piece</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)]</span>
            <span class="n">_transpose</span> <span class="o">+=</span> <span class="n">piece</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span> <span class="o">=</span> <span class="n">_CmapGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="n">_transpose</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span>

    <span class="n">T</span> <span class="o">=</span> <span class="n">transpose</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">or</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;_CmapGrid: Index out of range&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="o">*</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">or</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;_CmapGrid: Index out of range&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="o">*</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">idx</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">lenval</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">lenval</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">lenval</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">lenval</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong number of values setting a slice&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;_CmapGrid: </span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">%.4f</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">%.4f</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">retstr</span> <span class="o">+=</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">val</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">retstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">retstr</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
        <span class="k">return</span> <span class="n">retstr</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">resolution</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TINY</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">switch_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a grid object whose range is 0 to 360 degrees in both dimensions</span>
<span class="sd">        instead of -180 to 180 degrees (or -180 to 180 degrees if the range is</span>
<span class="sd">        already 0 to 360 degrees)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">res</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">newgrid</span> <span class="o">=</span> <span class="n">_CmapGrid</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">mid</span><span class="p">)</span> <span class="o">%</span> <span class="n">res</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
                <span class="n">jj</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">mid</span><span class="p">)</span> <span class="o">%</span> <span class="n">res</span>
                <span class="c1"># Start from the middle</span>
                <span class="n">newgrid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">newgrid</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_CmapGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]))</span>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="TrigonalAngle"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.TrigonalAngle.html#parmed.TrigonalAngle">[docs]</a><span class="k">class</span> <span class="nc">TrigonalAngle</span><span class="p">(</span><span class="n">_FourAtomTerm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A trigonal-angle term in the AMOEBA force field. It exists in a pattern like</span>
<span class="sd">    the one shown below</span>

<span class="sd">                                A1</span>
<span class="sd">                                |</span>
<span class="sd">                                |</span>
<span class="sd">                          A4----A2----A3</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first atom involved in the trigonal angle</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The central atom involved in the trigonal angle</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        The third atom involved in the trigonal angle</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        The fourth atom involved in the trigonal angle</span>
<span class="sd">    type : :class:`AngleType`</span>
<span class="sd">        The angle type containing the parameters</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Either `Atom`s or `Bond`s can be contained within this trigonal angle</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TrigonalAngle.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.TrigonalAngle.html#parmed.TrigonalAngle.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1">--(</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">); type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="OutOfPlaneBend"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.OutOfPlaneBend.html#parmed.OutOfPlaneBend">[docs]</a><span class="k">class</span> <span class="nc">OutOfPlaneBend</span><span class="p">(</span><span class="n">_FourAtomTerm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Out-of-plane bending term in the AMOEBA force field. The bond pattern is the</span>
<span class="sd">    same as :class:`TrigonalAngle`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first atom involved in the trigonal angle</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The central atom involved in the trigonal angle</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        The third atom involved in the trigonal angle</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        The fourth atom involved in the trigonal angle</span>
<span class="sd">    type : :class:`OutOfPlaneBendType`</span>
<span class="sd">        The angle type containing the parameters</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Either `Atom`s or `Bond`s can be contained within this trigonal angle</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="OutOfPlaneBend.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.OutOfPlaneBend.html#parmed.OutOfPlaneBend.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1">--(</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">); type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="OutOfPlaneBendType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.OutOfPlaneBendType.html#parmed.OutOfPlaneBendType">[docs]</a><span class="k">class</span> <span class="nc">OutOfPlaneBendType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An angle type with a set of angle parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : ``float``</span>
<span class="sd">        Force constant in kcal/mol/radians^2</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        A list of `OutOfPlaneBendType`s in which this is a member</span>

<span class="sd">    Inherited Attributes</span>
<span class="sd">    --------------------</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this OutOfPlaneBendType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two `OutOfPlaneBendType`s are equal if their `k` attribute is equal</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ot1 = OutOfPlaneBendType(10.0)</span>
<span class="sd">    &gt;&gt;&gt; ot2 = OutOfPlaneBendType(10.0)</span>
<span class="sd">    &gt;&gt;&gt; ot1 is ot2</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; ot1 == ot2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; ot1.idx # not part of any list or iterable</span>
<span class="sd">    -1</span>

<span class="sd">    As part of a list, they can be indexed</span>

<span class="sd">    &gt;&gt;&gt; oopbend_list = []</span>
<span class="sd">    &gt;&gt;&gt; oopbend_list.append(OutOfPlaneBendType(10.0, list=oopbend_list))</span>
<span class="sd">    &gt;&gt;&gt; oopbend_list.append(OutOfPlaneBendType(10.0, list=oopbend_list))</span>
<span class="sd">    &gt;&gt;&gt; oopbend_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; oopbend_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="OutOfPlaneBendType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.OutOfPlaneBendType.html#parmed.OutOfPlaneBendType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">radians</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; k=</span><span class="si">%.3f</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OutOfPlaneBendType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">radians</span><span class="o">**</span><span class="mi">2</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="PiTorsion"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.PiTorsion.html#parmed.PiTorsion">[docs]</a><span class="k">class</span> <span class="nc">PiTorsion</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a pi-torsion term in the AMOEBA force field. The Pi-torsion is</span>
<span class="sd">    defined around a sp2-hybridized pi-delocalized orbital (like an amide) by 6</span>
<span class="sd">    atoms, as shown in the schematic below.</span>


<span class="sd">         A2           A5-AAA</span>
<span class="sd">           \         /</span>
<span class="sd">            \       /</span>
<span class="sd">             A3---A4</span>
<span class="sd">            /       \</span>
<span class="sd">           /         \</span>
<span class="sd">     AAA-A1           A6</span>

<span class="sd">    In the above schematic, A3 and A4 are sp2-hybridized, and atoms A2 and A6</span>
<span class="sd">    are bonded *only* to A3 and A4, respectively. Atoms A1 and A5 are each</span>
<span class="sd">    bonded to 3 other atoms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        atom A1 in the schematic above</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        atom A2 in the schematic above</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        atom A3 in the schematic above</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        atom A4 in the schematic above</span>
<span class="sd">    atom5 : :class:`Atom`</span>
<span class="sd">        atom A5 in the schematic above</span>
<span class="sd">    atom6 : :class:`Atom`</span>
<span class="sd">        atom A6 in the schematic above</span>
<span class="sd">    type : :class:`DihedralType`</span>
<span class="sd">        The parameters for this Pi-torsion</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Both :class:`Bond`s and :class:`Atom`s can be contained in a pi-torsion</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PiTorsion.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.PiTorsion.html#parmed.PiTorsion.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">atom5</span><span class="p">,</span> <span class="n">atom6</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="n">atom3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="n">atom4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="o">=</span> <span class="n">atom5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom6</span> <span class="o">=</span> <span class="n">atom6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">or</span>
                    <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">or</span>
                    <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom6</span><span class="p">)</span>
        <span class="c1"># Assume Bond</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom6</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; (</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">)--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--(</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">); type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="StretchBend"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.StretchBend.html#parmed.StretchBend">[docs]</a><span class="k">class</span> <span class="nc">StretchBend</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This term models the stretching and bending of a standard valence angle, and</span>
<span class="sd">    is used in the AMOEBA force field</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first atom on one end of the angle</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The central atom in the angle</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        The atom on the other end of the angle</span>
<span class="sd">    type : :class:`StretchBendType`</span>
<span class="sd">        The type containing the stretch-bend parameters</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Both :class:`Bond`s and :class:`Atom`s can be contained in a stretch-bend term</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="StretchBend.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.StretchBend.html#parmed.StretchBend.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="n">atom3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">is</span> <span class="n">thing</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">is</span> <span class="n">thing</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">is</span> <span class="n">thing</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="ow">in</span> <span class="n">thing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">; type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="StretchBendType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.StretchBendType.html#parmed.StretchBendType">[docs]</a><span class="k">class</span> <span class="nc">StretchBendType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stretch-bend type with two distances and an angle in AMOEBA</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k1 : ``float``</span>
<span class="sd">        First force constant in kcal/mol/(radians*angstroms)</span>
<span class="sd">    k2 : ``float``</span>
<span class="sd">        Second force constant in kcal/mol/(radians*angstroms)</span>
<span class="sd">    req1 : ``float``</span>
<span class="sd">        Equilibrium bond distance for bond between the first and second atoms in</span>
<span class="sd">        Angstroms</span>
<span class="sd">    req2 : ``float``</span>
<span class="sd">        Equilibrium bond distance for bond between the second and third atoms in</span>
<span class="sd">        Angstroms</span>
<span class="sd">    theteq : ``float``</span>
<span class="sd">        Equilibrium angle in degrees</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        A list of `StretchBendType`s in which this is a member</span>

<span class="sd">    Inherited Attributes</span>
<span class="sd">    --------------------</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this StretchBendType inside its containing list</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Two `StretchBendType`s are equal if their `req1`, `req2`, `theteq`, and `k`</span>
<span class="sd">    attributes are equal</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; sbt1 = StretchBendType(10.0, 10.0, 1.0, 1.0, 180.0)</span>
<span class="sd">    &gt;&gt;&gt; sbt2 = StretchBendType(10.0, 10.0, 1.0, 1.0, 180.0)</span>
<span class="sd">    &gt;&gt;&gt; sbt1 is sbt2</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; sbt1 == sbt2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; sbt1.idx # Not part of any list or iterable</span>
<span class="sd">    -1</span>

<span class="sd">    As part of a list, they can be indexed</span>

<span class="sd">    &gt;&gt;&gt; strbnd_list = []</span>
<span class="sd">    &gt;&gt;&gt; strbnd_list.append(StretchBendType(10.0, 10.0, 1.0, 1.0, 180.0, strbnd_list))</span>
<span class="sd">    &gt;&gt;&gt; strbnd_list.append(StretchBendType(10.0, 10.0, 1.0, 1.0, 180.0, strbnd_list))</span>
<span class="sd">    &gt;&gt;&gt; strbnd_list[0].idx</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; strbnd_list[1].idx</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="StretchBendType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.StretchBendType.html#parmed.StretchBendType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">,</span> <span class="n">theteq</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">radian</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">radian</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req1</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">req1</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req2</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">req2</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">theteq</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">k1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">k2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">req1</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">req1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">req2</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">req2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theteq</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">theteq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; req1=</span><span class="si">%.3f</span><span class="s1">, req2=</span><span class="si">%.3f</span><span class="s1">, theteq=</span><span class="si">%.3f</span><span class="s1">, k1=</span><span class="si">%.3f</span><span class="s1">, k2=</span><span class="si">%.3f</span><span class="s1">&gt;&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">req1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">req2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">StretchBendType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">req1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">req2</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">req1</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">req2</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theteq</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uk1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">radian</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uk2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">radian</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ureq1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">req1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ureq2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">req2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">utheteq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">theteq</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="TorsionTorsion"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.TorsionTorsion.html#parmed.TorsionTorsion">[docs]</a><span class="k">class</span> <span class="nc">TorsionTorsion</span><span class="p">(</span><span class="n">Cmap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a coupled-torsion map used in the AMOEBA force field similar to the</span>
<span class="sd">    correction-map (CMAP) potential used by the CHARMM force field</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        An atom on one end of the valence torsion-torsion bonded to atom2</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the torsion-torsion bonded to atoms 1 and 3</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the torsion-torsion bonded to atoms 2 and 4</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the torsion-torsion bonded to atoms 3 and 5</span>
<span class="sd">    atom5 : :class:`Atom`</span>
<span class="sd">        An atom in the middle of the torsion-torsion bonded to atom 4</span>
<span class="sd">    type : :class:`TorsionTorsionType`</span>
<span class="sd">        The TorsionTorsionType object containing the parameter map for this term</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A TorsionTorsion can contain bonds or atoms. A bond is contained if it</span>
<span class="sd">    exists between atoms 1 and 2, between atoms 2 and 3, between atoms 3 and 4,</span>
<span class="sd">    or between atoms 4 and 5.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; a1, a2, a3, a4, a5 = Atom(), Atom(), Atom(), Atom(), Atom()</span>
<span class="sd">    &gt;&gt;&gt; tortor = TorsionTorsion(a1, a2, a3, a4, a5)</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a2) in tortor and Bond(a2, a3) in tortor</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Bond(a1, a3) in tortor</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TorsionTorsion.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.TorsionTorsion.html#parmed.TorsionTorsion.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">atom5</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">Cmap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">atom5</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">tortors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">tortors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom3</span><span class="o">.</span><span class="n">tortors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom4</span><span class="o">.</span><span class="n">tortors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom5</span><span class="o">.</span><span class="n">tortors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom4</span><span class="p">)</span>
        <span class="n">atom1</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom5</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom4</span><span class="p">)</span>
        <span class="n">atom2</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom5</span><span class="p">)</span>
        <span class="n">atom3</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom4</span><span class="p">)</span>
        <span class="n">atom3</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom5</span><span class="p">)</span>
        <span class="n">atom4</span><span class="o">.</span><span class="n">tortor_to</span><span class="p">(</span><span class="n">atom5</span><span class="p">)</span></div>

<div class="viewcode-block" id="TorsionTorsion.delete"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TorsionTorsion.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes this TorsionTorsion from the atoms that make it up. This method</span>
<span class="sd">        removes the TorsionTorsion from the `tortors` list for atom1, atom2,</span>
<span class="sd">        atom3, atom4, and atom5, and removes each atom from the others&#39;</span>
<span class="sd">        tortor_partners list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">tortors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">tortors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">tortors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">tortors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">tortors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span><span class="p">)</span>
        <span class="n">_delete_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom5</span><span class="o">.</span><span class="n">_tortor_partners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom5</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span></div></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<span class="k">class</span> <span class="nc">_TorTorTable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Contains an interpolating potential grid for a coupled-torsion in the AMOEBA</span>
<span class="sd">    force field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ang1 : ``list of floats``</span>
<span class="sd">        Angles in the first dimension of the interpolation table</span>
<span class="sd">    ang2 : ``list of floats``</span>
<span class="sd">        Angles in the second dimension of the interpolation table</span>
<span class="sd">    data : ``list of floats``</span>
<span class="sd">        Value of the potential grid at each point (ang2 varies fastest)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Raises `TypeError` if the dimension of the data array does not match the</span>
<span class="sd">    number of data required by ang1 and ang2</span>

<span class="sd">    Elements from the table are obtained and/or set by using angles as indexes.</span>
<span class="sd">    If the pair of angles was not one of the original angles passed to this</span>
<span class="sd">    table, a KeyError is raised.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; table = _TorTorTable([1.0, 2.0], [1.0, 2.0, 3.0], [1, 2, 3, 4, 5, 6])</span>
<span class="sd">    &gt;&gt;&gt; table[1.0,1.0]</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; table[1.0,2.0]</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; table[2.0,2.0]</span>
<span class="sd">    5</span>
<span class="sd">    &gt;&gt;&gt; table[2.0,2.0] = 10</span>
<span class="sd">    &gt;&gt;&gt; table.data</span>
<span class="sd">    [1, 2, 3, 4, 10, 6]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ang1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ang2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Coupled torsion parameter size mismatch. </span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1"> &#39;</span>
                            <span class="s1">&#39;grid expects </span><span class="si">%d</span><span class="s1"> elements (got </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ang1</span><span class="p">),</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">ang2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ang1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ang2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indexes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">ang1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">ang2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_indexes</span><span class="p">[(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_indexes</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexes</span><span class="p">[</span><span class="n">_strip_units</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">TINY</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="TorsionTorsionType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.TorsionTorsionType.html#parmed.TorsionTorsionType">[docs]</a><span class="k">class</span> <span class="nc">TorsionTorsionType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The type containing the parameter maps for the Amoeba torsion-torsion</span>
<span class="sd">    potentials. It contains the original potential as well as interpolated first</span>
<span class="sd">    and second derivatives for the AMOEBA force field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dims : ``tuple of 2 ints``</span>
<span class="sd">        The table dimensions</span>
<span class="sd">    ang1 : ``list of floats``</span>
<span class="sd">        The list of angles in the first dimension</span>
<span class="sd">    ang2 : ``list of floats``</span>
<span class="sd">        The list of angles in the second dimension</span>
<span class="sd">    f : ``list of floats``</span>
<span class="sd">        The interpolation table for the energy</span>
<span class="sd">    dfda1 : ``list of floats``</span>
<span class="sd">        The interpolation table of the gradient w.r.t. angle 1</span>
<span class="sd">    dfda2 : ``list of floats``</span>
<span class="sd">        The interpolation table of the gradient w.r.t. angle 2</span>
<span class="sd">    d2fda1da2 : ``list of floats``</span>
<span class="sd">        The interpolation table of the 2nd derivative w.r.t. both angles</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        The list containing this coupled torsion-torsion map</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    dims : ``tuple of 2 ints``</span>
<span class="sd">        The table dimensions</span>
<span class="sd">    ang1 : ``list of floats``</span>
<span class="sd">        The list of angles in the first dimension</span>
<span class="sd">    ang2 : ``list of floats``</span>
<span class="sd">        The list of angles in the second dimension</span>
<span class="sd">    f : :class:`_TorTorTable`</span>
<span class="sd">        The interpolation table for the energy as a _TorTorTable</span>
<span class="sd">    dfda1 : :class:`_TorTorTable`</span>
<span class="sd">        The interpolation table for the first gradient as a _TorTorTable</span>
<span class="sd">    dfda2 : :class:`_TorTorTable`</span>
<span class="sd">        The interpolation table for the second gradient as a _TorTorTable</span>
<span class="sd">    d2fda1da2 : :class:`_TorTorTable`</span>
<span class="sd">        The interpolation table for the second derivative as a _TorTorTable</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        The list that may, or may not, contain this TorsionTorsionType</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this item in the list or iterable defined by `list`</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TorsionTorsionType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.TorsionTorsionType.html#parmed.TorsionTorsionType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span>
                 <span class="n">dfda1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dfda2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d2fda1da2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dims must be a 2-dimensional iterable&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ang1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ang2</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dims does match the angle definitions&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ang1</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">ang1</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ang2</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">ang2</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">_TorTorTable</span><span class="p">(</span><span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dfda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfda1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfda1</span> <span class="o">=</span> <span class="n">_TorTorTable</span><span class="p">(</span><span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">dfda1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dfda2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfda2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfda2</span> <span class="o">=</span> <span class="n">_TorTorTable</span><span class="p">(</span><span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">dfda2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d2fda1da2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d2fda1da2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d2fda1da2</span> <span class="o">=</span> <span class="n">_TorTorTable</span><span class="p">(</span><span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">d2fda1da2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ang1</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">ang1</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ang2</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">ang2</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfda1</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">dfda1</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dfda2</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">dfda2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">d2fda1da2</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">d2fda1da2</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># dfda1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dfda1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfda1</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfda1</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># dfda2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfda2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dfda2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfda2</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfda2</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># d2fda1da2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">d2fda1da2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d2fda1da2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d2fda1da2</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d2fda1da2</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># Copy</span>
        <span class="k">return</span> <span class="n">TorsionTorsionType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ang1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ang2</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">dfda1</span><span class="p">,</span>
                                  <span class="n">dfda2</span><span class="p">,</span> <span class="n">d2fda1da2</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="ChiralFrame"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.ChiralFrame.html#parmed.ChiralFrame">[docs]</a><span class="k">class</span> <span class="nc">ChiralFrame</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A chiral frame as defined in the AMOEBA force field. It defines the frame of</span>
<span class="sd">    reference for a chiral center</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first atom defined in the chiral frame</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The second atom defined in the chiral frame</span>
<span class="sd">    chirality : ``int``</span>
<span class="sd">        Either 1 or -1 to identify directionality. A ValueError is raised if a</span>
<span class="sd">        different value is provided</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A chiral frame can only contain atoms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ChiralFrame.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.ChiralFrame.html#parmed.ChiralFrame.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">chirality</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="k">if</span> <span class="n">chirality</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">chirality</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;chirality must be 1 or -1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">=</span> <span class="n">chirality</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1">--</span><span class="si">%r</span><span class="s1">, direction=</span><span class="si">%d</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="MultipoleFrame"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.MultipoleFrame.html#parmed.MultipoleFrame">[docs]</a><span class="k">class</span> <span class="nc">MultipoleFrame</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This defines the frame of reference for computing multipole interactions in</span>
<span class="sd">    the AMOEBA force field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom : :class:`Atom`</span>
<span class="sd">        The atom for which the frame of reference is defined</span>
<span class="sd">    frame_pt_num : ``int``</span>
<span class="sd">        The frame point number</span>
<span class="sd">    vectail : ``int``</span>
<span class="sd">        The vector tail index</span>
<span class="sd">    vechead : ``int``</span>
<span class="sd">        The vector head index</span>
<span class="sd">    nvec : ``int``</span>
<span class="sd">        The number of vectors</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; atom = Atom()</span>
<span class="sd">    &gt;&gt;&gt; mf = MultipoleFrame(atom, 0, 1, 2, 3)</span>
<span class="sd">    &gt;&gt;&gt; atom in mf</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; mf.frame_pt_num</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; mf.vectail</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; mf.vechead</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; mf.nvec</span>
<span class="sd">    3</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MultipoleFrame.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.MultipoleFrame.html#parmed.MultipoleFrame.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">frame_pt_num</span><span class="p">,</span> <span class="n">vectail</span><span class="p">,</span> <span class="n">vechead</span><span class="p">,</span> <span class="n">nvec</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_pt_num</span> <span class="o">=</span> <span class="n">frame_pt_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectail</span> <span class="o">=</span> <span class="n">vectail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vechead</span> <span class="o">=</span> <span class="n">vechead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvec</span> <span class="o">=</span> <span class="n">nvec</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="ow">is</span> <span class="n">thing</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="DrudeAtom"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.DrudeAtom">[docs]</a><span class="k">class</span> <span class="nc">DrudeAtom</span><span class="p">(</span><span class="n">Atom</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Atom that has a Drude particle attached to it.  This is a subclass of</span>
<span class="sd">    Atom, so it also has all the properties defined for regular Atoms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        the atomic polarizability</span>
<span class="sd">    thole : ``float``</span>
<span class="sd">        the Thole damping facior</span>
<span class="sd">    drude_type : ``str``</span>
<span class="sd">        the atom type to use for the Drude particle.</span>

<span class="sd">    Other Attributes</span>
<span class="sd">    ----------------</span>
<span class="sd">    anisotropy : :class:`DrudeAnisotropy`</span>
<span class="sd">        describes how this atom is anisotropically polarizable.  For isotropic</span>
<span class="sd">        atoms, this is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#===================================================</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">thole</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">drude_type</span><span class="o">=</span><span class="s1">&#39;DRUD&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Atom</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thole</span> <span class="o">=</span> <span class="n">thole</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drude_type</span> <span class="o">=</span> <span class="n">drude_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anisotropy</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">drude_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mf">138.935456</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kilojoules_per_mole</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">nanometer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sign</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="DrudeAnisotropy"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.DrudeAnisotropy">[docs]</a><span class="k">class</span> <span class="nc">DrudeAnisotropy</span><span class="p">(</span><span class="n">_FourAtomTerm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A description of an anisotropically polarizable atom.</span>

<span class="sd">    Atom 1 is a :class:`DrudeAtom` whose polarizability is anisotropic.  The</span>
<span class="sd">    other three atoms define the coordinate frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`DrudeAtom`</span>
<span class="sd">        the polarizable atom</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        the second atom defining the coordinate frame</span>
<span class="sd">    atom3 : :class:`Atom`</span>
<span class="sd">        the third atom defining the coordinate frame</span>
<span class="sd">    atom4 : :class:`Atom`</span>
<span class="sd">        the fourth atom defining the coordinate frame</span>
<span class="sd">    a11 : ``float``</span>
<span class="sd">        the scale factor for the polarizability along the direction defined by</span>
<span class="sd">        atom1 and atom2</span>
<span class="sd">    a22 : ``float``</span>
<span class="sd">        the scale factor for the polarizability along the direction defined by</span>
<span class="sd">        atom3 and atom4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">,</span> <span class="n">a11</span><span class="p">,</span> <span class="n">a22</span><span class="p">):</span>
        <span class="n">_FourAtomTerm</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">atom3</span><span class="p">,</span> <span class="n">atom4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="n">a11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="n">a22</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Residue"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Residue.html#parmed.Residue">[docs]</a><span class="k">class</span> <span class="nc">Residue</span><span class="p">(</span><span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single residue that is composed of a small number of atoms</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : ``str``</span>
<span class="sd">        Name of the residue. Typical convention is to choose a name that is 4</span>
<span class="sd">        characters or shorter</span>
<span class="sd">    number : ``int``, optional</span>
<span class="sd">        Residue number assigned in the input structure. Default is -1</span>
<span class="sd">    chain : ``str``, optional</span>
<span class="sd">        The 1-letter chain identifier for this residue. Default is empty string</span>
<span class="sd">    insertion_code : ``str``, optional</span>
<span class="sd">        The insertion code (used in PDB files) for this residue. Default is</span>
<span class="sd">        empty string</span>
<span class="sd">    segid : ``str``, optional</span>
<span class="sd">        The segment identifier, used by CHARMM in a way similar to chain. Dfault</span>
<span class="sd">        is empty string</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        List of residues in which this residue is a member</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name : ``str``</span>
<span class="sd">        The name of this residue</span>
<span class="sd">    number : ``int``</span>
<span class="sd">        The number of this residue in the input structure</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this residue inside the container. If this residue has no</span>
<span class="sd">        container, or it is not present in the container, idx is -1</span>
<span class="sd">    chain : ``str``</span>
<span class="sd">        The 1-letter chain identifier for this residue</span>
<span class="sd">    insertion_code : ``str``</span>
<span class="sd">        The insertion code (used in PDB files) for this residue</span>
<span class="sd">    ter : ``bool``</span>
<span class="sd">        If True, there is a TER card directly after this residue (i.e., a</span>
<span class="sd">        molecule or chain ends). By default, it is False</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        The container that _may_ have this residue contained inside</span>
<span class="sd">    atoms : ``list of`` :`class`Atom` ``instances``</span>
<span class="sd">        This is the list of `Atom`s that make up this residue</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Iterating over a residue will iterate over the atoms. It is exactly</span>
<span class="sd">      equivalent to iterating over the `atoms` attribute</span>
<span class="sd">    - Supports testing if an Atom instance is contained `in` this residue</span>
<span class="sd">    - `len()` returns the number of atoms in this residue</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Residue.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.Residue.html#parmed.Residue.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">number</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">insertion_code</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">segid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insertion_code</span> <span class="o">=</span> <span class="n">insertion_code</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ter</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segid</span> <span class="o">=</span> <span class="n">segid</span></div>

<div class="viewcode-block" id="Residue.add_atom"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Residue.add_atom">[docs]</a>    <span class="k">def</span> <span class="nf">add_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds an atom to this residue</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atom : :class:`Atom`</span>
<span class="sd">            The atom to add to this residue</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This action assigns the `residue` attribute to `atom`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span></div>

<div class="viewcode-block" id="Residue.delete_atom"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Residue.delete_atom">[docs]</a>    <span class="k">def</span> <span class="nf">delete_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If an atom is present in this residue, delete it from the list of</span>
<span class="sd">        atoms. No change if an atom is not present in this residue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">atom</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">atom</span><span class="p">]</span></div>

    <span class="c1"># Implement some container methods over the list of atoms</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; True if an atom is present in this residue &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

<div class="viewcode-block" id="Residue.is_empty"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Residue.is_empty">[docs]</a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines if there are any atoms in this residue</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        empty: ``bool``</span>
<span class="sd">            ``True`` if there are no atoms left. ``False`` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Residue.sort"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Residue.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sorts the atoms in this list by atom index &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="c1"># Sort by atom indices</span>
    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span>
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span>
    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idx</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">[</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">:</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="s1">&#39;; chain=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">insertion_code</span><span class="p">:</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="s1">&#39;; insertion_code=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">insertion_code</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segid</span><span class="p">:</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="s1">&#39;; segid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">segid</span>
        <span class="k">return</span> <span class="n">rep</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="bp">self</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<span class="k">def</span> <span class="nf">_changes</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Decorator to indicate the list has changed &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">new_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needs_indexing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_func</span>

<div class="viewcode-block" id="TrackedList"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TrackedList">[docs]</a><span class="k">class</span> <span class="nc">TrackedList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This creates a list type that allows you to see if anything has changed</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    changed : ``bool``</span>
<span class="sd">        Determines if something has been done to fundamentally change the</span>
<span class="sd">        underlying topology defined by this list such that the topology needs to</span>
<span class="sd">        be rebuilt</span>
<span class="sd">    needs_indexing : ``bool``</span>
<span class="sd">        A flag to determine whether or not the items in a tracked list need to</span>
<span class="sd">        be indexed or not.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; tl = TrackedList()</span>
<span class="sd">    &gt;&gt;&gt; tl.append(Atom())</span>
<span class="sd">    &gt;&gt;&gt; tl.append(Atom())</span>
<span class="sd">    &gt;&gt;&gt; tl.append(Atom())</span>
<span class="sd">    &gt;&gt;&gt; tl.needs_indexing, tl.changed</span>
<span class="sd">    (True, True)</span>
<span class="sd">    &gt;&gt;&gt; tl.index_members()</span>
<span class="sd">    &gt;&gt;&gt; tl.needs_indexing, tl.changed</span>
<span class="sd">    (False, True)</span>
<span class="sd">    &gt;&gt;&gt; tl.changed = False # Must do when changes have been incorporated</span>
<span class="sd">    &gt;&gt;&gt; tl.needs_indexing, tl.changed</span>
<span class="sd">    (False, False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needs_indexing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">([</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">retstr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
            <span class="n">retstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">retstr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">retstr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">retstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;])&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">retstr</span><span class="p">)</span>

    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes items and slices. Make sure all items &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">item</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># If we can&#39;t set _idx attribute on this object, don&#39;t fret</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># If we can&#39;t set list attribute on this object, don&#39;t fret</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">__delslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Python 2 still uses __delslice__... &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span> <span class="c1"># pragma: no cover</span>

<div class="viewcode-block" id="TrackedList.pop"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TrackedList.pop">[docs]</a>    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="nb">list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;_idx&#39;</span><span class="p">):</span>
            <span class="n">item</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">item</span></div>

<div class="viewcode-block" id="TrackedList.remove"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TrackedList.remove">[docs]</a>    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
        <span class="c1"># If this did not raise an exception, it was part of the list, so</span>
        <span class="c1"># de-index it</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="s1">&#39;_idx&#39;</span><span class="p">):</span>
            <span class="n">thing</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></div>

    <span class="n">append</span> <span class="o">=</span> <span class="n">_changes</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>
    <span class="n">extend</span> <span class="o">=</span> <span class="n">_changes</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">extend</span><span class="p">)</span>
    <span class="n">insert</span> <span class="o">=</span> <span class="n">_changes</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>
    <span class="fm">__setitem__</span> <span class="o">=</span> <span class="n">_changes</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">)</span>
    <span class="fm">__iadd__</span> <span class="o">=</span> <span class="n">_changes</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">)</span>
    <span class="fm">__imul__</span> <span class="o">=</span> <span class="n">_changes</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__imul__</span><span class="p">)</span>

    <span class="c1"># Type-safe methods that return another instance</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TrackedList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fac</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TrackedList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fac</span><span class="p">))</span>

<div class="viewcode-block" id="TrackedList.index_members"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TrackedList.index_members">[docs]</a>    <span class="k">def</span> <span class="nf">index_members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns the idx variable for every member of this list to its place in</span>
<span class="sd">        the list, if the members of this list permit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># Must be some kind of immutable type... don&#39;t worry</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needs_indexing</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TrackedList.claim"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TrackedList.claim">[docs]</a>    <span class="k">def</span> <span class="nf">claim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method causes this list to &quot;claim&quot; all of the items it contains and</span>
<span class="sd">        subsequently indexes all of its items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># Must be some kind of immutable type... don&#39;t worry</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_members</span><span class="p">()</span></div>

<div class="viewcode-block" id="TrackedList.prune_unused"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.TrackedList.prune_unused">[docs]</a>    <span class="k">def</span> <span class="nf">prune_unused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method inspects the `used` attribute of all of its members, if it</span>
<span class="sd">        has one, and deletes any item in which it is set to `False`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">used</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># Don&#39;t worry if we don&#39;t have a `used` attribute</span>
                <span class="k">pass</span></div></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="ResidueList"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.ResidueList.html#parmed.ResidueList">[docs]</a><span class="k">class</span> <span class="nc">ResidueList</span><span class="p">(</span><span class="n">TrackedList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Array of `Residue` instances &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResidueList.add_atom"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.ResidueList.add_atom">[docs]</a>    <span class="k">def</span> <span class="nf">add_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inscode</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">segid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new atom to the ResidueList, adding a new residue to this list if</span>
<span class="sd">        it has a different name or number as the last residue</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atom : :class:`Atom`</span>
<span class="sd">            The atom to add to this residue list</span>
<span class="sd">        resname : ``str``</span>
<span class="sd">            The name of the residue this atom belongs to</span>
<span class="sd">        resnum : ``int``</span>
<span class="sd">            The number of the residue this atom belongs to</span>
<span class="sd">        chain : ``str``</span>
<span class="sd">            The chain ID character for this residue</span>
<span class="sd">        inscode : ``str``</span>
<span class="sd">            The insertion code ID character for this residue (it is stripped)</span>
<span class="sd">        segid : ``str``</span>
<span class="sd">            The segment identifier for this residue (it is stripped)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If the residue name and number differ from the last residue in this</span>
<span class="sd">        list, a new residue is added and the atom is added to that residue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inscode</span> <span class="o">=</span> <span class="n">inscode</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">segid</span> <span class="o">=</span> <span class="n">segid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># Empty list -- add our first residue</span>
            <span class="n">new_res</span> <span class="o">=</span> <span class="n">Residue</span><span class="p">(</span><span class="n">resname</span><span class="p">,</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">inscode</span><span class="p">,</span> <span class="n">segid</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new_res</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">resnum</span> <span class="ow">or</span> <span class="n">last</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span>
                <span class="n">last</span><span class="o">.</span><span class="n">chain</span> <span class="o">!=</span> <span class="n">chain</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span>
                <span class="n">last</span><span class="o">.</span><span class="n">segid</span> <span class="o">!=</span> <span class="n">segid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span>
                <span class="n">last</span><span class="o">.</span><span class="n">insertion_code</span> <span class="o">!=</span> <span class="n">inscode</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                <span class="n">new_res</span> <span class="o">=</span> <span class="n">Residue</span><span class="p">(</span><span class="n">resname</span><span class="p">,</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">inscode</span><span class="p">,</span>
                                  <span class="n">segid</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">new_res</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_res</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span></div>

<div class="viewcode-block" id="ResidueList.prune"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.ResidueList.prune">[docs]</a>    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function goes through the residue list and removes all empty</span>
<span class="sd">        residues from the list. This isn&#39;t done automatically when atoms are</span>
<span class="sd">        deleted, since it will become very slow. You must remember to do this to</span>
<span class="sd">        avoid including empty residues</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Delete from the back to avoid indexes changing as we iterate</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span> <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="AtomList"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.AtomList.html#parmed.AtomList">[docs]</a><span class="k">class</span> <span class="nc">AtomList</span><span class="p">(</span><span class="n">TrackedList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Array of Atoms</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Deleting an atom from the AtomList also deletes that atom from the residue</span>
<span class="sd">    it belongs to.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deleting an atom also needs to delete it from the residue &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">idx</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Make sure we delete this atom from its respective residue</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">delete_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>

        <span class="nb">list</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

<div class="viewcode-block" id="AtomList.pop"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.pop">[docs]</a>    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="nb">list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">delete_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">atom</span></div>

<div class="viewcode-block" id="AtomList.remove"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.remove">[docs]</a>    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not in list&#39;</span> <span class="o">%</span> <span class="n">atom</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">delete_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomList.unmark"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.unmark">[docs]</a>    <span class="k">def</span> <span class="nf">unmark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Unmark all atoms in this list &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">atm</span><span class="o">.</span><span class="n">marked</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="AtomList.append"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.append">[docs]</a>    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an Atom to the end of the list and have this list claim ownership of</span>
<span class="sd">        the item.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : :class:`Atom`</span>
<span class="sd">            The atom to add to this list</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Only Atom objects should be added here, so if `item` does not have a</span>
<span class="sd">        `list` attribute, an AttributeError will be raised. This action assigns</span>
<span class="sd">        this list as the `list` attribute to the passed Atom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomList.extend"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.extend">[docs]</a>    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an iterable of `Atom`s to the end of the list and have this list</span>
<span class="sd">        claim ownership of the items.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        items : iterable of :class:`Atom`s</span>
<span class="sd">            The iterable containing Atom instances to add to the end of this</span>
<span class="sd">            list</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any generator passed here will be exhausted. The `list` attribute for</span>
<span class="sd">        every object in `items` will have their `list` attribute set to this</span>
<span class="sd">        list, and an AttributeError will be raised if this is not possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomList.insert"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.insert">[docs]</a>    <span class="nd">@_changes</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert an Atom into the atom list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        idx : ``int``</span>
<span class="sd">            The index in front of (i.e., before) which to insert the item</span>
<span class="sd">        item : :class:`Atom`</span>
<span class="sd">            The atom to insert in the desired index. This atom will be claimed</span>
<span class="sd">            by the AtomList</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomList.assign_nbidx_from_types"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.assign_nbidx_from_types">[docs]</a>    <span class="k">def</span> <span class="nf">assign_nbidx_from_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns the nb_idx attribute of every atom inside here from the</span>
<span class="sd">        atom_type definition. If the atom_type is not assigned, RuntimeError is</span>
<span class="sd">        raised.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ``list of dict``</span>
<span class="sd">            Each element is a `set` of the `nb_idx` indices for which NBFIX</span>
<span class="sd">            alterations are defined for the type with that given that index</span>
<span class="sd">            (minus 1, to adjust for indexing from 0 and nb_idx starting from 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">natoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">atom_type_lookups</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span> <span class="c1"># For fast lookups</span>
        <span class="n">atom_type_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">is</span> <span class="n">UnassignedAtomType</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;atom types are not assigned&#39;</span><span class="p">)</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">type1</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span>
            <span class="c1"># Skip atom types that have already been assigned</span>
            <span class="k">if</span> <span class="n">type1</span><span class="o">.</span><span class="n">_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">type1</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="n">atom_type_lookups</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">type1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">type1</span>
            <span class="n">atom_type_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">type1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">natoms</span><span class="p">):</span>
                <span class="n">atom2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">type2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">atom_type</span>
                <span class="c1"># Skip atom types that have already been assigned</span>
                <span class="k">if</span> <span class="n">type2</span><span class="o">.</span><span class="n">_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">type1</span> <span class="o">==</span> <span class="n">type2</span><span class="p">:</span>
                    <span class="n">type2</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Now go back through and assign nb_idx from type._idx</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">nb_idx</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span><span class="o">.</span><span class="n">_idx</span>
        <span class="c1"># Now collect the nbfixes</span>
        <span class="n">nbfix_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="c1"># Look through all of the atom types and add the nbfixes</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atom_type_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">type</span><span class="o">.</span><span class="n">nbfix</span><span class="p">:</span>
                <span class="n">rmin</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">rmin14</span><span class="p">,</span> <span class="n">eps14</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">nbfix</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">otype</span> <span class="o">=</span> <span class="n">atom_type_lookups</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">otype</span><span class="o">.</span><span class="n">_idx</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">rmin14</span><span class="p">,</span> <span class="n">eps14</span><span class="p">)</span>
                    <span class="n">nbfix_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nbfix_list</span></div>

<div class="viewcode-block" id="AtomList.find_original_index"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomList.find_original_index">[docs]</a>    <span class="k">def</span> <span class="nf">find_original_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds an atom with the given original index. Cannot assume that the</span>
<span class="sd">        original indexes are in order, since reordering may have been necessary.</span>
<span class="sd">        As a result, the complexity of this algorithm is O(N)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        idx : int</span>
<span class="sd">            The integer corresponding to the original index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        atom : :class:`Atom`</span>
<span class="sd">            The atom with the original index ``idx``</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IndexError</span>
<span class="sd">            If no atom has the original index ``idx``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">idx</span><span class="p">:</span> <span class="k">return</span> <span class="n">atom</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;No atom found with index </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">idx</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="NonbondedException"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.NonbondedException.html#parmed.NonbondedException">[docs]</a><span class="k">class</span> <span class="nc">NonbondedException</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The AMOEBA force field has complex exclusion and exception rules (referred</span>
<span class="sd">    to as &quot;adjustments&quot; in the Amber-converted files). This class stores</span>
<span class="sd">    per-particle exceptions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        One of the atoms in the exclusion pair</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The other atom in the exclusion pair</span>
<span class="sd">    type : :class:`NonbondedExceptionType`</span>
<span class="sd">        The nonbonded exception type that describes how the various nonbonded</span>
<span class="sd">        interactions between these two atoms should work</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    NonbondedException objects &quot;contain&quot; two atoms and will return True when</span>
<span class="sd">    used with the binary `in` operator</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="NonbondedException.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.NonbondedException.html#parmed.NonbondedException.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funct</span> <span class="o">=</span> <span class="mi">1</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%r</span><span class="s1"> and </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">retstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;, type=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">retstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">retstr</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="NonbondedExceptionType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.NonbondedExceptionType.html#parmed.NonbondedExceptionType">[docs]</a><span class="k">class</span> <span class="nc">NonbondedExceptionType</span><span class="p">(</span><span class="n">_ParameterType</span><span class="p">,</span> <span class="n">_ListItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A parameter describing how the various nonbonded interactions between a</span>
<span class="sd">    particular pair of atoms behaves in a specified nonbonded exception (e.g.,</span>
<span class="sd">    in 1-4 interacting terms)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rmin : float</span>
<span class="sd">        The combined Rmin value for this particular pair of atom types</span>
<span class="sd">        (dimension length, default units are Angstroms)</span>
<span class="sd">    epsilon : float</span>
<span class="sd">        The combined well-depth value for this particular pair of atom types</span>
<span class="sd">        (dimension energy, default units are kcal/mol)</span>
<span class="sd">    chgscale : float, optional</span>
<span class="sd">        The scaling factor by which to multiply the product of the charges for</span>
<span class="sd">        this pair. Default is 1.0.</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        The list containing this nonbonded exception</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="NonbondedExceptionType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.NonbondedExceptionType.html#parmed.NonbondedExceptionType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">chgscale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ParameterType</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chgscale</span> <span class="o">=</span> <span class="n">chgscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>

    <span class="nd">@sigma</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">urmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uepsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">; rmin=</span><span class="si">%.4f</span><span class="s1">, epsilon=</span><span class="si">%.4f</span><span class="s1">, chgscale=</span><span class="si">%.4f</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chgscale</span><span class="p">)</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">rmin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chgscale</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">chgscale</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span><span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmin</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chgscale</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="AmoebaNonbondedExceptionType"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AmoebaNonbondedExceptionType">[docs]</a><span class="k">class</span> <span class="nc">AmoebaNonbondedExceptionType</span><span class="p">(</span><span class="n">NonbondedExceptionType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A parameter describing how the various nonbonded interactions between a</span>
<span class="sd">    particular pair of atoms is scaled in the AMOEBA force field</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vdw_weight : ``float``</span>
<span class="sd">        The scaling factor by which van der Waals interactions are multiplied</span>
<span class="sd">    multipole_weight : ``float``</span>
<span class="sd">        The scaling factor by which multipole interactions are multiplied</span>
<span class="sd">    direct_weight : ``float``</span>
<span class="sd">        The scaling factor by which direct-space interactions are multiplied</span>
<span class="sd">    polar_weight : ``float``</span>
<span class="sd">        The scaling factor by which polarization interactions are multiplied</span>
<span class="sd">    mutual_weight : ``float``</span>
<span class="sd">        The scaling factor by which mutual interactions are multiplied</span>
<span class="sd">    list : :class:`TrackedList`</span>
<span class="sd">        The list containing this nonbonded exception</span>

<span class="sd">    Other Attributes</span>
<span class="sd">    ----------------</span>
<span class="sd">    idx : ``int``</span>
<span class="sd">        The index of this term in the list that contains it</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vdw_weight</span><span class="p">,</span> <span class="n">multipole_weight</span><span class="p">,</span> <span class="n">direct_weight</span><span class="p">,</span>
                 <span class="n">polar_weight</span><span class="p">,</span> <span class="n">mutual_weight</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdw_weight</span> <span class="o">=</span> <span class="n">vdw_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multipole_weight</span> <span class="o">=</span> <span class="n">multipole_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_weight</span> <span class="o">=</span> <span class="n">direct_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polar_weight</span> <span class="o">=</span> <span class="n">polar_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutual_weight</span> <span class="o">=</span> <span class="n">mutual_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vdw_weight</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">vdw_weight</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multipole_weight</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">multipole_weight</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_weight</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">direct_weight</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polar_weight</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">polar_weight</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutual_weight</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">mutual_weight</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AmoebaNonbondedExceptionType</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vdw_weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multipole_weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct_weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">polar_weight</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutual_weight</span>
        <span class="p">)</span>

    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_with_exclusions</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vdw_weight</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multipole_weight</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_weight</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polar_weight</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">),</span>
                     <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutual_weight</span><span class="p">,</span> <span class="n">_TINY_DIGITS</span><span class="p">)))</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="AtomType"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.AtomType.html#parmed.AtomType">[docs]</a><span class="k">class</span> <span class="nc">AtomType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Atom types can either be compared by indexes or names. Can be assigned with</span>
<span class="sd">    a string, integer, (string is not automatically cast) or with both.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : ``str``</span>
<span class="sd">        The name of the atom type</span>
<span class="sd">    number : ``int``</span>
<span class="sd">        The serial index of the atom type</span>
<span class="sd">    mass : ``float``</span>
<span class="sd">        The mass of the atom type</span>
<span class="sd">    atomic_number : ``int``, optional</span>
<span class="sd">        The atomic number of the element of the atom type. Default -1</span>
<span class="sd">    bond_type : ``str``, optional</span>
<span class="sd">        If defined, this is the type name used to look up bonded parameters.</span>
<span class="sd">        Default is None (which falls back to ``name``)</span>
<span class="sd">    charge : ``float``, optional</span>
<span class="sd">        If defined, this is the partial atomic charge in elementary charge</span>
<span class="sd">        units. Default is None</span>

<span class="sd">    Other Attributes</span>
<span class="sd">    ----------------</span>
<span class="sd">    epsilon : ``float``</span>
<span class="sd">        If set, it is the Lennard-Jones well depth of this atom type</span>
<span class="sd">    rmin : ``float``</span>
<span class="sd">        If set, it is the Lennard-Jones Rmin/2 parameter of this atom type</span>
<span class="sd">    epsilon_14 : ``float``</span>
<span class="sd">        If set, it is the Lennard-Jones well depth of this atom type in 1-4</span>
<span class="sd">        nonbonded interactions</span>
<span class="sd">    rmin_14 : ``float``</span>
<span class="sd">        If set, it is the Lennard-Jones Rmin/2 parameter of this atom type in</span>
<span class="sd">        1-4 nonbonded interactions</span>
<span class="sd">    sigma : ``float``</span>
<span class="sd">        This is the sigma parameter, which is just equal to Rmin*2^(1/6)</span>
<span class="sd">    sigma_14 : ``float``</span>
<span class="sd">        This is the sigma parameter corresponding to rmin_14, which is just equal to Rmin_14*2^(1/6)</span>
<span class="sd">    nbfix : ``dict(str:tuple)``</span>
<span class="sd">        A hash that maps atom type names of other atom types with which _this_</span>
<span class="sd">        atom type has a defined NBFIX with a tuple containing the terms</span>
<span class="sd">        (Rmin, epsilon, Rmin14, Epsilon14)</span>
<span class="sd">    _bond_type : str or None</span>
<span class="sd">        If an explicit value was given to bond_type, _bond_type will be set to a</span>
<span class="sd">        value. Otherwise, _bond_type will be None (and bond_type will be the</span>
<span class="sd">        same as ``name``). This can be used to determine if a bond_type was</span>
<span class="sd">        specified by comparing to None.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This object is primarily used to build parameter databases from parameter</span>
<span class="sd">    files. Also, sigma is related to Rmin, but rmin is Rmin/2, so there is an</span>
<span class="sd">    extra factor of 2 in the sigma for this reason.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; at = AtomType(&#39;HA&#39;, 1, 1.008, 1)</span>
<span class="sd">    &gt;&gt;&gt; at.name, at.number</span>
<span class="sd">    (&#39;HA&#39;, 1)</span>
<span class="sd">    &gt;&gt;&gt; at2 = AtomType(&#39;CA&#39;, 2, 12.01, 6)</span>
<span class="sd">    &gt;&gt;&gt; at2.name, at2.number</span>
<span class="sd">    (&#39;CA&#39;, 2)</span>
<span class="sd">    &gt;&gt;&gt; print(&quot;%s: %d&quot; % (str(at), int(at)))</span>
<span class="sd">    HA: 1</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AtomType.__init__"><a class="viewcode-back" href="../../topobj/parmed.topologyobjects.AtomType.html#parmed.AtomType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">atomic_number</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">bond_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If we were given an integer, assign it to number. Otherwise,</span>
            <span class="c1"># assign it to the name</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">_strip_units</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">daltons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span> <span class="o">=</span> <span class="n">atomic_number</span>
        <span class="c1"># We have no LJ parameters as of yet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Store each NBFIX term as a dict with the atom type string matching to</span>
        <span class="c1"># a 2-element tuple that is rmin, epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbfix</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># needed for some internal bookkeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_type</span> <span class="o">=</span> <span class="n">bond_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span></div>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares based on available properties (name and number, just name,</span>
<span class="sd">        or just number)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">AtomType</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Now check if LJ parameters are defined, and make sure those are</span>
            <span class="c1"># also equal</span>
            <span class="n">has_all</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">has_none</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">,</span> <span class="s1">&#39;rmin&#39;</span><span class="p">,</span> <span class="s1">&#39;epsilon_14&#39;</span><span class="p">,</span> <span class="s1">&#39;rmin_14&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">has_all</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span> <span class="c1"># can&#39;t be equal</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">has_none</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">has_all</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_none</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">has_none</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_all</span><span class="p">),</span> \
                    <span class="s1">&#39;Should have all or none at this point&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_all</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="c1"># Check charges</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">charge</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TINY</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="c1"># At this point, we have all the attributes we need to compare</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">rmin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon_14</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">epsilon_14</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">rmin_14</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TINY</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nbfix</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nbfix</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="AtomType.set_lj_params"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomType.set_lj_params">[docs]</a>    <span class="k">def</span> <span class="nf">set_lj_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">eps14</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rmin14</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets Lennard-Jones parameters on this atom type &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">eps</span><span class="p">):</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">rmin</span><span class="p">):</span>
            <span class="n">rmin</span> <span class="o">=</span> <span class="n">rmin</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eps14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eps14</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="k">if</span> <span class="n">rmin14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rmin14</span> <span class="o">=</span> <span class="n">rmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">=</span> <span class="n">rmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_14</span> <span class="o">=</span> <span class="n">eps14</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">=</span> <span class="n">rmin14</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bond_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_type</span>

    <span class="nd">@bond_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bond_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_type</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The integer representation of an AtomType is its index &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span>

<div class="viewcode-block" id="AtomType.add_nbfix"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AtomType.add_nbfix">[docs]</a>    <span class="k">def</span> <span class="nf">add_nbfix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span>
                  <span class="n">rmin14</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epsilon14</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a new NBFIX exclusion for this atom type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typename : str</span>
<span class="sd">            The name of the *other* type with which this NBFIX is defined</span>
<span class="sd">        rmin : float</span>
<span class="sd">            The combined Rmin value for this NBFIXed pair. If no units, assumed</span>
<span class="sd">            to be in Angstroms</span>
<span class="sd">        epsilon : float</span>
<span class="sd">            The combined epsilon value for this NBFIXed pair. If no units,</span>
<span class="sd">            assumed to be in kcal/mol</span>
<span class="sd">        rmin14 : float, optional</span>
<span class="sd">            Same as rmin, but for 1-4 interactions. If None (default), it is</span>
<span class="sd">            given the same value as rmin</span>
<span class="sd">        epsilon14 : float, optional</span>
<span class="sd">            Same as epsilon, but for 1-4 interactions. If None (default), it is</span>
<span class="sd">            given the same value as rmin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rmin14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">rmin14</span> <span class="o">=</span> <span class="n">rmin</span>
        <span class="k">if</span> <span class="n">epsilon14</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">epsilon14</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbfix</span><span class="p">[</span><span class="n">typename</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">rmin14</span><span class="p">,</span> <span class="n">epsilon14</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sigma is Rmin / 2^(1/6) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="nd">@sigma</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sigma is Rmin / 2^(1/6) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="nd">@sigma_14</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma_14</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usigma_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_14</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">urmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uepsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">urmin_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uepsilon_14</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_14</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">AtomType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span><span class="p">,</span>
                      <span class="n">bond_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_bond_type</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">rmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">epsilon_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_14</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">rmin_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">nbfix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbfix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cp</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomic_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_type</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_14</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">rmin_14</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbfix</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<span class="k">class</span> <span class="nc">_UnassignedAtomType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This raises the appropriate exceptions (ParameterError) when you try to</span>
<span class="sd">    access its properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_OBJ</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_OBJ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_OBJ</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">_UnassignedAtomType</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_OBJ</span>

    <span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Atom type is not defined&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Atom type is not defined&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_UnassignedAtomType</span><span class="p">)</span> <span class="c1"># Behave like a singleton</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;UnassignedAtomType&#39;</span>

<span class="n">UnassignedAtomType</span> <span class="o">=</span> <span class="n">_UnassignedAtomType</span><span class="p">()</span>
<span class="c1"># Make sure it&#39;s a singleton</span>
<span class="k">assert</span> <span class="n">UnassignedAtomType</span> <span class="ow">is</span> <span class="n">_UnassignedAtomType</span><span class="p">(),</span> <span class="s2">&quot;Not a singleton&quot;</span>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="AcceptorDonor"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.AcceptorDonor">[docs]</a><span class="k">class</span> <span class="nc">AcceptorDonor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Just a holder for donors and acceptors in CHARMM speak</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        First atom in the donor/acceptor group</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        Second atom in the donor/acceptor group</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;AcceptorDonor; </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See if the atom is in this donor/acceptor &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="ow">or</span> <span class="n">thing</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Group"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Group">[docs]</a><span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; An &#39;interacting&#39; group defined by CHARMM PSF files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom : :class:`Atom`</span>
<span class="sd">        The first atom within a group</span>
<span class="sd">    type : ``int``</span>
<span class="sd">        Flag for group information; 0 when all atoms have zero charge,</span>
<span class="sd">        1 when group has a net zero charge but at least one atom has a non-zero</span>
<span class="sd">        partial charge, 2 when the net charge of the group is not zero</span>
<span class="sd">    move : ``int``</span>
<span class="sd">        0 if the atoms are not fixed, 1 when they are</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    See the discussion on Github for the source of the meanings of these</span>
<span class="sd">    variables: https://github.com/ParmEd/ParmEd/pull/307#issuecomment-128244134</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">move</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span> <span class="o">=</span> <span class="n">move</span>

    <span class="nd">@_exception_to_notimplemented</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">atom</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">move</span><span class="p">)</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<div class="viewcode-block" id="Link"><a class="viewcode-back" href="../../api/parmed/parmed.topologyobjects.html#parmed.Link">[docs]</a><span class="k">class</span> <span class="nc">Link</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; An intra-residue &quot;Link&quot; as defined by the PDB standard:</span>

<span class="sd">    See http://www.wwpdb.org/documentation/file-format-content/format33/sect6.html#LINK for more</span>
<span class="sd">    information</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom1 : :class:`Atom`</span>
<span class="sd">        The first Atom involved in the Link</span>
<span class="sd">    atom2 : :class:`Atom`</span>
<span class="sd">        The other atom to which ``atom1`` is bonded in this link</span>
<span class="sd">    length : float</span>
<span class="sd">        The length of the link</span>
<span class="sd">    symmetry_op1 : str, optional</span>
<span class="sd">        The first symmetry operator for the link</span>
<span class="sd">    symmetry_op2 : str, optional</span>
<span class="sd">        The second symmetry operator for the link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">symmetry_op1</span><span class="o">=</span><span class="s1">&#39;1555&#39;</span><span class="p">,</span> <span class="n">symmetry_op2</span><span class="o">=</span><span class="s1">&#39;1555&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_op1</span> <span class="o">=</span> <span class="n">symmetry_op1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_op2</span> <span class="o">=</span> <span class="n">symmetry_op2</span></div>

<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

<span class="n">NoUreyBradley</span> <span class="o">=</span> <span class="n">BondType</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c1"># singleton representing lack of a U-B term</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2015, Jason Swails

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>